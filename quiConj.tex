\section{Konjunktion}

Die Relation \QRel{} verfeinert die Relation \ERel{} nur um die zusätzlich
Inklusion $\QET _P \subseteq \QET _Q$. Es kann also die Konjunktion und die
dafür notwendige Normal Form nur mit kleinen Abwandlungen aus dem
Fehler"=Kapitel übernommen werden.\\
Als erstes sollte überprüft werden, ob die Konstruktion der Normal Form etwas
an den Traces aus der Menge \QET{} verändert. Da die Normalisierung
in~\ref{normalFormDef} die Menge der Fehler"=Traces in \ET{} unverändert lässt,
reicht es aus die Traces aus $\StQT (P)\backslash\ET (P)$ zu betrachten.
Schritt (i) lässt alle Zustände, die nicht in $E_P$ oder $\overline{E_P}$
enthalten sind unverändert, vor allem verändert dieser Schritt noch keine
Transitionen. Alle stillen Zustände sind also auch noch nach dem Schritt (i)
still. Im ersten Fall des Schrittes (ii) ist die Menge $\StQT (P)\backslash \ET
(P)$ leer und ebenso ist es die Menge $\StQT (\NF (P))\backslash\ET (\NF (P))$.
Der zweite Fall von Schritt (ii) verändert nur Transitionen, zu Zuständen
führen, die mit Traces aus $\ET (P)$ erreichbar sind. Es bleiben also auch die
durch $\StQT (P)\backslash \ET (P)$ erreichbaren Zustände im zweiten Schritt
der Konstruktion in~\ref{normalFormDef} still. Es gilt also auch für die Trace
Menge \QET{} $\QET(P) = \QET (\NF (P))$ und somit ist $\NF (P)$ ebenfalls
äquivalent zu $P$ bezüglich der Relation \QRel{}. Es ergibt sich eine analoge
Folgerung zu Proposition~\ref{FehlerNormalFormProp}.\\

\begin{Prop}[Normal Form]
  \label{stilleNormalFormProp}
  Jedes \MEIO{} $P$ ist äquivalent zu seiner Normal Form $\NF (P)$ bezüglich
  der Relation \QRel{}.
\end{Prop}

Das Lemma~\ref{FehlerAblaufNFLem} kann für die Stille"=Traces erweitert werden.
Alle Aussagen, die Lemma~\ref{FehlerAblaufNFLem} trifft sind auch in diesem
Kapitel weiterhin gültig.

\begin{Lem}
  Sei $P$ ein \MEIO{} in Normal Form. $w\in\StET (P)\backslash \ET (P)$ gilt
  genau dann, wenn $w$ sich aus einem Ablauf ergibt, der einen Zustand
  erreicht, für denen es keine ausgehenden must"=Transitionen für lokale
  Aktionen gibt.
\end{Lem}

Die Normal Form hat das Problem mit dem Fehler"=Zuständen gelöst. In der
Definition~\ref{FehlerConjDef} gab es eine spezielle Behandlung der
Input"=Transitionen um in der Konjunktion die Input"=kritischen Traces
entsprechend zu berücksichtigen. Auch für die in diesem Kapitel neu eingeführte
Trace Menge \QET{} kann es zu Problemen kommen, die durch die Normal Form und
Konjunktion im Fehler"=Kapitel noch nicht gelöst wurden. Es soll wiederum $\QET
_{P\land Q} = \QET _P \cap \QET _Q$ gelten. Für die \ET{} Mengen gilt bereits
eine analoge Aussage. Es ist also nur noch notwendig sich mit Traces
auseinander zu setzten, die in mindestens einer Komponente der Konjunktion
einen stillen Zustand erreichen. Falls $P$ und $Q$ beide einen stillen Zustand
erreichen, kann es in der Konjunktion aus den beiden stillen Zuständen auch
keine ausgehenden lokalen Aktionen geben, da in $P\land Q$ nur Transitionen
möglich sind, die mindestens an einem der beteiligten Zustände möglich ist. Es
sind also alle im Schritt der fehler"=gefluteten Stille"=Traces enthaltenen
Elemente auch in der Menge $\QET _{P\land Q}$ enthalten. Jedoch kann die Menge
$\QET _{P\land Q}$ echt größer sein, wenn man die Definitionen aus dem letzten
Kapitel unverändert anwendet. Falls $P$ eine must"=Output"=Transition besitzt
und $Q$ keine passende Output"=Transition enthält. Hat der zusammengesetzt
keine ausgehende Transition für den Output. Somit kann es dazu kommen, dass ein
Zustand, der aus zwei Zuständen zusammen gesetzt ist, von denen mindestens
einer nicht still ist, in der Konjunktion trotzdem still ist. An den Zuständen,
an denen das beschriebene Problem auftritt kann diese durch neu hinzugefügte
$\tau$-Schlingen gelöst werden.

\begin{Def}[Konjunktion]
  Es werden die Voraussetzungen und die Konstruktion der Konjunktion
  aus~\ref{FehlerConjDef} in diese Definition übernommen. Man erhält $P_1\land
  P_2$ in diesem Kapitel aus der konstruierten Konjunktion in dem man eine
  $\tau$-Schleife an jeden Zustand $(p_1,p_2)\in Qui$ anfügt, für den keiner
  der $p_j$ ein Fehler-, Input"=kritischer oder stiller Zustand ist.
\end{Def}

Für dies abgewandelte Konjunktions"=Definition kann nun auch für die Relation
\QRel{} gezeigt werden, dass $\land$ die gewünscht größte untere Schranke ist.

\begin{Satz}[Konjunktion]
  Für drei \MEIO{}s $S$, $P_1$ und $P_2$ mit der gleichen Signatur gilt $S\QRel
  P_1\land P_2$ genau dann, wenn $S\QRel P_1$ und $S\QRel P_2$ erfüllt ist.
\end{Satz}

\begin{proof}
  Man kann sich hier, wie auch im Beweis von Satz~\ref{FehlerConjSatz} auf
  \MEIO{}s in Normal Form beschränken. Dies ist möglich, da jeder \MEIO{} einen
  bezüglich \QRel{} äquivalenten \MEIO{} in Normal Form besitzt nach
  Proposition~\ref{stilleNormalFormProp}.\\
  Damit $P\QRel Q$ gilt, muss $P\ERel Q$ und $\QET _P \subseteq \QET _Q$
  erfüllt sein (Definition~\ref{StilleSemDef}). Für die Relation \ERel{} wurde
  bereits im Fehler"=Kapitel ein analoger Satz (\ref{FehlerConjSatz}) bewiesen.
  Somit reicht es um diesen Satz zu zeigen, sich auf die Inklusionen der
  \QET{}-Mengen zu beschränken.


  \glqq $\Leftarrow$\grqq{}:\\
  Für diese Richtung muss die Inklusion $\QET _S\subseteq\QET _{P_1\land P_2}$
  beweisen wurden unter der Voraussetzung, dass $\QET _S\subseteq \QET _1$ und
  $\QET _S\subseteq \QET _2$ gilt. Auch der Satz~\ref{FehlerConjSatz} wird im
  laufe des Beweises benötigt werden, dies ist zulässig, da \QRel{} eine
  Verfeinerung der Fehler"=Relation \ERel{} ist.\\
  Für ein beliebiges $w\in \QET _S$ gilt $w\in\QET _1\cap \QET _2$. Da \QET{}
  die Vereinigung einiger Trace"=Mengen ist, müssen gibt es unterschiedliche
  Fälle für das Wort $w$.
  \begin{itemize}
    \item Fall 1 ($w\in\ET _1\cap \ET _2$): Durch den Beweis von
      Satz~\ref{FehlerConjSatz} folgt in diesem Fall $w\in\ET _{P_1\land P_2}
      \subseteq \QET _{P_1\land P_2}$.
    \item Fall 2 ($w\in\StQT _1\backslash\ET _1\cap \ET _2$ oder $w\in\ET _1
      \cap \StQT _2\backslash\ET _2$): Durch die Kommutativität der Konjunktion
      kann man sich in diesem Fall \oBdA{} auf $w\in\StQT _1\backslash\ET
      _1\cap \ET _2$ einschränken. Es gibt in $P_1$ einen Ablauf für das Wort
      $w$, der zu einem Zustand führt, der keine ausgehenden must"=Transitionen
      für lokale Aktionen besitzt. Für $w\in\ET _2$ gibt es jedoch
      unterschiedliche Fälle.
      \\ \TODO{Behandlung lokaler Aktionen in der Konjunktions-Definition ähnlich zu \MIT{}-Traces anpassen}
      \begin{itemize}
        \item Fall 2a) ($w\in\cont (\PrET _2)$): Es ist ein mit $w$
          beschrifteter Trace in $P_2$ ausführbar, der zum Zustand $e_2$ führt.
          $e_2$ hat für alle Output"=Aktionen eine must"=Schleife zu sich
          selbst.
          \TODO{Argumentation nach Anpassung der Definition beenden}
        \item Fall 2b) ($w\in\cont (\MIT _2)$): Es gibt ein echtes Präfix $v$
          von $w$, dass in $P_2$ ausführbar ist zu einem Zustand, der für einen
          Input $a$ keine ausgehende must"=Transition besitzt. $va$ muss dabei
          ein Präfix von $w$ sein. Da $w$ kein Element von $\ET _1$ ist, muss
          $P_1$ nach dem Wort $v$ den Input $a$ via einer must"=Transition
          sicherstellen. Es kommt also die Regel (IMust2) aus der
          Definition~\ref{FehlerConjDef} in der Konjunktion aus dieser Stelle
          zum Einsatz. Dadurch wird in der Komponente $P_2$ der Zustand $e_2$
          erreicht. Der Rest der Argumentation verläuft analog zu Fall 2a).
      \end{itemize}
    \item Fall 3 ($w\in\StQT _1\backslash\ET _1\cap \StQT _2\backslash\ET _2$):
      In $P_1$ und $P_2$ gibt es einen Ablauf für das Wort $w$, dass einen
      stillen Zustand erreicht. Der Zustand, der aus diesem beiden Zuständen in
      Konjunktion entsteht, kann keine ausgehenden must"=Transitionen für
      Outputs oder die interne Aktion $\tau$ haben. Der Zustand muss also
      ebenfalls still sein. Die Transitionen, die für $w$ in $P_1$ und $P_2$
      verwendet werden, gibt es auch in der Konjunktion und durch dies
      Transitionen wird der stille Zustand erreicht. $w$ ist also ein strikter
      Stille"=Trace in $P_1\land P_2$. Es gilt also $w\in\StQT _{P_1\land P_2}
      \subseteq\QET _{P_1\land P_2}$.
  \end{itemize}

  \glqq $\Rightarrow$\grqq{}:\\
  Die Inklusionen $\QET _S\subseteq \QET _1$ und $\QET _S\subseteq \QET _2$
  müssen für diesen Punkt unter der Voraussetzung $S\QRel P_1\land P_2$
  beweisen werden. Es reicht wie in Satz~\ref{FehlerConjSatz} aus nur die
  Inklusion für $P_1$ zu begründen, da daraus mit der Kommutativität der
  Konjunktion auch die Inklusion für $P_2$ folgt.\\
  Sei $w$ beliebig aus $\QET _2$. $w$ muss auch in der Menge $\QET _{P_1\land
  P_2}$ enthalten sein. Falls $w\in\ET _{P_1\land P_2}$ gilt folgt mit
  Satz~\ref{FehlerConjSatz} $w\in\ET _1\subseteq\QET _1$. Somit müssen im
  folgenden nur noch $w$ aus der Menge $\StQT _{P_1\land P_2}\backslash\ET
  _{P_1\land P_2}$ betrachtet werden. Das $w$ ist in der Konjunktion von $P_1$
  und $P_2$ zu einem Zustand ausführbar, der still ist.
  \\ \TODO{Argumentation nach Veränderung der Definition beenden}
\end{proof}
