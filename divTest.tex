\section{Testing-Ansatz}

Für die \EIO{} aus z.B.~\cite{Schinko2016BA} sind divergente Zustände Zustände,
die eine unendliche Folge an $\tau$s ausführen können. Da die Definition für
Implementierung hier das gleiche liefern soll, müssen alle Zustände, die eine
unendliche Folge an $\tau$ Zuständen sicher Stellen müssen auf jeden Fall
divergent sein. Jedoch lassen bereits unendliche Folgen von
$\tau$-may-Transitionen Divergenz in einer ihrer as"=Implementierungen zu.
Somit erscheint es sinnvoll Zustände bereits als divergent anzusehen, wenn sie
die Möglichkeit für eine unendliche Folge von $\tau$s via may-Transitionen
besitzen. Die Korrektheit dieser Idee wird im folgenden nachgewiesen.

\begin{Def}[Divergenz]
  Ein \emph{Divergenz-Zustand} ist ein Zustand in einem \MEIO{} $P$, der via
  may-Transitionen eine unendliche Folge an $\tau$s ausführen kann.\\
  Die Menge $Div(P)$ besteht aus all diesen divergenten Zuständen des \MEIO{}s
  $P$.
\end{Def}

Die unendliche Folge an $\tau$s kann durch einen Kreis von Zuständen, die via
$\tau$-Transitionen verbunden sind, von einem durch interne Aktionen
erreichbaren Zustand ausführbar sein oder durch einen unendlichen Weg, der mit
$\tau$s ausführbar ist, der unendliche viele Zustände durchläuft. Es ist jedoch
zu beachten, dass ein Zustand, von dem aus unendlich viele Zustände durch
$\tau$s  erreichbar sind, nicht divergent sein muss. Es ist auch möglich,
dass dieser Zustand eine unendliche Verzweigung hat und somit keine unendlichen
Folgen an $\tau$s ausführen kann.\\
Für die Relevant eines Divergenz-Zustandes in einem Transitionssystem wieder
wieder der optimistische Ansatz der lokalen Erreichbarkeit. Auf
Implementierungen, die den \EIO{}s in z.B.~\cite{Schinko2016BA} entsprechen,
ist Divergenz nicht mehr verhinderbar, sobald ein divergenter Zustand lokal
erreichbar ist. Somit wird sich auch hier herausstellen, dass Divergenz als
ähnlich \glqq schlimm\grqq{} zu bewerten wie ein Fehler-Zustand.

\begin{Def}[Test und Verfeinerung für Divergenz]
  \label{DivTestDef}
  Sei $P$ ein \MEIO{}.\\
  $P$ ist \emph{lokal fehler-}, \emph{stillstand-} und \emph{divergenz-frei},
  wenn kein Fehler-, stiller oder Divergenz-Zustand lokal erreichbar ist.\\
  Ein \emph{Test} $T$ für $P$ ist eine zu $P$ komponierbare Implementierung.
  $P$ \emph{as-erfüllt} $T$ als einen Divergenz-Test, falls $S\|T$ lokal
  fehler-, stillstand- und divergenz-frei ist für alle $S\in \asimp (P)$. Es
  wird dann $P\DsatAs T$ geschrieben.\\
  Ein \MEIO{} $P$ \emph{Divergenz-verfeinert} $P'$, falls sie die selbe
  Signatur haben und für alle ihre Tests $T$: $P'\DsatAs T \Rightarrow P\DsatAs
  T$.
\end{Def}

Da nun die grundlegenden Definitionen für Divergenz festgehalten sind, kann man
sich einen Begriff für die Traces zu divergenten Zuständen bilden. Im letzten
Absatz wurde bereits festgestellt, dass Divergenz wohl als ähnlich \glqq
schlimmes\grqq{} Fehlverhalten anzusehen ist wie Fehler. Da das Divergieren
eines Systems nicht mehr verhinderbar ist, sobald ein divergenter Zustand lokal
erreichbar ist, kommt für die Divergenz-Traces wieder die \prune{} und
letztlich auch die \cont{}-Funktion zum Einsatz. Ein System, das unendliche
viele $\tau$s ausführen kann, ist von außen nicht von so einem System zu
unterscheiden, das einen Fehler-Zustand erreicht. Somit wird später semantisch
in den Trace-Mengen auch nicht zwischen Fehler"=Traces und Divergenz"=Traces
explizit unterschieden. Dadurch genügt es nicht mehr nur mit den Fehler"=Traces
die Sprache zu fluten, sondern es muss sowohl mit den Fehler"=Traces wie auch
den Divergenz"=Traces geflutet werden. Ebenso werden die strikten
Stille"=Traces mit diesen beiden Trace-Mengen geflutet.

\begin{Def}[Divergenz-Traces]
  Sei $P$ ein \MEIO{} und definiere:
  \begin{itemize}
    \item \emph{strikte Divergenz-Traces}: $\StDT (P) := \left\{w\in\Sigma
      ^*\mid p_0\weakmay[w]_P p\in Div(P)\right\}$,
    \item \emph{gekürzte Divergenz-Traces}: $\PrDT (P) := \left\{\prune (w)\mid
      w\in\StDT (P)\right\}$.
  \end{itemize}
\end{Def}

Analog zu den Propositionen~\ref{KommTracesProp} und~\ref{StilleTraceProp} gibt
es hier auch eine Proposition, die die Divergenz-Traces eines \MEIO{}s mit den
Divergenz-Traces seiner as"=Implementierungen verbindet. Die Begründung
verläuft analog zu den Propositionen der vorangegangenen Kapitel.

\begin{Prop}[Divergenz-Traces und Implementierungen]
  \label{DivTraceProp}
  Sei $P$ ein \MEIO{}.
  \begin{enumerate}
    \item Für die strikten Divergenz-Traces gilt: $\StDT (P) \subseteq
      \underset{P'\in\asimp (P)}{\bigcup} \StDT (P')$.
    \item Für die gekürzten Divergenz-Traces von $P$ gilt:
      $\PrDT (P) \subseteq \underset{P'\in\asimp (P)}{\bigcup} \PrDT (P')$.
  \end{enumerate}
\end{Prop}
\begin{proof}\mbox{}
  \begin{enumerate}
    \item Um diese Inklusion beweisen zu können wird wieder eine
      as"=Implementierung $P'$ von $P$ und eine passende
      as"=Verfeinerungs"=Relation $\mathcal{R}$ angegeben, so dass alle
      strikten Divergenz-Traces von $P$ auch in $P'$ enthalten sind. In diesem
      Fall funktioniert der Ansatz alle Traces aus $P$ in $P'$ zu
      implementieren und keine Fehler-Zustände zu übernehmen. Die Definition
      von $P'$ lautet also:
      \begin{itemize}
        \item $P'=P$,
        \item $p'_0=p_0$,
        \item $I_{P'}=I_P$ und $O_{P'}=O_P$,
        \item $\must _{P'} =\may _{P'} = \may _P$,
        \item $E_{P'}=\emptyset$.
      \end{itemize}
      Die passende as"=Verfeinerungs"=Relation $\mathcal{R}$ ist die
      Identität-Relation. Wie bereits im Beweis zu Proposition~\ref{LImpProp}
      begründet erfüllt $\mathcal{R}$ alle Punkte der Definition~\ref{SimDef}.
      Es wird ein $w$ aus $\StDT (P)$ betrachtet. Es gibt also einen unendliche
      Ablauf in $P$ auf einem endlichen Anfangsstück dieses Ablaufes wird das
      Wort $w$ ausgeführt, danach werden nur noch $\tau$-Transitionen
      ausgeführt. Es gilt also $\exists w' \in \Sigma _{\tau}^*, \exists
      \alpha _1, \alpha _2, \dots , \alpha _n, \exists p_1, p_2, \dots , p_n:
      \hat{w'} = w \land w' = \alpha _1\alpha _2\dots\alpha _n \land p_0
      \may[\alpha _1]_P p_1 \may[\alpha _2]_P \dots p_{n-1} \may[\alpha _n]_P
      p_n \in Div _P$. Nach $p_n$ kann der Trace durch eine unendliche
      $\tau$-Folge fortgesetzt werden. Die Identitäts"=Relation $\mathcal{R}$
      setzt die Zustände des Traces mit den analogen Zuständen aus $P'$ in
      Relation. Mit der Implementierung aller Transitionen aus $P$
      in $P'$ ergibt sich der selbe Trace in $P'$. Es gilt also $p'_0
      \may[\alpha _1]_{P'} p'_1 \may[\alpha _2]_{P'} \dots p'_{n-1} \may[\alpha
      _n]_{P'} p'_n$ mit $(p'_j,p_j) \in \mathcal{R}$ für $0\leq j \leq n$. Da
      alle Transitionen von $P$ in $P'$ übernommen wurden hat $p'_n$ ebenso wie
      $p_n$ die Möglichkeit eine unendliche Folge an $\tau$s auszuführen. $P'$
      kann also den analogen unendliche Ablauf zu $P$ ausführen. Es gilt also
      $p'_n\in Div _{P'}$ und somit $w\in \StDT (P')$. Insgesamt folgt also für
      diese $P'$ $\StDT (P) = \StDT (P')$.
    \item Dieser Punkt entspricht 1.\ bis auf die Anwendung der
      \prune{}-Funktion auf beiden Seiten des Inklusions-Symbols. Da $\prune{}$
      monoton ist, folgt dieser Punkt direkt auf dem letzten.
  \end{enumerate}
\end{proof}

Da die Stille"=Traces mit den Fehler- und Divergenz"=Traces geflutet werden
sollen, kann die Stillstands"=Semantik nicht aus dem letzten Kapitel übernommen
werden. Auch die geflutete Sprache aus dem Fehler-Kapitel kann nicht
beibehalten werden. Nur die Fehler"=Traces \ET{} können ohne Veränderung auch
in diesem Kapitel verwendet werden. Jedoch werden diese Traces im weiteren
Verlauf nur innerhalb der größeren Trace-Menge \EDT{} relevant sein.

\begin{Def}[Kommunikationsfehler-, Stillstands- und Divergenz-Semantik]
  \label{DivSemDef}
  Sei $P$ ein \MEIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Divergenz-Traces} von $P$ ist $\DT (P) := \cont
      (\PrDT (P))$.
    \item Die Menge der \emph{Fehler-Divergenz-Traces} von $P$ ist $\EDT (P) :=
      \ET (P)\cup\DT (P)$.
    \item Die Menge der \emph{Fehler-Divergenz-gefluteten
      Stille-Traces} von $P$ ist $\QDT (P) := \StQT (P)\cup\EDT (P)$.
    \item Die Menge der \emph{Fehler-Divergenz-gefluteten
      Sprache} von $P$ ist $\EDL (P) := L(P)\cup\EDT (P)$.
  \end{itemize}
  Für zwei \MEIO{}s $P_1,P_2$ mit der gleichen Signatur schreibt man $P_1\DRel
  P_2$, wenn $\EDT _1\subseteq \EDT _2, \QDT _1\subseteq \QDT _2$ und $\EDL
  _1\subseteq \EDL _2$ gilt.
\end{Def}

\vspace{0.2cm}

\begin{Prop}[Kommunikationsfehler-, Stillstands-, Divergenz-Semantik und
  Implementierungen]
  \label{DivSemProp}
  Sie $P$ ein \MEIO{}.
  \begin{enumerate}
    \item Für die Menge der Divergenz-Traces von $P$ gilt $\DT (P) \subseteq
      \underset{P'\in\asimp (P)}{\bigcup} \DT (P')$.
    \item Für die Menge der Fehler-Divergenz-Traces von $P$ gilt die folgende
      Gleichheit $\EDT (P) = \underset{P'\in\asimp (P)}{\bigcup} \EDT (P')$.
    \item Für die Menge der Fehler-Divergenz-gefluteten Stille-Traces von $P$
      gilt $\QDT (P) = \underset{P'\in\asimp (P)}{\bigcup} \QDT (P')$.
    \item Für die Menge der Fehler-Divergenz-gefluteten Sprache von $P$ gilt
      $\EDL (P) = \underset{P'\in\asimp (P)}{\bigcup} \EDL (P')$.
  \end{enumerate}
\end{Prop}
\begin{proof}\mbox{}\\
  1.:\\
  Es gilt bereits $\PrDT (P) \subseteq \underset{P'\in\asimp (P)}{\bigcup}
  \PrDT (P')$, wegen 2.\ der Proposition~\ref{DivTraceProp}. Aus der Monotonie
  von \cont{} folgt also auch die hier geforderte Inklusion.

  2. \glqq$\subseteq$\grqq{}:
  {\allowdisplaybreaks
  \begin{align*}
    \EDT (P)&\overset{\ref{DivSemDef}}{=} \ET (P)\cup \DT (P)\\
    &\hspace{-0.2cm}\overset{\ref{KommSemProp}.1}{=} \left(\underset{P'\in
    \asimp (P)}{\bigcup} \ET (P')\right)\cup \DT (P)\\
    &\overset{1.}{\subseteq} \left(\underset{P'\in
    \asimp (P)}{\bigcup} \ET (P')\right)\cup \left(\underset{P'\in \asimp
    (P)}{\bigcup} \DT (P')\right)\\
    &= \underset{P'\in \asimp (P)}{\bigcup} \ET (P') \cup \DT (P')\\
    &\overset{\ref{DivSemDef}}{=} \underset{P'\in\asimp (P)}{\bigcup} \EDT
    (P').
  \end{align*}}

  2. \glqq$\supseteq$\grqq{}:\\
  Für ein präfix-minimales $w$ aus der Menge $\EDT (P')$ einer
  as"=Implementierung $P'$ von $P$ wird für diese Inklusion gezeigt, dass auch
  $w\in\EDT (P)$ gilt. Es genügt ein präfix-minimales Element, da die
  \EDT{}-Mengen unter \cont{} abgeschlossen sind. Falls das $w$ in $\ET (P')$
  enthalten ist, folgt $w\in\ET (P) \subseteq\EDT (P)$ aufgrund des ersten
  Punktes der Proposition~\ref{KommSemProp}. Es ist also nur noch der Fall zu
  betrachten, in dem $w\in\DT (P') \backslash \ET (P')$ gilt. Es gibt also
  einen unendlichen Ablauf analog zu dem in Lemma~\ref{AblaefeVerfSpezLem}
  thematisierten für $wv\in\StDT _P'$ mit $v\in O^*$, wobei nur endlich viele
  Transitionen benötigt werden bis die letzte sichtbare Aktion aus $wv$
  ausgeführt wird und danach unendlich viele $\tau$-Transitionen folgen.
  Zwischen $P'$ und $P$ soll $\mathcal{R}$ als as"=Verfeinerungs"=Relationen
  gelten. Falls in dem matchenden Ablauf in $P$ ein Fehler-Zustand erreicht
  wird, muss nach Lemma~\ref{AblaefeVerfSpezLem} ein Präfix von $wv$ in $\StET
  _P$ enthalten sein. Mit $w=\prune (wv)$ folgt somit $w\in \ET _P \subseteq
  \EDT_P$. Falls in $P$ jedoch ein mit $wv$ beschrifteter Trace ausführbar ist
  und kein mit $wv$ beschrifteter Trace oder ein Präfix davon einen
  Fehler"=Zustand erreicht, muss es ein $p_j$ in $P$ geben, dass durch einen
  $wv$-Trace in $P$ erreicht wird und das mit einem $p'_j$ in der Relation
  $\mathcal{R}$ steht, dass in dem unendlichen Ablauf von $P'$ nach der letzten
  sichtbaren Aktion auftritt. $p'_j$ ist also ein divergenter Zustand für $P'$
  für den es einen unendlichen Ablauf gibt, der nur $\tau$-Transitionen enthält
  und es gilt $p'_j\mathcal{R} p_j$. Mit den Anmerkungen zu unendlichen
  Abläufen in Lemma~\ref{AblaefeVerfSpezLem} muss $P$ diesen unendlichen Ablauf
  von $\tau$s von $p_j$ aus matchen können. Es gilt also $p_j\in Div _P$ und
  somit $wv\in\StDT (P)$. Mit $w=\prune (wv)$ folgt $w\in\PrDT (P) \subseteq
  \EDT (P)$.

  3. \glqq$\subseteq$\grqq{}:
  {\allowdisplaybreaks
  \begin{align*}
    \QDT (P)&\overset{\ref{DivSemDef}}{=} \StQT (P)\cup \EDT (P)\\
    &\overset{\ref{StilleTraceProp}}{\subseteq} \left(\underset{P'\in \asimp
    (P)}{\bigcup} \StQT (P')\right)\cup \EDT (P)\\
    &\overset{2.}{=} \left(\underset{P'\in \asimp (P)}{\bigcup} \StQT
    (P')\right)\cup \left(\underset{P'\in \asimp (P)}{\bigcup} \EDT
    (P')\right)\\
    &= \underset{P'\in \asimp (P)}{\bigcup} \StQT (P') \cup \EDT (P')\\
    &\overset{\ref{DivSemDef}}{=} \underset{P'\in\asimp (P)}{\bigcup} \QDT
    (P').
  \end{align*}}

  3. \glqq$\supseteq$\grqq{}:\\
  Dieser Beweis verläuft analog zu dem Beweis von \glqq$\supseteq$\grqq{} der
  Proposition~\ref{StilleSemProp}, man muss nur die \ET{}-Mengen durch
  \EDT{}-Mengen ersetzten und für den Fall $w\in\EDT (P')$ folgt $w\in\EDT (P)$
  wegen des zweiten Punktes dieser Proposition und nicht wegen
  Proposition~\ref{KommSemProp}.

  4. \glqq$\subseteq$\grqq{}:
  {\allowdisplaybreaks
  \begin{align*}
    \EDL (P)&\overset{\ref{DivSemDef}}{=} L (P)\cup \EDT (P)\\
    &\overset{\ref{LImpProp}}{\subseteq} \left(\underset{P'\in \asimp
    (P)}{\bigcup} L (P')\right) \cup \EDT (P)\\
    &\overset{2.}{=} \left(\underset{P'\in \asimp (P)}{\bigcup} L (P')\right)
    \cup \left(\underset{P'\in \asimp (P)}{\bigcup} \EDT (P')\right)\\
    &= \underset{P'\in \asimp (P)}{\bigcup} L (P') \cup \EDT (P')\\
    &\overset{\ref{DivSemDef}}{=} \underset{P'\in\asimp (P)}{\bigcup} \EDL
    (P').
  \end{align*}}

  4. \glqq$\supseteq$\grqq{}:\\
  Für den Beweis dieser Inklusion kann man auf den Beweis
  von~\ref{KommSemProp}.2~\glqq$\supseteq$\grqq{} zurück greifen. Es müssen
  wie bei 3.\ nur die \ET{}-Mengen durch \EDT{}-Mengen ersetzt werden und die
  Einschränkung auf die geflutete Sprache ohne die Menge \EDT{} ist möglich
  wegen des zweiten Punktes der aktuellen Proposition.
\end{proof}

Es fällt auf, dass für Proposition~\ref{DivSemProp}.1 nicht die Gleichheit
sondern nur eine Inklusions-Richtung behauptet und bewiesen wird. Dies liegt
daran, dass die andere Richtung im allgemeinen nicht gilt. Die Menge \DT{} ist
zwar unter \cont{} abgeschlossen, jedoch werden darin keine Fehler"=Traces
betrachtet. Es kann also das bereis erwähnte Problem auftretten, dass die
Spezifikation einen Fehler besitzt und die as"=Implementierung kann sobald sie
einen Zustand mit diesem Fehler"=Zustand in Relation setzt beliebiges tun kann.
Ein Gegenbeispiel, in dem dieses Problem verdeutlich wird, ist in
Abbildung~\ref{DTAsimpInDTGegenBsp} dargestellt. Eine
as"=Verfeinerungs"=Relation zwischen $P'$ und $P$ ist $\mathcal{R} =
\{(p'_0,p_0)\}$. Die Definition~\ref{SimDef} stellt an $\mathcal{R}$ keine
Forderungen, da $p_0\in E_P$ gilt. $P'$ ist also eine as"=Implementierung von
$P$. Die Menge $\DT (P)$ ist leer, jedoch entspricht die Menge $\DT (P')$ der
Menge $\Sigma ^*$.

\begin{figure}[htbp]
  \begin{center}
    \begin{tikzpicture}[->, >=latex', auto,node distance=2.5cm, semithick]
      \node [initial,initial text=$P'$:, rectangle, draw, dashed] (p'0) at
      (0,0) {$p'_0 \in Div _{P'}$};

      \path
      (p'0) edge[loop right] node{$\tau$} (p'0)
      ;

      \node [initial,initial text=$P$:, rectangle, draw] (p0) at (8,0) {$p_0
      \in E_P$};
    \end{tikzpicture}
    \caption{Gegenbeispiel zu $\underset{P'\in\asimp (P)} \DT (P') \subseteq
    \DT (P)$}
    \label{DTAsimpInDTGegenBsp}
  \end{center}
\end{figure}

Aus der so eben bewiesenen Proposition über die Gleichheit der betrachteten
Traces, lässt sich wie in den letzten beiden Kapiteln eine Aussage über die
lokale Erreichbarkeit der fehlerhaften Zustände in einer Spezifikation und den
zugehörigen as"=Implementierungen treffen.

\begin{Kor}[lokale Divergenz Erreichbarkeit]\mbox{}
  \label{lokalDivErrKor}
  \begin{enumerate}[(i)]
    \item Falls in einem \MEIO{} $P$ ein Fehler lokal erreichbar ist, dann
      existiert auch eine as"=Implementierung, in der ein Fehler lokal
      erreichbar ist.
    \item Falls in einem \MEIO{} $P$ Divergenz lokal erreichbar ist, dann
      existiert auch eine as"=Implementierung, in der Divergenz lokal
      erreichbar ist.
    \item Falls ein \MEIO{} $P$ einen lokal erreichbaren stillen Zustand
      besitzt, dann existiert auch eine as"=Implementierung, in der ein stiller
      Zustand lokal erreichbar ist.
    \item Falls es eine as"=Implementierung von $P$ gibt, die Fehler, Stille
      oder Divergenz lokal erreicht, dann ist auch Fehler, Stille oder
      Divergenz in $P$ lokal erreichbar.
  \end{enumerate}
\end{Kor}
\begin{proof}\mbox{}
  \begin{enumerate}[(i)]
    \item Dieser Punkt folgt wie in~\ref{lokaleStilleErrKor} direkt aus
      Korollar~\ref{lokalFehlerErrKor}~(i).
    \item Ein divergenter Zustand ist in $P$ lokal erreichbar, wenn
      $\varepsilon \in \DT _P$ gilt. Mit~\ref{DivSemProp}.1 folgt daraus, dass
      es auch mindestens eine as"=Implementierung $P'$ aus $\asimp (P)$ geben
      muss, für die $\varepsilon$ in $\DT (P')$ enthalten ist. Da \DT{} die
      Menge der fortgesetzten um lokale Aktionen gekürzten strikten
      Divergenz-Traces ist, muss es lokale Aktionen in $P'$ geben, die zu einem
      divergenten Zustand führen. Es ist also auch in $P'$ Divergenz lokal
      erreichbar.
    \item Dieser Punkt folgt direkt aus Korollar~\ref{lokaleStilleErrKor}~(ii).
    \item In $P'\in\asimp (P)$ sei ein Fehler-, stillen oder Divergenz-Zustand
      lokal erreichbar. Es gilt dann $w\in\QDT _{P'}$ für $w\in O^*$. Mit
      Proposition~\ref{DivSemProp}.3 gilt auch $w\in\QDT _P$ Die Menge \QDT{}
      setzt sich aus den Mengen \ET{}, \StQT{} und \DT{} zusammen. Es muss also
      in $P$ ein Fehler-, stiller oder Divergenz-Zustand lokal erreichbar sein,
      da ein $w$, bestehend nur aus lokalen Aktionen, in $\QDT _P$ enthalten
      ist.
  \end{enumerate}
\end{proof}

Die Relation \DRel{} ist somit keine Einschränkung von \ERel{} so wie \QRel{}.
Diese Tatsache wird später im Satz~\ref{ZusammenhDivSatz} durch die Beispiele,
wieso diese Relationen unvergleichbar sind noch einmal verdeutlicht.
Es können Systeme mit einem Fehler nicht von Systemen mit Divergenz
unterschieden werden. Da die Divergenz-Test zwischen diesen \glqq
Fehler-Arten\grqq{} auch keine Unterscheidung machen, muss eine sinnvolle
Relation dies Eigenschaft auch übernehmen, so wie \DRel{} dies tut.

\begin{Satz}[Kommunikationsfehler-, Stillstands- und Divergenz-Semantik für
  Parallelkompositionen]
  \label{DivSemSatz}
  Für zwei komponierbare \MEIO{}s $P_1,P_2$ und ihre Komposition $P_{12}$ gilt:
  \begin{enumerate}
    \item $\EDT _{12} =\cont (\prune ((\EDT _1\|\EDL _2)\cup (\EDL _1\|\EDT
      _2)))$,
    \item $\QDT _{12} =(\QDT _1\|\QDT _2)\cup \EDT _{12}$,
    \item $\EDL _{12} =(\EDL _1\|\EDL _2)\cup \EDT _{12}$.
  \end{enumerate}
\end{Satz}

Man könnte diesen Satz analog zu den Sätzen~\ref{KommFehlerSemSatz}
und~\ref{StilleSemSatz} durch die Mengen-Inklusionen in beide Richtungen
beweisen. Alternativ kann man jedoch alle beteiligen \MEIO{}s Normieren, so
dass sie divergenz-trivial sind, in dem Sinne, dass die \MEIO{}s keinen
divergenten Zustand mehr enthalten, der nicht auf in der Menge der
Fehler"=Zustände enthalten ist. In für einen \MEIO{}, für den $Div\subseteq E$,
gilt $\EDT = \ET$, $\QDT = \QET$ und $\EDL = \EL$. Es wäre als der
Satz~\ref{StilleSemSatz} anwendbar für die Traces der Parallelkomposition. Es
wäre dann nur noch zu zeigen, dass die Parallelkomposition von zwei in dieser
Art normierten \MEIO{}s die Normierung der Parallelkomposition ihrer
unnormierten \MEIO{}-Versionen ist.

\begin{Def}[Normierung zur Divergenz-Trivialität]
  \label{DivNormDef}
  Ein \MEIO{} $P$ ist \emph{divergenz-trivial}, wenn $Div _P \subseteq E_P$
  gilt.\\
  Die divergenz-trivial Form von $P$ ist ein \MEIO{} $\DF (P)$, das man aus $P$
  erhält, in dem man die Menge der Fehler"=Zustände $E_{\DF (P)}$ als die Menge
  $E_P \cup Div _P$ definiert.
\end{Def}

Die Menge $\MIT _P$, $\StQT _P$ und $L_P$ eines \MEIO{} $P$ bleiben durch die
Konstruktion in~\ref{DivNormDef} zur divergenz-trivialen Form $\DF (P)$
unverändert. Nur die Menge $\cont (\PrET _P)$ wird zur Menge $\cont (\PrET
_{\DF (P)})$ erweitert, in dem eine Vereinigung mit $\DT _P$ vorgenommen wird.
Semantisch ist jedoch nur die Trace-Menge \EDT{} relevant, die bereits die
Vereinigung der Mengen \ET{} und $\DT{}$ ist. Die Mengen \QDT{} und \EDL{}
werden für beide \MEIO{}s mit der Trace Menge \EDT{} geflutet, somit gilt für
alle in der Semantik der Relation \DRel{} relevanten Traces die Gleichheit
zwischen den Traces des \MEIO{}s $P$ und seiner divergenz-trivialen Form $\DF
(P)$.

\begin{Prop}[Divergenz-Trivialität]
  \label{DivNormProp}
  Jedes \MEIO{} $P$ ist äquivalent zu seiner divergenz-trivialen Form $\DF (P)$
  bezüglich der Relation \DRel{}.
\end{Prop}

Wie schon oben erwähnt, sollen die Trace aus Satz~\ref{DivSemSatz} auf die des
Satz~\ref{StilleSemSatz} zurück geführt werden durch die Normierung Systeme in
divergenz-trivialer Form. Damit dies möglich ist, müssen die betrachteten
Trace-Mengen gleich sein. Dies ist erfüllt, wenn die Relationen äquivalent sind
unter der Voraussetzung, dass die Systeme divergenz-trivial sind.

\begin{Lem}[Relationen unter Divergenz-Trivialität]
  Für zwei \MEIO{}s $P$ und $Q$ in divergenz-trivialer Form gilt: $P \DRel Q
  \Leftrightarrow P \QRel Q$.
\end{Lem}
\begin{proof}
  Da für einen \MEIO{} $P$ in divergenz-trivialer Form $Div _P \subseteq E _P$
  gilt, ist jeder strikte Divergenz-Trace von $P$ auch ein strikter
  Fehler-Trace von $P$. Auf beide Trace-Mengen wird die Kürzungs-Funktion
  \prune{} und danach die Verlängerungs"=Funktion \cont{} angewendet. In $\EDT
  _P$ führt die Erweiterung der Menge $\ET _P$ um die Menge $\DT _P$ somit zu
  keiner Vergrößerung. Es gilt also $\EDT _P = \ET _P$. Die Menge $\StQT _P$
  und $L _P$ werden im Fall \DRel{} mit der Menge $\EDT _P$ und im Fall \QRel{}
  mit der Menge $\ET _P$ geflutet. Da die Mengen mit denen geflutet wird gleich
  sind, gilt auch $\QDT _P = \QET _P$ und $\EDL _P = \EL _P$. Die Mengen
  Gleichheiten gelten analog auch für $Q$. Da die Mengen für die Inklusionen,
  die die Relationen \DRel{} und \QRel{} fordern, gleich sind, sind auch die
  Relationen äquivalent für \MEIO{}s in divergenz-trivialer Form.
\end{proof}

\begin{Lem}[Divergenz-Trivialität und Parallelkomposition]
  \label{DivFreiParallelLem}
  Die Parallelkomposition $P_{12} = P_1\|P_2$ zweier \MEIO{}s $P_1$ und $P_2$
  in divergenz-trivialer Form ist ebenfalls in divergenz-trivialer Form.
\end{Lem}
\begin{proof}
  Es gilt $Div _j \subseteq E_j$ für beide $j\in\{1,2\}$. In einer
  Parallelkomposition entsteht ein Divergenz"=Zustand nur, wenn mindestens
  eine der beiden Komponenten bereits divergent war für den Zustand, der an der
  Komposition des neuen Zustandes beteiligt ist. $Div _{12}$ entspricht
  also der Menge $(Div _1 \times P_2) \cup (P_1 \times Div _2)$. Da geerbte
  Fehler"=Zustände in einer Parallelkomposition auch nur von einem der zu
  komponierenden Zustände geerbt werden müssen, gilt eine analoge Formel für
  die Menge der Fehler"=Zustände. Es folgt also $Div _{12} \subseteq E _{12}$.
  $P_{12}$ ist also auch in divergenz-trivialer Form.
\end{proof}

\begin{Lem}[Parallelkomposition und Divergenz-Trivialität]
  Für komponierbare \MEIO{}s $P_1$ und $P_2$ gilt $\DF (P_1\|P_2) = \DF (P_1)\|
  \DF (P_2)$.
\end{Lem}
\begin{proof}
  Die Normierung auf eine divergenz-triviale Form ändert nichts an den
  Transtionen des Systems. Stille Zustände und Zustände, die einen Input nicht
  sicher stellen bleiben also unverändert erhalten. Bezüglich dieser Art des
  Fehlverhaltens der Systeme kommutiert die Parallelkomposition mit der
  Normierungs"=Konstrunktion aus Definition~\ref{DivNormDef}. Man muss also nur
  noch nur noch vergleichen, dass die Fehler"=Zustände in $\DF (P_1\|P_2)$ und
  $\DF (P_1)\| \DF (P_2)$ übereinstimmen, da in beiden Systemen die
  Divergenz"=Zustände gleichzeitig auch Fehler"=Zustände sind wegen
  Lemma~\ref{DivFreiParallelLem}.

  $E_{\DF (P_1\|P_2)} \subseteq E_{\DF (P_1)\| \DF (P_2)}$:\\
  Sei $(p_1,p_2)$ ein beliebiger Fehler"=Zustand aus der Menge $E_{\DF
  (P_1\|P_2)}$. Dieser Zustand kann in $P_{12}$ ein geerbter Fehler, neuer
  Fehler oder divergenzter Zustand sein.
  \begin{itemize}
    \item Fall 1 ($(p_1,p_2)$ ist ein geerbter Fehler in $P_{12}$): \OBdA{} ist
      $p_1$ in $E_1$ enthalten. Mit der Konsturktion aus
      Definition~\ref{DivNormDef} gilt $p_1\in E_{\DF (P_1)}$. In der
      Parallelkomposition $\DF (P_1)\|\DF (P_2)$ ist $(p_1,p_2)$ ebenfalls ein
      geerbter Fehler.
    \item Fall 2 ($(p_1,p_2)$ ist ein neuer Fehler in $P_{12}$): \OBdA{} stellt
      $p_1$ einen Input nicht via must"=Transtion sicher, den $p_2$ in $P_2$
      also Output besitzt. Da an den Transtion durch die Normierung auf $\DF
      (P_1)$ und $\DF (P_2)$ die Transitionen unverändert bleiben. Kommt es
      zwischen $p_1$ und $p_2$ auch in der Parallelkomposition von $\DF (P_1)$
      und $\DF (P_2)$ zu einem neuen Fehler.
    \item Fall 3 ($(p_1,p_2)\in Div_{12}$): Damit $(p_1,p_2)$ ein divergenter
      Zustand ist, muss \oBdA{} $p_1$ in $P_1$ ein divergenter Zustand sein.
      Durch die Konstruktion der divergenz-trivialen Form, wird $p_1$ in die
      Menge $E_{\DF (P_1)}$ eingefügt. Der Zustand $(p_1,p_2)$ ist somit in
      $\DF (P_1)\|\DF (P_2)$ ein geerbter Fehler.
  \end{itemize}

  $E_{\DF (P_1)\| \DF (P_2)} \subseteq E_{\DF (P_1\|P_2)}$:\\
  Wähle einen belibigen Zustand $(p_1,p_2)$ aus der Menge $E_{\DF (P_1)\| \DF
  (P_2)}$. Es kann sich bei $(p_1,p_2)$ in $\DF (P_1)\| \DF (P_2)$ um einen
  geerbten oder neuen Fehler handeln.
  \begin{itemize}
    \item Fall 1 ($(p_1,p_2)$ geerbter Fehler in $\DF (P_1)\| \DF (P_2)$): Der
      Fehler ist \oBdA{} von $P_1$ geerbt worden. Es gilt also $p_1\in E_{\DF
      (P_1)}$. $p_1$ kann erst durch die Normierung zu einem Fehler"=Zustand
      geworden sein oder bereits davor in $E_1$ enthalten gewesen sein.
      \begin{itemize}
        \item Fall 1a) ($p_1\in E_1$): In $P_{12}$ ist $(p_1,p_2)$ ein geerbter
          Fehler. \TODO{fertig beweisen}
        \item Fall 1b) ($p_1\in Div_1$): \TODO{zu beweisen}
      \end{itemize}
    \item Fall 2 ($(p_1,p_2)$ neuer Fehler in $\DF (P_1)\| \DF (P_2)$):
      \TODO{zu beweisen}
  \end{itemize}
\end{proof}

\begin{proof}[Beweis zu Satz~\ref{DivSemSatz}]\mbox{}\\
  \TODO{Gleichheit zeigen und Trace Mengen wie auf Blatt}
  Durch Proposition~\ref{DivNormProp} kann man jeden \MEIO{} $P$ so normieren,
  dass er eine divergenz-triviale Form besitzt und das Ergebnis der Normierung
  äquivalent zu $P$ ist bezüglich der Relation \DRel{}. Für einen \MEIO{} $P$
  in divergenz-trivialer Form gilt jedoch $\EDT _P = \ET _P$, $\QDT _P = \QET
  _P$ und $\EDL _P = \EL _P$. Der hier zu beweisende Satz, würde als für
  \MEIO{}s in divergenz-trivialer Form dem Satz~\ref{StilleSemSatz} aus dem
  letzten Kapitel entsprechen. Jedoch soll der Satz in diesem Kapitel nicht auf
  \MEIO{}s in divergenz-trivialer Form eingeschränkt werden, sondern für alle
  \MEIO{}s gelten. Es ist also noch zu beweisen, dass $\DF (P_{12})$ äquivalent
  zu $\DF (P_1)\|\DF (P_2)$ ist bezüglich der Relation \DRel{} bzw.\ bezüglich
  der Relation \QRel{}, da die Parallelkomposition von zwei \MEIO{}s in
  divergenz-trivialer Form auch eine divergenz-triviale Form hat
  (Lemma~\ref{DivFreiParallelLem}). Die folgenden Punkte müssen für den
  Nachweis der Äquivalenz bewiesen werden:
  \begin{enumerate}[(i)]
    \item $\ET (\DF (P_{12})) = \ET (\DF (P_1)\|\DF (P_2))$,
    \item $\QET (\DF (P_{12})) = \QET (\DF (P_1)\|\DF (P_2))$,
    \item $\EL (\DF (P_{12})) = \EL (\DF (P_1)\|\DF (P_2))$.
  \end{enumerate}

  (i) \glqq $\subseteq$\grqq{}:\\
  Da die \ET{}-Mengen beide unter \cont{} abgeschlossen sind, kann man ein
  beliebiges präfix-minimales Element $w\in\ET (\DF (P_{12}))$ betrachten.
  Das $w$ kann ein Input-kritischer Trace sein oder ein gekürzter
  Fehler"=Trace. Der gekürzte Fehler"=Trace kann erst durch die Normierung auf
  ein System in divergenz-trivialer Form entstanden sein. Falls dies der Fall
  ist, galt vor der Normierung $w\in \PrDT _{12}$.
  \begin{itemize}
    \item Fall 1 ($w\in \ET _{12}$): Das Wort $w$ war vor der Normierung ein
      Input-kritischer Trace, der unveränder übernommen wurde oder ein
      geküzrter Fehler"=Trace. Mit Satz~\ref{KommFehlerSemSatz}.1 gilt $w\in
      \cont (\prune ((\ET _1\|\EL _2)\cup (\EL _1\|\ET _2)))$. Durch die
      Normierung können sich die Mengen \ET{} und \EL{} nicht verkleinern, sie
      können nur um die Divergenz"=Traces, die zu keinen Fehlern führen
      erweitert werden. Es gilt also $\ET _j \subseteq\ET _{\DF (P_j)}$ und
      $\EL _j \subseteq \EL _{\DF (P_j)}$ für $j\in \{1,2\}$. Daraus folgt
      $w\in \cont (\prune ((\ET _{\DF (P_1)}\|\EL _{\DF (P_2)})\cup (\EL _{\DF
      (P_1)}\|\ET _{\DF (P_2)})))$. Wegen Satz~\ref{KommFehlerSemSatz}.1 ist
      $w$ auch in der Menge der Fehler"=Traces von $\DF (P_1)\|\DF (P_2)$
      enthalten.
    \item Fall 2 ($w\in \PrDT _{12}$): Es gibt eine Verlängerung $v\in
      O_{12}$, des Wortes $w$, so dass $wv$ in $P_{12}$ zu einem divergenten
      Zustand führt. Damit der erreichte Zustand in der Parallelkomposition
      divergent ist, muss mindestens eines der Teilsysteme Divergenz an dem
      in der Komposition beteiligten Zustand aufweisen. Das andere System
      muss nur den auf sein Teilsystem projizierten Trace von $wv$ ausführen
      können. Die Ausführbarkeit von Traces kann durch die Normierung auf ein
      System in divergenz-triviales Form nicht verändert werden. Der
      divergenten Zustand des anderen Teilsystems wird jedoch in die Menge
      seiner Fehler"=Zustände aufgenommen durch die Normierung. In der
      Parallelkomposition $\DF (P_1)\|\DF (P_2)$ werden also ein Trace aus
      der Menge \ET{} des einen und aus der Menge $L$ des anderen Systems
      komponiert. Das Wort $wv$, dass dabei entsteht, ist somit in der Menge
      $\ET (\DF (P_1)\|\DF (P_2))$ enthalten. Da $v$ nur aus lokalen Aktionen
      besteht, gilt auch $w\in\ET (\DF (P_1)\|\DF (P_2))$.
  \end{itemize}

  (i) \glqq $\supseteq$\grqq{}:\\
  Es genügt auch für diese Inklusion ein präfix-minimales Element zu
  betrachten, da beide \ET{}-Mengen unter \cont{} abgeschlossen sind. Für ein
  präfix-minimales $w$ aus der Menge $\ET (\DF (P_1)\|\DF (P_2))$ gilt mit
  Satz~\ref{KommFehlerSemSatz}.1 $w\in \cont (\prune ((\ET _{\DF (P_1)}\|\EL
  _{\DF (P_2)})\cup (\EL _{\DF (P_1)}\|\ET _{\DF (P_2)})))$. Es gibt also
  eine Projektion des Wortes $w$ auf die einzelnen Systeme, so dass $w\in w_1\|
  w_2$ gilt mit $w_1\in\ET _{\DF (P_1)}$ bzw.\ $w_1\in\EL _{\DT (P_1)}$ und
  $w_2\in\EL _{\DF (P_2)}$ bzw.\ $w_2\in\ET _{\DT (P_2)}$. Da das $w$
  präfix-minimal ist in $\DF (P_1)\|\DF (P_2)$ sind die $w_j\in \EL _{\DF
  (P_j)}$ entweder ausführbar ($w_j\in L _{\DF (P_j)}$) oder in der Menge $\MIT
  _{\DF (P_j)}$ enthalten. Die Normierung auf ein System in divergenz-trivialer
  Form nichts an der Ausführbarkeit von Traces verändern kann. Falls das $w_j$
  für $j\in\{1,2\}$ in der Menge $\cont (\MIT _{\DF (P_j)})$ enthalten ist,
  gilt auch $w_j\in\cont (\MIT _j)$, da die Normierung der Systeme auf
  ihre divergenz-triviale Form die Input"=kritischen Trace unverändert lässt.
  Für die hier betrachten $w_j$ gilt $w_j\in \EL _j$, wenn nach der Normierung
  $w_j\in\EL _{\DF (P_j)}$. Es kommt also nur auf die Wörter $w_j$ in den
  \ET{}-Mengen an. Für $w_j\in\cont (\PrET _{\DF (P_j)})$ können jedoch zwei
  Fälle unterschieden werden. $w_j$ kann bereits von der Normierung ein Trace
  aus der Menge $\cont (\PrET _j)$ gewesen sein oder $w_j$ ist erst durch die
  Normierung zu einem fortgesetzten gekürzten Fehler-Trace geworden und es galt
  davor $\cont (\PrDT _j) = \DT _j$.
  \begin{itemize}
    \item Fall 1 ($w_j\in\ET _j$): In diesem Fall kann man
      Satz~\ref{KommFehlerSemSatz}.1 anwenden und es folgt $w\in\ET _{12}$ und
      nach der Anwendung der Konstruktion aus Definition~\ref{DivNormDef} gilt
      ebenfalls $w\in\ET _{\DF (P_{12})}$.
    \item Fall 2 ($w_j\in\DT _j$): \OBdA{} $j=1$. Das Präfix $v$ von $w_1$ führ
      einem divergenten Zustand in $P_1$, so dass $v$ in der Menge $\PrDT _1$
      enthalten ist. $w_2$ ist in der Menge $\EL _2$ enthalten. Wegen der
      präfix-Minimalität von $w$ ist die hier relevante Unterscheidung
      $w_2\in\MIT _2$ oder $w_2\in L_2$.
      \begin{itemize}
        \item Fall 2a) ($w_2\in\MIT _2$): Es kann durch die Synchronsation von
          $v$ mit $w_2$ zu einem neuen Fehler kommen. Dazu muss unterschieden
          werden, ob $v$ das $a$ enthält, dass $P_2$ am Ende des Traces $w_2$
          nicht ausführen kann. Es gibt also ein $v'\in\Sigma _2$, so dass
          $w_2=v'a$ gilt.
          \begin{itemize}
            \item Fall 2a)(i) ($a\notin O _1$): Es kann in der
              Parallelkomposition durch das $a$ zu keinem neuen Fehler kommen.
              Das Präfix des Wortes $w$, dass $v$ in $P_1$ komplett ausgeführt
              hat, erreicht einen divergenten Zustand. Wegen der
              Abgeschlossenheit unter \cont{} gilt $w\in\DT _{12}\subseteq \ET
              _{\DF (P_{12})}$.
            \item Fall 2a)(ii) ($a\in O_1$ und $|v|_{\Synch (P_1,P_2)}| =
              |w_2|_{\Synch (P_1,P_2)}|$): Um den divergenten Zustand in
              $P_{12}$ zu erreichen, müsste den Output $a$ am Ende von $v$ mit
              den nicht sichergesetllten Input am Ende von $w_2$ synchronisiert
              werden. Es kommt also in der Parallelkomposition von $v$ und
              $w_2$ zu einem neuen Fehler. Durch die Abgeschlossenheit
              gegenüber \cont{} gilt $w\in\ET _{12}\subseteq \ET _{\DF
              (P_{12})}$.
          \end{itemize}
        \item Fall 2b) ($w_2\in L_2$): In diesem Fall ist $w_2$ komplett
          ausführbar in $P_2$. Das Präfix $v$ von $w_1$ kann also mit einem
          Präfix von $w_2$ komponiert werden und ergibt ein Präfix von $w$. Das
          Präfix von $w$, dass sich ergibt, erreicht in der Parallelkomposition
          von $P_1$ und $P_2$ einem divergenten Zustand. Es folt wie in Fall
          2a(i) $w\in \DT _{12}\subseteq \ET _{\DF (P_{12})}$.
      \end{itemize}
  \end{itemize}

  (ii) \glqq $\subseteq$\grqq:\\
  Man kann diese Inklusion durch die bereits bewiesene Gleichheit der
  \ET{}-Mengen auf $\StQT (\DF (P_{12})) \backslash \ET (\DF (P_{12}))
  \subseteq\QET (\DF (P_1)\|\DF (P_2))$ einschränken. Für ein beliebiges $w$
  aus $\StQT (\DF (P_{12})) \backslash \ET (\DF (P_{12}))$ wird in $\DF
  (P_{12})$ durch diese Wort ein stille Zustand erreicht, der nicht in $E_{\DF
  (P_{12})}$ enthalten ist. Da die Konstruktion für die Normierung
  aus~\ref{DivNormDef} die Transitionen eines Systems unverändert lässt. Gilt
  auch für $P_{12}$ $w\in\StQT _{12}$. Die Menge der Fehler"=Zustände
  vergrößert sich nur durch die Konstruktion aus~\ref{DivNormDef}, der durch
  $w$ erreichte Zustand $(p_1,p_2)$ in $P_{12}$ ist also ebenfalls nur still
  und kein Fehler"=Zustand aus $E_{12}$. Mit Lemma~\ref{StilleZustLem}.2 folgt,
  dass $p_1$ und $p_2$ in ihrer jeweiligen Komponente ebenfalls stille Zustände
  sein müssen. Die Normierungen $\DF (P_1)$ und $\DF (P_2)$ enthalten die
  Zutände $p_1$ und $p_2$ immer noch als stille Zustände. Die Transitionen um
  diese Zustände zu erreichen verändern sich durch das Vergrößern der
  Fehler"=Menge nicht. Der Zustand $(p_1,p_2)$ wird in $\DF (P_1)\|\DF (P_2)$
  durch das Wort $w$ erreicht und besitzt wegen Lemma~\ref{StilleZustLem}.1
  keine ausgehenen must"=Transitionen für lokale Aktionen. Es gilt also $w\in
  \StQT _{\DF (P_1)\|\DF (P_2)}\subseteq\QET _{\DF (P_1)\|\DF (P_2)}$.

  (ii) \glqq $\supseteq$\grqq:\\
  Der Nachweis dieser Inklusion lässt sich durch die Aussage aus (i) auf den
  Beweis von $\StQT (\DF (P_1)\|\DF (P_2)) \backslash \ET (\DF (P_1)\|\DF
  (P_2)) \subseteq\QET (\DF (P_{12}))$ reduzieren. Ein beliebiges $w$ aus
  $\StQT (\DF (P_1)\|\DF (P_2)) \backslash \ET (\DF (P_1)\|\DF (P_2))$ ist die
  Beschriftung eines Ablaufes von $\DF (P_1)\|\DF (P_2)$, der zu $(p_1,p_2)\in
  Qui _{\DF (P_1)\|\DF (P_2)}\backslash E_{\DF (P_1)\|\DF (P_2)}$ führt. Die
  Zustände $p_1$ und $p_2$ in $\DF (P_1)$ bzw.\ $\DF (P_2)$ sind still durch
  Lemma~\ref{StilleZustLem}.2. Da die Konstruktion der Normierung auf
  divergenz-triviale Systeme in Definition~\ref{DivNormDef} jedoch keine
  Transitionen verändert, sondern nur die Zustands-Mengen $E$ erweitert, gilt
  sind $p_1$ und $p_2$ in $P_1$ und $P_2$ ebenfalls still und durch die selben
  Traces wie in den normierten Systemen erreichbar. Das Wort $w$ in $P_1\|P_2$
  erreicht den Zustand $(p_1,p_2)$, der still ist wegen
  Lemma~\ref{StilleZustLem}.1. Die Konstruktion aus Definition~\ref{DivNormDef}
  verhindert nicht die Erreichbarkeit des Zustandes $(p_1,p_2)$ und verändert
  auch nicht an den ausgehenden Transitionen dies Zustandes. Somit ist $w$ in
  $\StQT _{\DF (P_{12})}\subseteq\QET _{\DF (P_{12})}$ enthalten.

  (iii):
  Dieser Punkt könnte analog zum letzten Punkt durch die bereits bewiesenen
  Punkte durch eingeschränkte Inklusionen nachgewiesen werden, jedoch gilt hier
  bereits die Gleichheit für die eingeschränkten Trace-Mengen. Es wird also
  direkt $L (\DF (P_{12})) = L (\DF (P_1)\|\DF (P_2))$ begründet. Die
  Normierung auf Systeme die eine divergenz"=freie Form besitzten verändert die
  ausführbaren Traces nicht, da die Transitionen unverändert bleiben. Somit ist
  die Sprache vor und nach der Normierung gleich. Egal ob vor der
  Parallelkomposition normiert wurde oder erst nach der Komposition, die
  Traces, die in für die Systeme $\DF (P_{12})$ und $\DF (P_1)\|\DF (P_2)$
  ausführbar sind, stimmen überein.
\end{proof}

Analog wie in den beiden vorangegangenen Kapitel, ergibt sich aus diesem Satz
als direkte Folgerung, dass es sich bei der Relation \DRel{} um eine
Präkongruenz handelt. Der Beweis dafür ist analog zu den Beweisen der
Korollare~\ref{KommPraekonKor} und~\ref{StillePraekonKor} und soll deshalb hier
nicht wiederholt werden.

\begin{Kor}[Divergenz-Präkongruenz]
  Die Relation \DRel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{Kor}

Im nächsten Lemma soll eine Verfeinerung bezüglich guter Kommunikation
betrachtet werden. Die Vorgaben für gute Kommunikation gibt hierbei die
Definition der Tests und die daraus resultierende Verfeinerung
in~\ref{DivTestDef} vor. Es muss in diesem Lemma eine Veränderung zu den
analogen Lemmata aus den vorangegangenen Kapitel vorgenommen werden. Die
Einschränkung der Tests $T$ auf Partner, kann nicht mehr beibehalten werden, da
die Strategie zur Vermeidung von Stille im Beweis aus dem letzten Kapitel hier
zu Divergenz führen würde. Somit werden für die Stillstands-Vermeidung in
diesem Kapitel Aktionen außerhalb der Menge \Synch{} benötigt, die nicht die
interne Aktionen $\tau$ sind. Jedoch müssen trotzdem nicht alle Tests $T$
betrachtet werden. Es kann eine Einschränkung gemacht werden, sodass $T$ fast
ein Partner ist. Zur Vereinfachung von umständlichen Formulierungen im
Folgenden wird hierfür nun ein neuer Begriff definiert. Der jedoch auch bereits
so in z.B.~\cite{Schinko2016BA} analog für \EIO{}s verwendet und definiert
wurde.

\begin{Def}[{\boldmath$\chi$}-Partner]
  Ein \MEIO{} $P_1$ ist ein $\chi$-Partner von einem \MEIO{} $P_2$, wenn
  $I_1=O_2$ und $O_1=I_2\cup\{\chi\}$ mit $\chi\notin I_2\cup O_2$ gilt.
\end{Def}

Ein $\chi$-Partner $P_1$ von $P_2$ unterscheidet sich von einem Partner von
$P_2$ nur um den Output $\chi$, der nicht in der Menge $\Synch (P_1,P_2)$
enthalten ist.

\begin{Lem}[Testing-Verfeinerung mit Divergenz]
  \label{DivTestVerfeinLem}
  Gegeben sind zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur. Wenn
  für alle Tests $T$, die $\chi$-Partner von $P_1$ bzw. $P_2$ sind, $P_2
  \DsatAs T\Rightarrow P_1 \DsatAs T$ gilt, dann folgt daraus die Gültigkeit
  von $P_1\DRel P_2$.
\end{Lem}
\begin{proof}
  Da $P_1$ und $P_2$ die gleiche Signatur haben, definiert man $I:=I_1=I_2$ und
  $O:=O_1=O_2$. Für jeden $\chi$-Partner Test $T$ gilt $I_T=O$ und
  $O_T=I\cup\{\chi\}$ mit $\chi\notin I\cup O$.\\
  Um zu zeigen, dass die Relation $P_1\DRel P_2$ gilt, müssen die folgenden
  Punkte nachgewiesen werden:
  \begin{itemize}
    \item $\EDT _1\subseteq \EDT _2$,
    \item $\QDT _1\subseteq \QDT _2$,
    \item $\EDL _1\subseteq \EDL _2$.
  \end{itemize}
  In den Lemmata~\ref{KommTestVerfeinLem} und~\ref{StilleTestVerfeinLem} wurde
  bereits etwas Ähnliches gezeigt. Jedoch kann daraus aufgrund der
  unterschiedlichen Implikationen, die vorausgesetzt werden, nichts über dieses
  Lemma und dessen Gültigkeit ausgesagt werden. Es kann in diesem Lemma, ebenso
  wie im Lemma~\ref{StilleTestVerfeinLem}, aus der lokalen Erreichbarkeit eines
  Fehlers in einer Parallelkomposition einer as"=Implementierung von $P_1$ mit
  einem Test $T$ und der Implikation $P_2 \DsatAs T\Rightarrow P_1 \DsatAs T$
  nur geschlossen werden, dass es in einer Parallelkomposition einer
  as"=Implementierung von $P_2$ mit $T$ auch einen lokal erreichbaren
  fehlerhaften Zustand geben muss, jedoch kann die Fehlerhaftigkeit hier ein
  Fehler, Stille oder Divergenz sein. Analog verhält es sich, wenn in der
  Parallelkomposition einer as"=Implementierung von $P_1$ mit einem Test $T$
  ein Divergenz-Zustand oder stiller Zustand lokal erreichbar ist. Es kann nur
  geschlossen werden, dass $P_2$ den Test $T$ nicht erfüllen darf. Die nicht
  Erfüllung kann jedoch auf einem beliebigen Fehlverhalten des \MEIO{}s
  basieren.

  Als Erstes wird der erste Beweispunkt gezeigt, also die Inklusion $\EDT
  _1\subseteq\EDT _2$.\\
  Es wird für ein präfix-minimales $w$ aus $\EDT _1$ gezeigt, dass dieses $w$
  oder eines seiner Präfixe in $\EDT _2$ enthalten ist. Diese Möglichkeit
  bietet sich, da beide Mengen unter \cont{} abgeschlossen sind. Wegen
  Proposition~\ref{DivSemProp}.2 ist $w$ auch ein präfix-minimales Elemente
  der Menge $\EDT _{P'_1}$ einer as"=Implementierung $P'_1$ von $P_1$.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Fehler oder um lokale erreichbare Divergenz in $P'_1$. Für $T$ wird ein
      Transitionssysteme verwendet, das nur aus dem Startzustand und einer
      must"=Schleife für alle Inputs $x\in I_T$ und einer must"=Schleife für
      $\chi$ besteht. Somit kann $P'_1$ im Prinzip die gleichen Fehler- und
      Divergenz-Zustände wie $P'_1\|T$ lokal erreichen. $P_1$ erfüllt den Test
      $T$ nicht. $P_2$ darf $T$ somit auch nicht erfüllen. Es muss eine
      as"=Implementierung $P'_2$ von $P_2$ existieren, für die $P'_2\|T$ einen
      fehlerhaften Zustand lokal erreicht. Durch die Struktur von $T$ ist in
      einer Parallelkomposition mit $T$ kein stiller Zustand möglich. Der
      fehlerhafte Zustand, der in $P'_2\|T$ lokal erreichbar ist, muss also ein
      Fehler- oder Divergenz-Zustand sein. Da von $T$ kein Fehler und keine
      Divergenz geerbt werden kann und durch die Input"=Schleife auch kein
      neuer Fehler entstehen kann, muss der fehlerhafte Zustand von $P'_2$
      geerbt sein. Somit muss in $P'_2$ ein Fehler- oder Divergenz-Zustand
      lokal erreichbar sein. Da $\EDT (P) =\ET (P)\cup\DT (P)$ gilt, folgt
      $w\in \EDT _{P'_2}$ und mit~\ref{DivSemProp}.2 $w\in \EDT _2$.
    \item Fall 2 ($w=x_1\dots x_n x_{n+1}\in\Sigma ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I$): Es wird der folgende $\chi$-Partner $T$ betrachtet
      (siehe auch Abbildung~\ref{TohneEmitO}):
      \begin{itemize}
        \item $T=\{p_0,p_1,\dots ,p_{n+1}\}$,
        \item $p_{0T}=p_0$,
        \item $\begin{aligned}[t]
            \may _T = \must _T&=\{(p_j,x_{j+1},p_{j+1})\mid  0\leq j\leq n\}\\
            &\cup\{(p_j,x,p_{n+1})\mid  x\in I_T\backslash\{x_{j+1}\}, 0\leq
            j\leq n\}\\
            &\cup\{(p_{n+1},x,p_{n+1})\mid  x\in I_T\}\\
            &\cup\{(p_j,\chi ,p_{n+1})\mid 0\leq j\leq n+1\},
        \end{aligned}$
        \item $E_T=\emptyset$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[auto,node distance =3cm, semithick]
          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$p_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$p_{n+1}$};

          \path[line width=1pt] (dots) edge [loosely dotted] (n1);

          \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \chi
                    !$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, \chi !$} (n1)
                (dots) edge node {$x_n$} (n)
                (n) edge node [above, sloped] {$x?\in I_T, \chi !$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_T, \chi !$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_T\backslash\{x_j\}$}
      \label{TohneEmitO}
      \end{center}
      \end{figure}
      Die Mengen der Divergenz- und stillen Zustände des hier betrachteten $T$s
      sind leer. Da im Vergleich zum Transitionssystem in
      Abbildung~\ref{UohneE} nur die $\chi$-Transitionen zu $p_{n+1}$ ergänzt
      und die Mengen unbenannt wurden, ändert sich nichts an dem Fall 2a) im
      ersten Punkt des Beweises von Lemma~\ref{KommTestVerfeinLem}. Im Fall 2b)
      muss die Menge kann die Menge $O^*$ beibehalten werden, obwohl die
      Parallelkomposition mit $T$ auch $\chi$ also Output zulassen würde. Die
      Einschränkung, dass $u$ keine $\chi$ Transitionen enthalten darf,
      verhindert, dass $T$ unsynchronisierte Aktionen ausführt. $T$ kann jedoch
      trotzdem immer alle Aktionen, die $P'_1$ ausführen möchte
      synchronisieren. Die Begründungen, wieso in den beiden Fällen
      $\varepsilon \in\PrET (P'_1\|T)$ für ein $P'_1\in\asimp (P_1)$ gilt,
      bleibt also analog zum Beweis von Lemma~\ref{KommTestVerfeinLem}. Da nun
      aber auch Divergenz betrachtet wird, muss ein weiterer Fall ergänzt
      werden:
      \begin{itemize}
        \item Fall 2c) ($w\in\PrDT _{P'_1}$): In $P'_1\|T$ erhält man
          $(p_{01},p_0) \weakmay[w] (p'',p_{n+1})\weakmay[u] (p',p_{n+1})$ für
          $u\in O^*$ und $p'\in Div_1$. Die Einschränkung, dass $u$ keine
          Aktionen $\chi$ enthalten darf, ist mit der gleichen Begründung wie
          oben möglich. Daraus folgt $(p',p_{n+1})\in Div_{P'_1\|T}$ und somit
          $wu\in\StDT (P'_1\|T)$. Da alle Aktionen aus $w$ synchronisiert
          werden und $I_T\cap I=\emptyset$ gilt $x_1,\dots , x_n, x_{n+1}\in
          O_{P'_1\|T}$. Da zusätzlich $u$ in $O^*$ enthalten ist, folgt $u\in
          O^*_{P'_1\|T}$. Somit ergibt sich $\varepsilon\in\PrDT (P'_1\|T)$.
      \end{itemize}
      Da $\varepsilon$ in $\PrET (P'_1\|T) \cup \PrDT (P'_1\|T)$ enthalten ist,
      ist ein Fehler oder Divergenz lokal erreichbar in $P'_1\|T$. Mit der
      Implikation $P_2 \DsatAs T\Rightarrow P_1 \DsatAs T$ kann geschlossen
      werden, dass in der Parallelkomposition einer as"=Implementierung $P'_2$
      von $P_2$ mit dem Test $T$ ein fehlerhafter Zustand lokal erreichbar sein
      muss. Durch die $\chi$-Transitionen an den Zuständen von $T$ kann es in
      Komposition mit $T$ keine stillen Zustände geben. Die Fehlerhaftigkeit
      muss also ein Fehler oder Divergenz sein.
      \begin{itemize}
        \item Fall 2i) ($\varepsilon\in\ET (P'_1\|T)$ wegen neuem Fehler): Da
          jeder Zustand von $T$ alle Inputs $x\in I_T=O$ zulässt, muss ein
          lokal erreichbarer Fehler-Zustand in diesem Fall der Form sein, dass
          ein Output $a\in O_T\backslash\{\chi\}$ von $T$ möglich ist, der
          nicht mit einem passenden Input aus $P'_2$ synchronisiert werden
          kann. Durch die Konstruktion von $T$ ist in $p_{n+1}$ kein Output
          außer $\chi$ möglich. Ein neuer Fehler muss also die Form
          $(p',p_j)$ haben mit $j\leq n$, $p'\nmust[x_{i+1}]_{P'_2}$ und
          $x_{i+1}\in O_T\backslash\{\chi\}$. Durch Projektion erhält man
          dann $p_{02} \lweakmay[x_1\dots x_i]_{P'_2} p'
          \nmust[x_{i+1}]_{P'_2}$ und damit gilt $x_1\dots x_{i+1}\in\MIT
          _{P'_2}\subseteq \ET _{P'_2}$. Somit ist ein Präfix von $w$ in $\EDT
          _{P'_2}$ enthalten. Wegen des Abschlusses unter \cont{} und wegen
          Proposition~\ref{DivSemProp}.2 gilt $w\in\EDT _2$.
        \item Fall 2ii) ($\varepsilon\in\ET (P'_2\|T)$ wegen geerbtem Fehler):
          $T$ hat $x_1\dots x_iu$ ausgeführt mit $u\in (O\cup\{\chi\})^*$ und
          ebenso hat $P'_2$ den Weg $x_1\dots x_iu|_{\Sigma _2}$ ausgeführt.
          Durch dies hat $P'_2$ einen Zustand aus $E_{P'_2}$ erreicht, da von
          $T$ kein Fehler geerbt werden kann. Es gilt dann $\prune (x_1\dots
          x_iu| _{\Sigma _2})=\prune (x_1\dots x_i)\in\PrET _{P'_2}\subseteq
          \ET _{P'_2}$. Da $x_1\dots x_i$ ein Präfix von $w$ ist, führt in
          diesem Fall eine Verlängerung um lokale Aktionen von einem Präfix von
          $w$ zu einem Fehler-Zustand. Da \ET{} der Menge aller Verlängerungen
          von gekürzten Fehler-Traces entspricht, ist $x_1\dots x_i$ in $\EDT
          _{P'_2}$ enthalten und mit~\ref{DivSemProp}.2 ist ein Präfix von
          $w$ in $\EDT _2$ enthalten.
        \item Fall 2iii) ($\varepsilon\in\DT (P'_2\|T)$): Da $T$ keine
          $\tau$-Transitionen besitzt, kann das Divergenz"=Verhalten nur von
          $P'_2$ geerbt sein. $T$ hat $x_1\dots x_iu$ ausgeführt mit $u\in (O
          \cup \{\chi\})^*$ und ebenso hat $P'_2$ den Weg $x_1\dots
          x_iu|_{\Sigma _2}$ ausgeführt. Durch dies hat $P'_2$ einen Zustand
          aus $Div_{P'_2}$ erreicht. Es gilt dann $\prune (x_1\dots
          x_iu|_{\Sigma _2}) = \prune (x_1\dots x_i)\in\PrDT _{P'_2} \subseteq
          \DT _{P'_2}$, da $u|_{\Sigma _2}$ in $O^*$ enthalten ist. Da
          $x_1\dots x_i$ ein Präfix von $w$ ist, führt in diesem Fall eine
          Verlängerung um lokale Aktionen von einem Präfix von $w$ zu einem
          divergenten Zustand. Da \DT{} die Menge aller Verlängerungen von
          gekürzten Divergenz-Traces ist und $\DT _{P'_2}\subseteq \EDT
          _{P'_2}$ gilt, ist in diesem Fall das Präfix $x_1\dots x_i$ von $w$
          in $\EDT _{P'_2}$ enthalten. Mit~\ref{DivSemProp}.2 folgt daraus,
          dass ein Präfix von $w$ in $\EDT _2$ enthalten ist.
      \end{itemize}
  \end{itemize}

  Als nächstes wird nun der zweite Beweispunkt gezeigt, d.h.\ die Inklusion
  $\QDT _1\subseteq\QDT _2$. Diese Inklusion kann jedoch noch, analog zum
  Beweis der Inklusion der Fehler-gefluteten Sprache aus dem Fehler-Kapitel,
  weiter eingeschränkt werden. Da bereits bekannt ist, das $\EDT _1 \subseteq
  \EDT _2$ gilt, muss nur noch $\StQT _1\backslash \EDT _1\subseteq\QDT _2$
  gezeigt werden.\\
  Es wird ein $w\in\StQT _1\backslash\EDT _1$ gewählt und gezeigt, dass dieses
  auch in $\QDT _2$ enthalten ist. Das $w$ ist aufgrund der
  Propositionen~\ref{StilleTraceProp} und~\ref{DivSemProp}.2 auch für eine
  as"=Implementierung $P'_1$ von $P_1$ in $\StQT _{P'_1}\backslash \EDT
  _{P'_1}$ enthalten.\\
  Durch die Wahl des $w$s wird in $P'_1$ durch das Wort $w$ ein stiller
  Zustand erreicht. Dies hat nur Auswirkungen auf die Parallelkomposition
  $P'_1\|T$, wenn in $T$ ebenfalls ein stiller Zustand durch $w$ erreicht
  wird.\\
  Das betrachtete $w$ hat die Form $w = x_1\dots x_n\in\Sigma ^*$ mit $n\geq
  0$. Es wird der folgende $\chi$-Partner Test $T$ betrachtet (siehe auch
  Abbildung~\ref{TohneEmitIundO}):
  \begin{itemize}
    \item $T=\{p_0,p_1,\dots ,p_n, p\}$,
    \item $p_{0T}=p_0$,
    \item $\begin{aligned}[t]
        \may _T = \must _T &= \{(p_j,x_{j+1},p_{j+1})\mid  0\leq j< n\}\\
        &\cup\{(p_j,x,p)\mid  x\in (I_T\cup \{\chi\})\backslash\{x_{j+1}\},
        0\leq j< n\}\\
        &\cup\{(p_n,x,p)\mid x\in I_T\}\\
        &\cup\{(p,x,p)\mid x\in I_T\cup\{\chi\}\},
    \end{aligned}$
    \item $E_T=\emptyset$.
  \end{itemize}
  \begin{figure} [h!tbp]
  \begin{center}
    \begin{tikzpicture}[auto,node distance =3cm, semithick]
      \node (0) {$p_0$};
      \node (1) [right of=0] {$p_1$};
      \node (dots) [right of=1] {$\dots$};
      \node (n) [right of=dots, rectangle, dotted, draw] {$p_n\in Qui_T$};
      \node (p) at ($(1)!0.5!(dots) + (0,-3)$) {$p$};

      \path[line width=1pt] (dots) edge [loosely dotted] (p);

      \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
            (0) edge node {$x_1$} (1)
                edge [bend right] node [below, sloped] {$x?\neq x_1, \chi !$}
                (p)
            (1) edge node {$x_2$} (dots)
                edge [below, sloped] node {$x?\neq x_2, \chi !$} (p)
            (dots) edge node {$x_n$} (n)
            (n) edge [bend left] node [below,sloped] {$x?\in I_T$} (p)
            (q) edge [loop below] node {$x?\in I_T, \chi !$} (p);
    \end{tikzpicture}
    \caption{$x?\neq x_j$ steht für alle $x\in I_T\backslash\{x_j\}$, $p_n$
      ist der einzige stille Zustand}
    \label{TohneEmitIundO}
  \end{center}
  \end{figure}
  Falls das betrachtete $w$ dem leeren Wort $\varepsilon$ entspricht, reduziert
  sich der $\chi$-Partner $T$ auf den Zustand $p_n = p_0$ und den Zustand $p$.
  Es ist also in diesem Fall der Startzustand gleich dem stillen Zustand.\\
  Allgemein ist der Zustand $p_n$ aus $T$ der einzige stille Zustand in $T$. Es
  gilt wegen des ersten Punkte von Lemma~\ref{StilleZustLem}, dass auch in der
  Parallelkomposition $P'_1\|T$ ein stiller Zustand mit $w$ erreicht wird. Da
  es sich bei allen in $w$ befindlichen Aktionen um synchronisieren Aktionen
  handelt und $I_T\cap I=\emptyset$ gilt, folgt $w\in O_{P'_1\|T}$ und $w\in
  \StQT (P'_1\|T)$. Es kann also in der Parallelkomposition durch $w$ ein
  stiller Zustand lokal erreicht werden. Da ein stiller Zustand in $P'_1\|T$
  lokal erreichbar ist, erfüllt $P_1$ den Test $T$ nicht. Es muss also auch
  eine as"=Implementierung $P'_2$ von $P_2$ geben, für die $P'_2\|T$ einen
  lokal erreichbaren fehlerhaften Zustand besitzt. Hier kann jedoch zunächst
  keine Aussage darüber getroffen werden, ob das $w$ in der Parallelkomposition
  $P'_2\|T$ ausführbar ist und ob es sich bei der Fehlerhaftigkeit um Fehler,
  Stille oder Divergenz handelt.
  \begin{itemize}
    \item Fall a) ($\varepsilon \in \ET (P'_2\|T)$): Der lokal erreichbare
      fehlerhafte Zustand ist ein Fehler. Das $w$ muss somit nicht ausführbar
      sein. Der Fehler kann sowohl von $P'_2$ geerbt sein, wie durch fehlende
      Synchronisations-Sicherstellung als neuer Fehler in der
      Parallelkomposition entstanden sein. Da nur auf dem Trace $w$ in $T$
      Synchronisations"=Probleme auftreten können und wegen den Fällen 2i) und
      2ii) des ersten Punktes dieses Beweises ist ein Präfix von $w$ in $\EDT
      _{P'_2}$ enthalten. Da die Menge \EDT{} unter \cont{} abgeschlossen ist
      und~\ref{DivSemProp}.2 gilt, folgt $w\in\EDT _2\subseteq\QDT _2$.
    \item Fall b) ($\varepsilon \in \DT (P'_2\|T)\backslash \ET(P'_2\|T)$): Es
      handelt sich bei dem lokal erreichbaren fehlerhaften Zustand um
      Divergenz. Die Divergenz muss von $P'_2$ geerbt sein, da $T$ keine
      Möglichkeit für eine unendliche $\tau$-Folge hat. Es gilt also, dass
      bereits in $P'_2$ ein Präfix von $w$ in $\EDT _{P'_2}$ enthalten ist,
      wegen Fall 2iii) des Beweises des ersten Punktes dieses Lemmas. Mit dem
      Abschluss unter \cont{} und~\ref{DivSemProp}.2 folgt, dass auch $w\in
      \EDT _2\subseteq\QDT _2$ gilt.
    \item Fall c) (stiller Zustand lokal erreichbar in $P'_2\|T$ und $\varepsilon
      \notin \EDT (P'_2\|T)$): Da in $T$ nur durch $w$ ein stiller Zustand
      erreicht werden kann, muss es sich bei dem lokal erreichbaren
      stillen Zustand in $P'_2\|T$ um einen handeln, der mit $w$ erreicht werden
      kann. Mit dem zweiten Punkt von Lemma~\ref{StilleZustLem} kann gefolgert
      werden, dass auch in $P'_2$ ein stiller Zustand mit $w$ erreichbar sein
      muss, da $\ET (P'_2\|T)$ eine Teilmenge von $\EDT (P'_2\|T)$ ist. Es gilt
      also $w\in\StQT _{P'_2}\subseteq \QDT _{P'_2}$. Mit dem dritten Punkt von
      Proposition~\ref{DivSemProp} folgt daraus $w\in\QDT _2$.
  \end{itemize}

  Nun wird mit dem letzten Punkt des Beweises begonnen. Analog wie in den
  Beweisen zu den Lemmata~\ref{KommTestVerfeinLem} und~\ref{StilleTestVerfeinLem}
  ist hier aufgrund der bereits geführten Beweisteile nur noch $L_1\backslash
  \EDT _1 \subseteq \EDL _2$ zu zeigen. Es wird also für ein beliebig gewähltes
  $w\in L_1\backslash \EDT _1$ gezeigt, dass es auch in $\EDL _2$ enthalten
  ist. Es gilt auch $w\in L _{P'_1}\backslash \EDL _{P'_1}$ für eine
  as"=Implementierung $P'_1$ von $P_1$, wegen~\ref{LImpProp}
  und~\ref{DivSemProp}.
  \begin{itemize}
    \item Fall 1 ($w = \varepsilon$): Analog zu den
      Lemmata~\ref{KommTestVerfeinLem} und~\ref{StilleTestVerfeinLem} gilt auch
      hier, dass $\varepsilon$ immer in $\EDL _2$ enthalten ist.
    \item Fall 2 ($w = x_1\dots x_n$ mit $n \geq 1$): Die Konstruktion des
      $\chi$-Partner Tests $T$ weicht nur durch die $\chi$-Transitionen vom
      Transitionssystem aus dem Beweis der Inklusion der Fehler-gefluteten
      Sprache \EL{} aus Lemma~\ref{KommTestVerfeinLem} ab. Der Test $T$ ist
      dann wie folgt definiert (siehe dazu auch Abbildung~\ref{TmitEundO}):
      \begin{itemize}
        \item $T=\{p_0,p_1,\dots ,p_n,p\}$,
        \item $p_{0T}=p_0$,
        \item $\begin{aligned}[t]
            \may _T = \must _T &= \{(p_j,x_{j+1},p_{j+1})\mid 0\leq j< n\}\\
            &\cup\{(p_j,x,p)\mid x\in I_T\backslash\{x_{j+1}\},0\leq j < n\}\\
            &\cup\{(p_j,\chi ,p)\mid 0\leq j\leq n\}\\
            &\cup\{(p,x ,p)\mid x\in I_T\cup \{\chi\}\},
        \end{aligned}$
        \item $E_T=\{p_n\}$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[auto,node distance =3cm, semithick]

          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$p_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$p_n\in E_T$};
          \node (p) at ($(dots) + (0,-3)$) {$p$};

          \path[line width=1pt] (dots) edge [loosely dotted] (p);

          \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1, \chi
                    !$} (p)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2, \chi !$} (p)
                (dots) edge node {$x_{n-1}$} (n1)
                (n1) edge node {$x_n$} (n)
                     edge node [below, sloped] {$x?\neq x_n, \chi !$} (p)
                (p) edge [loop below] node {$x?\in I_T, \chi !$} (p)
                (n) edge [bend left] node {$\chi !$} (p);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_T\backslash\{x_j\}$, $p_n$
          ist der einzige Fehler-Zustand}
      \label{TmitEundO}
      \end{center}
      \end{figure}
      Durch die $\chi$-Transition an den Zuständen wird wie oben vermieden,
      dass es in einer Komposition mit $T$ und auch in $T$ selbst
      stille Zustände geben kann. Da $p_{01} \weakmust[w]_{P'_1} p'_1$ gilt,
      kann man schließen, dass $P'_1\|T$ einen lokal erreichbaren geerbten
      Fehler hat. Es muss also auch eine as"=Implementierung $P'_2$ von $P_2$
      geben, sodass $P'_2\|T$ einen lokal erreichbaren fehlerhaften Zustand
      hat. Wie oben bereits erwähnt, kommt Stille als Fehlerhaftigkeit nicht in
      Frage.
      \begin{itemize}
        \item Fall 2a) \big(neuer Fehler aufgrund von $x_j\in O_T\backslash
          \{\chi\}$ und $p_{02} \lweakmay[x_1\dots x_{j-1}] p'_2
          \nmust[x_j]$\big): Es gilt $x_1\dots x_j\in\MIT _{P'_2}$ und somit
          $w\in\EDL _{P'_2}$ Anzumerken ist, dass nur auf diesem Weg Outputs
          von $T$ aus der Menge $\Synch (P'_2,T)$ möglich sind, deshalb gibt es
          keine anderen Outputs von $T$, die zu einem neuen Fehler führen
          könnten. Wegen~\ref{DivSemProp} gilt $w\in\EDL _2$.
      \end{itemize}
      Die restlichen Fälle sind analog zu Lemma~\ref{KommTestVerfeinLem}
      möglich. Somit gilt für alle Fälle (2a) bis 2d)), dass $w$ in $\EDL _2$
      enthalten ist, da $\EL _2\subseteq \EDL _2$ gilt.
      \begin{itemize}
        \item Fall 2e) (Divergenz und kein neuer Fehler): Da $T$ keine
          Möglichkeit hat zu divergieren, muss diese Möglichkeit von $P'_2$
          geerbt sein. Es gilt dann $p_{02} \lweakmay[x_1\dots x_j u]_{P'_2} p'
          \in Div _{P'_2}$ für $j\geq 0$ und $u\in O^*$. Somit ist $x_1\dots
          x_j u\in\StDT _{P'_2}$ und damit $\prune (x_1\dots x_j u) = \prune
          (x_1\dots x_j)\in\PrDT _{P'_2}\subseteq\EDT _{P'_2}$. Also folgt
          mit~\ref{DivSemProp}.2, dass $w$ in $\EDT _2 \subseteq\EDL _2$
          enthalten ist, da \DT{} unter \cont{} abgeschlossen ist.
      \end{itemize}
  \end{itemize}
\end{proof}

\begin{Satz}
  \label{DivTestVerfSatz}
  Aus $P_1 \DRel P_2$ folgt, dass $P_1$ $P_2$ Divergenz-verfeinert.
\end{Satz}
\begin{proof}
  Ein Fehler-, stiller oder Divergenz-Zustand ist nach Definition genau dann in
  einem \MEIO{} $P$ lokal erreichbar, wenn $w\in\QDT _P$ für ein $w\in O_P^*$
  gilt.\\
  Um nachzuweisen, dass $P_1$ $P_2$ Divergenz-verfeinert, muss bewiesen werden,
  dass für alle Tests $T$ von $P_1$ bzw.\ $P_2$ $P_2\DsatAs T \Rightarrow P_1
  \DsatAs T$ gilt. Anstatt diese Aussage direkt zu beweisen, wird hier die
  äquivalente Aussage $\neg P_1\DsatAs T\Rightarrow\neg P_2\DsatAs T$ für alle
  Test $T$ von $P_1$ und $P_2$ nachgewiesen. Sei $T$ ein beliebiger Test $T$ von
  $P_1$, für den $\neg P_1\DsatAs T$ gilt. Für eine as"=Implementierung $P'_1$
  von $P_1$ wird also ein Fehler-, stiller oder Divergenz-Zustand in $P'_1\|T$
  lokal erreicht. Es muss ein $w\in O_{P'_1\|T}^*$ geben, das in der Menge
  $\QDT _{P'_1\|T}$ enthalten ist. Ein Element der Menge $\QDT _{P'_1\|T}$ kann
  in dieser enthalten sein, wenn es nach Definition~\ref{DivSemDef} Element
  einer der zwei folgenden Mengen ist: $\EDT _{P'_1\|T}$ oder $\StQT _{P'_1\|T}$.
  \begin{itemize}
    \item Fall 1 ($w\in\EDT _{P'_1\|T}$): Da $w$ nur aus Outputs besteht, muss
      auch $\varepsilon\in\EDT _{P'_1\|T}$ gelten. Mit Satz~\ref{DivSemSatz}
      folgt $\varepsilon\in\cont (\prune ((\EDT _{P'_1}\|\EDL _T)\cup (\EDL
      _{P'_1}\|\EDT _T)))$. Durch Proposition~\ref{DivSemProp} und die
      Präfix-Minimalität von $\varepsilon$ folgt $\varepsilon\in\prune ((\EDT
      _1\|\EDL _T)\cup (\EDL _1\|\EDT _T))$. Eine Verlängerung $w'\in
      O_{P_1\|T}^*$ von $\varepsilon$ um lokale Aktionen muss in der Menge
      $\EDT _1\|\EDL _T$ oder in der Menge $\EDL _1\|\EDT _T$ enthalten sein.
      Es muss also eine Projektion des Wortes $w$ auf die einzelnen Komponenten
      geben, so dass $w\in w_1\|w_T$ mit $w_1\in\EDT _1$ bzw.\ $w_1\in\EDL _1$
      und $w_T\in\EDL _T$ bzw.\ $w_T\in\EDT _T$ gilt. Mit der Voraussetzung
      $P_1 \DRel P_2$ folgt $w_1\in\EDT _2$ bzw.\ $w_1\in\EDL _2$. Wegen
      Proposition~\ref{DivSemProp} muss es ein $P'_2$ aus $\asimp (P_2)$ geben,
      für dass $w_1\in\EDT _{P'_2}$ bzw.\ $w_1\in\EDL _{P'_2}$ gilt. In der
      Parallelkomposition mit $T$ gilt also $w'\in (\EDT _{P'_2}\|\EDL _T)\cup
      (\EDL _{P'_2}\|\EDT _T)$. Da $P_1$ und $P_2$ die gleiche Signatur haben
      gilt $w'\in O _{P'_2\|T}^*$ und somit $\varepsilon\in\prune ((\EDT
      _{P'_2}\|\EDL _T)\cup (\EDL _{P'_2}\|\EDT _T))\subseteq \EDT _{P'_2\|T}$,
      wegen Satz~\ref{DivSemSatz}. In der Parallelkomposition $P'_2\|T$ ist ein
      Fehler- oder Divergenz-Zustand lokal erreichbar. Für die Spezifikation
      $P_2$ von $P'_2$ folgt somit also $\neg P_2\DsatAs T$.
    \item Fall 2 ($w\in\StQT _{P'_1\|T} \backslash\EDT _{P'_1\|T}$): Das Wort
      $w$ muss in $P'_1\|T$ zu einem Zustand $(p_1,p_T)$ führen, der still und
      keine Fehler ist. Die Zustände $p_1$ und $p_T$, die in Komposition den
      Zustand in $P_1\|P_T$ ergeben müssen nach Lemma~\ref{StilleZustLem}.2
      ebenfalls sill sein. Es gibt also Wörter $w_1$ und $w_T$, so dass $w_1$
      in $P'_1$ den Zustand $p_1$ und $P_T$ den Zustand $p_T$ erreicht mit
      $w\in w_1\|w_T$. $w_1$ und $w_T$ sind also in der Menge \StQT{} ihres
      Transitionssystems enthalten. Für $w_1$ gilt $w_1\in\StQT _{P'_1}
      \subseteq \QDT _{P'_1}\subseteq\QDT _1$, wegen
      Proposition~\ref{DivSemProp}. $w_1\in\QDT _2$ folgt durch die
      Voraussetzung $P_1\DRel P_2$. Mit Proposition~\ref{DivSemProp} muss es
      eine as"=Implementierung $P'_2$ von $P_2$ geben, für die $w_1$ in der
      Menge $\QDT _{P'_2} = \EDT _{P'_2} \cup \StQT _{P'_2}$ enthalten ist.
      \begin{itemize}
        \item Fall 2a) ($w\in\EDT _{P'_2}$): Für das Wort $w_T$ gilt $w_T\in L
          _T\subseteq\EDL _T$, da es in $T$ ausführbar ist. Mit
          Satz~\ref{DivSemSatz}.1 folgt $w\in\EDL _{P'_2\|T}$. Da $w$ nur aus
          Outputs besteht, ist ein Fehler- oder Divergenz-Zustand in $P'_2\|T$
          lokal erreichbar wie in Fall 1 dieses Beweises. Es folgt $\neg P_2
          \DsatAs T$.
        \item Fall 2b) ($w_1\in\StQT _{P'_2}$): Durch $w_1$ wird in $P'_2$ ein
          stiller Zustand $p_2$ erreicht. In der Parallelkomposition ist der
          Zustand $(p_2,p_T)$, wegen Lemma~\ref{StilleZustLem}.1, ebenfalls
          still. Der Zustand wird durch $w_1\|w_T$ erreicht. Es gilt also
          $w\in\StQT _{P'_2\|T}$. Das $w$ besteht auch für die
          Parallelkomposition $P'_2\|T$ nur aus Outputs, da $P_1$ und $P_2$
          nach Voraussetzung die selbe Signatur besitzen müssen. Es ist also
          ein stiller Zustand lokal erreichbar in $P'_2\|T$. $\neg P_2\DsatAs
          T$ gilt also auch in diesem Fall.
      \end{itemize}
  \end{itemize}
\end{proof}

Es wurde, wie in den letzten beiden Kapiteln, eine Kette an Folgerungen
gezeigt, die sich zu einem Ring schließt. Jedoch ändert sich an der Begründung
für einen der Folgepfeile etwas, da in Lemma~\ref{DivTestVerfeinLem} $T$ kein
Partner ist, sondern ein $\chi$-Partner. Die Folgerungskette ist in
Abbildung~\ref{FolgerungsketteDiv} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}[scale = 3]
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        P_1\DRel P_2 & P_1 \text{ verfeinert } P_2 \\
        \substack{\forall \text{ Test } \chi\text{-Partner } T:\\P_2\DsatAs
        T\Rightarrow P_1\DsatAs T} &
    \substack{\forall \text{ Tests } T:\\P_2\DsatAs T\Rightarrow P_1\DsatAs T} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {Satz~\ref{DivTestVerfSatz}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition~\ref{DivTestDef}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{DivTestVerfeinLem}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
          (m-2-2) -- node [below]
          {$\substack{T \text{ Test } \chi\text{-Partner}\\\Downarrow\\ T \text{ Test}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette der Testing-Verfeinerung und Divergenz-Relation}
  \label{FolgerungsketteDiv}
  \end{center}
\end{figure}

Das nächste Korollar macht die Äquivalenz, die durch die
Abbildung~\ref{FolgerungsketteDiv} deutlich wird, explizit.

\begin{Kor}
  Es gilt: $P_1\DRel P_2 \Leftrightarrow P_1$ Divergenz-verfeinert $P_2$.
\end{Kor}
