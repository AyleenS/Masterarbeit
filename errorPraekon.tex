\section{Gröbster Präkongruenz-Ansatz}

Dieses Kapitel hat das Ziel die Präkongruenz für Error auf \EIO{}s aus
z.B.~\cite{Schinko2016BA} auf die hier betrachten \MEIO{}s zu erweitern.

\begin{Def}[fehler-freie Kommunikation]
  Ein Fehler"=Zustand ist \emph{lokal erreichbar} in einem \MEIO{} $P$, wenn
  ein $w\in O^*$ existiert mit $p_0 \weakmay[w]_P p\in E$. Ein \MEIO{} $P$
  ist \emph{lokal fehler-frei}, wenn kein $w\in O^*$ existiert mit $p_0
  \weakmay[w]_P p\in E$.\\
  Zwei \MEIO{}s $P_1$ und $P_2$ \emph{kommunizieren fehler-frei}, wenn keine
  as"=Implementierungen ihrer Parallelkomposition $P_{12}$ einen
  Fehler"=Zustand lokal erreichen kann.
\end{Def}

\vspace{0.2cm}

\begin{Def}[Kommunikationsfehler-Verfeinerungs-Basisrelation]
  \label{EBRelDef}\mbox{}\\
  Für zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur wird $P_1\EBRel{}
  P_2$ geschrieben, wenn nur dann ein Fehler"=Zustand in einer
  as"=Implementierung von $P_1$ lokal erreichbar ist, wenn es auch eine
  as"=Implementierung von $P_2$ gibt, in der ein Fehler"=Zustand ebenfalls
  lokal erreichbar ist. \EBRel{} stellt als Basisrelation eine
  \emph{Verfeinerung} bezüglich \emph{Kommunikationsfehler"=Freiheit} dar.\\
  \ECRel{} bezeichnet die \emph{vollständig abstrakte Präkongruenz} von
  \EBRel{} bezüglich $\cdot\|\cdot$, d.h.\ die gröbste Präkongruenz bezüglich
  $\cdot\|\cdot$, die in \EBRel{} enthalten ist.
  \\ \TODO{Neue Zeile an Definitions-Anfang überprüfen}
\end{Def}

Für as"=Implementierungen $P_1$ und $P_2$ entspricht \EBRel{} der Basisrelation
\EBbaRel{} aus~\cite{Schinko2016BA}.

Wie z.B.\ in~\cite{Schinko2016BA} werden die Fehler hier Trace-basiert
betrachtet.

\begin{Def}[Kommunikationsfehler-Traces]
  \label{KommTracesDef}
  Für ein \MEIO{} $P$ wird definiert:
  \begin{itemize}
    \item \emph{strikte Fehler-Traces}: $\StET (P) :=
      \left\{w\in\Sigma ^* \mid p_0 \weakmay[w]_P p \in E\right\}$,
    \item \emph{gekürzte Fehler-Traces}: $\PrET (P) :=
      \left\{\prune (w) \mid w\in\StET (P)\right\}$,
    \item \emph{Input-kritische-Traces}: $\MIT (P) := \left\{wa\in\Sigma ^*
      \mid p_0 \weakmay[w]_P p \land a\in I\land p\nmust[a]_P \right\}$.
  \end{itemize}
\end{Def}

Da die Basisrelation über as"=Implementierungen spricht, ist es wichtig bereits
in den Trace-Mengen eine Beziehung zwischen der allgemeinen Definition für
\MEIO{}s und deren as"=Implementierungen herzustellen. Die nächste Proposition
beschreibt eine Teilmengen"=Beziehung zwischen den Traces eines \MEIO{}s und
den Traces seiner as"=Implementierungen. Die umgekehrte Teilmengen"=Beziehung
gilt im allgemeinen nicht, da as"=Verfeinerungs"=Relationen beliebiges
Verhalten nach Fehler"=Zuständen in der Spezifikation zulassen.

\begin{Prop}[Kommunikationsfehler-Traces und Implementierungen]
  \label{KommTracesProp}
  Sei $P$ ein \MEIO{}.
  \begin{enumerate}
    \item Für die strikten Fehler-Traces von $P$ gilt $\StET (P) \subseteq
      \underset{P' \in\asimp (P)}{\bigcup} \StET (P')$.
    \item Für die gekürzten Fehler-Traces von $P$ gilt $\PrET (P) \subseteq
      \underset{P' \in\asimp (P)}{\bigcup} \PrET (P')$.
    \item Für die Input-kritischen-Traces von $P$ gilt $\MIT (P) \subseteq
      \underset{P' \in\asimp (P)}{\bigcup} \MIT (P')$.
  \end{enumerate}
\end{Prop}
\begin{proof}\mbox{}
  \begin{enumerate}
    \item Um die Inklusion zu zeigen wird eine Implementierung $P'$ angegeben,
      die die strikten Fehler-Traces von $P$ implementiert und zusätzlich auch
      noch eine passende as"=Verfeinerungs"=Relation $\mathcal{R}$ zwischen den
      beiden Transitionssystemen. $P'$ implementiert wie im Beweis zu
      Proposition~\ref{LImpProp} alle Transitionen von $P$. Das $P'$ wird hier
      jedoch im Gegensatz zum Beweis von~\ref{LImpProp} auch noch alle
      Fehler-Zustände aus $P$ implementieren. Die entsprechende
      as"=Verfeinerungs"=Relation $\mathcal{R}$ ist hier ebenfalls die
      Identitäts-Relation zwischen den Zuständen der Transitionssysteme. Die
      Definition von $P'$ lautet also:
      \begin{itemize}
        \item $P'=P$,
        \item $p'_0=p_0$,
        \item $I_{P'}=I_P$ und $O_{P'}=O_P$,
        \item $\must _{P'} =\may _{P'} = \may _P$,
        \item $E_{P'}=E_P$.
      \end{itemize}
      Die Tupel, die von~\ref{SimDef}.2 und~\ref{SimDef}.3 als Elemente der
      as"=Verfeinerungs"=Relation $\mathcal{R}$ gefordert werden, sind bereits
      durch die Identitäts"=Relation garantiert, wie im Beweis
      von~\ref{LImpProp}. Für~\ref{SimDef}.1 muss für jedes in der
      as"=Verfeinerungs"=Relation $\mathcal{R}$ enthaltene Zustands-Paar
      gelten, wenn der Zustand aus $P$ kein Fehler-Zustand ist, dann ist auch
      der Zustand aus $P'$ keiner. Dies folgt aus der Gleichheit der Mengen
      $E_P$ und $E_{P'}$. Jeder Trace aus $\StET (P)$ ist via may"=Transitionen
      in $P$ ausführbar und führt dort zu einem Fehler-Zustand. Der analoge
      Trace ist auch in $P'$ möglich, da alle may"=Transitionen aus $P$ in $P'$
      als must"=Transitionen implementiert wurden. Der dabei erreichte Zustand
      steht mit dem Fehler-Zustand in $P$ in der Identitäts"=Relation
      $\mathcal{R}$, die Zustände entsprechen sich also. Es gilt mit
      $E_{P'}=E_P$, dass auch der in $P'$ erreichte Zustand ein Fehler-Zustand
      ist. Für die as"=Implementierung $P'$ von $P$ und die
      Identitäts"=Relation $\mathcal{R}$ als starke as"=Verfeinerungs"=Relation
      zwischen den Transitionssystemen gilt also $\StET (P) =\StET (P')$.
    \item Da der erste Punkt dieser Proposition bereits beweisen wurde gilt,
      dass alle strikten Fehler-Traces von $P$ in der Vereinigung aller
      strikten Fehler-Traces der as"=Implementierungen von $P$ enthalten sind.
      Wenn auf alle Wörter in beiden Mengen die \prune{}-Funktion angewendet
      wird, gilt die Inklusion der daraus entstandenen Mengen weiterhin. Dies
      entspricht der Behauptung des aktuell betrachteten Punktes.
    \item Auch für diese Inklusion wird eine starke as"=Verfeinerungs"=Relation
      $\mathcal{R}$ und eine Implementierung $P'$ angegeben. Jedoch werden
      nicht wie bei 1.\ alle Transitionen von $P$ in $P'$ implementiert. Es
      wird auch für jedes $wa$ aus $\MIT (P)$ eine eigene Implementierung $P'$
      geben und nicht eine für alle. Es werden alle must"=Transitionen aus $P$
      in $P'$ implementiert und zusätzlich die may"=Transitionen, die zum
      Ausführen von $w$ benötigt werden, so dass das $a$ danach in $P$ nicht
      gefordert wird. Es kann aufgrund möglicher Schleifen in $P$ auch nicht
      mehr die Identitäts"=Relation als as"=Verfeinerungs"=Relation gewählt
      werden. Der Trace $w$ wird entsprechend seiner Länge abgewickelt, so dass
      sicher gestellt wird, dass der Zustand am Ende dieses Traces wirklich
      einen fehlenden Input aufweist. Für das Abwickeln werden die Zustände
      entsprechend ihrer Position im Ablauf, auf dem $w$ ausgeführt wird,
      durchnummeriert. Für ein $w$, für das $wa\in\MIT (P)$, gilt: $\exists
      w'\in\Sigma _{\tau} ^*, \exists \alpha _1,\alpha _2,\dots ,\alpha _n,
      \exists p_1,p_2,\dots ,p_n: \widehat{w'} = w\land w'=\alpha _1\alpha
      _2\dots \alpha _n\land p_0 \may[\alpha _1]_P p_1 \may[\alpha _2]_P \dots
      p_{n-1}\may[\alpha _n]_P p_n \nmust[a]_P$.
      Die starke as"=Verfeinerungs"=Relation $\mathcal{R}$ enthält in diesem
      Fall Tupel $((p,j),p)$ für alle $0\leq j \leq n$. Die entsprechende
      Definition für das $P'$, das $wa$ als Input-kritischen-Trace enthalten
      soll, lautet:
      \begin{itemize}
        \item $P'=P\times \{0,1,\dots n\}$,
        \item $p'_0=(p_0,0)$,
        \item $I_P'=I_P$ und $O_P'=O_P$,
        \item $\begin{aligned}[t]
            \must _P'=\may _P'&= \left\{((p,j),\alpha ,(p',j+1))\mid p
            \may[\alpha]_P p', 0\leq j < n\right\}\\
            &\cup\left\{((p,j),\alpha ,(p',j))\mid p\must[\alpha]_P p',
            0\leq j \leq n\right\},
        \end{aligned}$
      \item $E_{P'}=\emptyset$.
      \end{itemize}
      Der Ablauf $w$ wird in $P'$ durch $(p_0,0) \must[\alpha
      _1]_{P'} (p_1,1) \must[\alpha _2]_{P'} \dots (p_{n-1},n-1) \must[\alpha
      _n]_{P'} (p_n,n)$ simuliert. $w$ ist also in $P'$ ausführbar. $a$ ist für
      $(p_n,n)$ nicht ausführbar, da in $P$ $p_n\nmust[a]_P$ gilt und für die
      Zustände mit der Nummer $n$ in $P'$ nur die must"=Transitionen
      implementiert werden. Die Transitionen $p\must[\alpha]_P p'$ aus $P$
      werden in $P'$ durch die Transitionen $(p,j)\must[\alpha]_{P'} (p',j)$
      gematched. Für die may-Transitionen $(p,j)\may[\alpha]_{P'} (p',j+1)$
      (bzw.\ $(p',j)$) in $P'$ sind die entsprechenden matchenden Transitionen
      in $P$ die Transition $p \may[\alpha]_P p'$. Da zusätzlich die Menge
      $E_{P'}$ leer ist, gelten alle Bedingungen, damit $\mathcal{R}$ eine
      as"=Verfeinerungs"=Relation zwischen $P'$ und $P$ ist. Mit der Begründung
      von oben folgt auch $wa\in \MIT (P')$. Da für alle $wa$ aus $\MIT (P)$
      eine entsprechende Implementierung mit as"=Verfeinerungs"=Relation
      $\mathcal{R}$ angegeben werden kann, gilt die Inklusion.
  \end{enumerate}
\end{proof}

\begin{Def}[Kommunikationsfehler-Semantik]
  \label{KommFehlerSemDef}
  Sei $P$ ein \MEIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Fehler-Traces} von $P$ ist $\ET (P)
      := {\cont (\PrET (P)) \cup \cont (\MIT (P))}$.
    \item Die \emph{Fehler-geflutete Sprache} von $P$ ist $\EL
      (P) := L(P) \cup \ET (P)$.
  \end{itemize}
  Für zwei \MEIO{}s $P_1,P_2$ mit der gleichen Signatur wird $P_1\ERel P_2$
  geschrieben, wenn die Inklusionen $\ET _1\subseteq \ET _2$ und $\EL _1
  \subseteq \EL _2$ gelten.
\end{Def}

Hierbei ist zu beachten, dass die Mengen \StET{}, \PrET{}, \MIT{}, \ET{} und
\EL{} nur denen aus~\cite{Schinko2016BA} entsprechen, falls $P$ bereits eine
as"=Implementierung ist.

Im weiteren Verlauf wird immer wieder eine Aussage über den Zusammenhang von
Abläufen in as"=Verfeinerungen bzw.\ schwachen as"=Verfeinerungen und ihren
Spezifikationen benötigt. Um nicht immer wieder ähnliche Argumentationen zu
benötigen, wird diese Aussage hier allgemein zunächst für schwache
as"=Verfeinerungen bewiesen. Die analoge Aussage für starke as"=Verfeinerungen
folgt dann mit Lemma~\ref{ZusammenhWasAsLem}.

\begin{Lem}[Abläufe in schwachen as"=Verfeinerungen und Spezifikationen]
  \label{AblaefeSchwVerfSpezLem}
  Sei $P$ eine schwache as"=Verfeinerung eines \MEIO{}s $Q$ und $\mathcal{R}$
  die schwache as"=Verfeinerungs"=Relation zwischen den beiden
  Transitionssystemen. Ein Ablauf $p_0 \may[\alpha _1]_P p_1 \may[\alpha _2]_P
  \dots p_{n-1} \may[\alpha _n]_P p_n$ aus $P$ kann durch einen Ablauf $q_0
  \weakmay[\widehat{\alpha _1}]_Q q_1 \weakmay[\widehat{\alpha _2}]_Q \dots
  q_{n-1} \weakmay[\widehat{\alpha _n}]_Q q_n$ mit $p_n \mathcal{R} q_n$ in $Q$
  gematched werden oder $\exists k: 0 \leq k < n$, so dass $q_0
  \weakmay[\widehat{\alpha _1}]_Q q_1 \weakmay[\widehat{\alpha _2}]_Q \dots
  q_{k-1} \weakmay[\widehat{\alpha _k}]_Q q_k$ ein Ablauf in $Q$ ist für den
  $q_k \mathcal{R} q_k$ und $q_k\in E_Q$ gilt. Für $w=(\alpha _1\alpha
  _2\dots\alpha _n)|_{\Sigma}$ gilt $w\in L(P)$ und es folgt $w\in L(Q)$ oder
  $w\in\cont (\StET (Q))\subseteq \ET (Q)$.
\end{Lem}
\begin{proof}
  Die Existenz des Ablaufes in $Q$ soll induktiv über die einzelnen
  Transitionen des Ablaufes aus $P$ bewiesen werden.\\
  Für $n=0$ gibt es keine Transitionen, die zuvor ausgeführt werden müssen, und
  $p_0\mathcal{R} q_0$ folgt direkt aus der Voraussetzung, dass $\mathcal{R}$
  eine schwache as"=Verfeinerungs"=Relation zwischen $P$ und $Q$ ist.\\
  Die Aussage des Lemmas über die Abläufe gelte für ein $j$ mit $0\leq j<n$.
  \begin{itemize}
    \item Fall 1 ($\exists 0 \leq k < j: q_k\in E_Q \land p_k \mathcal{R}
      q_k$): Es gilt auch $k < j+1$, somit ist die Behauptung auch für $j+1$
      erfüllt.
    \item Fall 2 ($p_j\mathcal{R} q_j \land q_j\in E_Q$): Dann ist $j$ das $k <
      j+1$, für das $q_k$ ein Fehler"=Zustand ist.
    \item Fall 3 ($p_j \mathcal{R} q_j \land q_j\notin E_Q \land \neg\exists k:
      0 \leq k < j \land q_k\in E_Q$): In der Verfeinerung $P$ existiert die
      Transition $p_j \may[\alpha _{j+1}]_P p_{j+1}$. Das $\alpha _{j+1}$ kann
      ein Input oder eine lokale Aktion sein. Falls $\alpha _{j+1}\in I$ gilt,
      folgt mit Definition~\ref{wSimDef}.4 die Transition $q_j \may[\alpha
      _{j+1}]_Q \weakmay[\varepsilon]_Q q_{j+1}$ in $Q$ für ein $q_{j+1}$ mit
      $(p_{j+1},q_{j+1})\in\mathcal{R}$. Da schwach"=nachlaufende
      may"=Transitionen eine spezielle Form von schwachen may"=Transitionen
      sind, gilt also auch $q_j \weakmay[\widehat{\alpha _{j+1}}]_Q q_{j+1}$.
      $\alpha _{j+1}$ kann jedoch auch eine lokale Aktion sein. Mit
      Definition~\ref{wSimDef}.4 folgt dann die Existenz der Transition $q_j
      \weakmay[\widehat{\alpha _{j+1}}]_Q q_{j+1}$ in der Spezifikation $Q$ mit
      $p_{j+1} \mathcal{R} q_{j+1}$.
  \end{itemize}
  Für jedes $w$ aus $L(P)$ gibt es einen Ablauf wie er in diesem Lemma
  vorausgesetzt wurde, so dass $w=(\alpha _1\alpha _2\dots \alpha
  _n)|_{\Sigma}$ gilt. Im Fall 1 bzw.\ Fall 2 wurden bis $q_k$ bzw.\ $q_j$ die
  Aktionen $\alpha$ in ihrer Reihenfolge schwach ausgeführt. Es gibt also ein
  Präfix $v$ von $w$, das in $Q$ zu einem Fehler"=Zustand führt und somit
  $v\in\StET (Q)$ erfüllt. $w$ ist eine Fortsetzung von $v$ und somit gilt
  $w\in\cont (\StET (Q))\subseteq \ET (Q)$. Falls der Fall 3 für $j = n-1$
  angewendet werden kann, folgt daraus $p_n\mathcal{R} q_n$ und $w = (\alpha
  _1\alpha _2\dots \alpha _n)|_{\Sigma}$ ist die Folge der sichtbaren
  Transitionsbeschriftungen, die vom Startzustand $q_0$ zum Zustand $q_n$ in
  $Q$ führen. Das Wort $w$ ist also in $Q$ ausführbar und somit in der Sprache
  $L(Q)$ enthalten.
\end{proof}

Man könnte durch das gerade eben bewiesene Lemma die gleiche Aussage für starke
as"=Verfeinerungen zeigen, in dem man Lemma~\ref{ZusammenhWasAsLem} anwendet.
Die Aussage wäre zunächst auch stark genug. Jedoch sobald Divergenz mit
betrachtet wird, kann es durch das schwache Transitions-Matching zu Problemen
kommen. Dadurch würde zusätzliches Divergenz"=Verhalten möglich. Das nächste
Lemma ist somit nur ähnlich zum vorangegangenen, hat jedoch eine etwas
stärkere Aussage.

\begin{Lem}[Abläufe in as-Verfeinerungen und Spezifikationen]
  \label{AblaefeVerfSpezLem}
  Sei $P$ eine as"=Verfeinerung eines \MEIO{}s $Q$ und $\mathcal{R}$ die
  as"=Verfeinerungs"=Relation zwischen den beiden Transitionssystemen. Ein
  Ablauf $p_0 \may[\alpha _1]_P p_1 \may[\alpha _2]_P \dots p_{n-1} \may[\alpha
  _n]_P p_n$ aus $P$ kann durch einen Ablauf $q_0 \may[\alpha _1]_Q q_1
  \may[\alpha _2]_Q \dots q_{n-1} \may[\alpha _n]_Q q_n$ mit $p_n \mathcal{R}
  q_n$ in $Q$ gematched werden oder $\exists k: 0 \leq k < n$, so dass $q_0
  \may[\alpha _1]_Q q_1 \may[\alpha _2]_Q \dots q_{k-1} \may[\alpha _k]_Q q_k$
  ein Ablauf in $Q$ ist für den $q_k \mathcal{R} q_k$ und $q_k\in E_Q$ gilt.
  Für $w=(\alpha _1\alpha _2\dots\alpha _n)|_{\Sigma}$ gilt $w\in L(P)$ und es
  folgt $w\in L(Q)$ oder $w\in\cont (\StET (Q))\subseteq \ET (Q)$.
\end{Lem}
\begin{proof}
  Aus $w\in L(P)$ folgt $w\in L(Q)$ oder $w\in\cont (\StET (Q))\subseteq \ET
  (Q)$ ist eine Aussage, die genau so auch in
  Lemma~\ref{AblaefeSchwVerfSpezLem} für schwache as"=Verfeinerungen galt. Jede
  starke as"=Verfeinerung ist auch eine schwache
  (Lemma~\ref{ZusammenhWasAsLem}), somit folgt diese Aussage direkt aus
  Lemma~\ref{AblaefeSchwVerfSpezLem}.\\
  Aus dem vorausgesetzten Ablauf für $P$ würde mit den
  Lemmata~\ref{AblaefeSchwVerfSpezLem} und~\ref{ZusammenhWasAsLem} nur der
  Ablauf $q_0 \weakmay[\widehat{\alpha _1}]_Q q_1 \weakmay[\widehat{\alpha
  _2}]_Q \dots q_{n-1} \weakmay[\widehat{\alpha _n}]_Q q_n$ in $Q$ folgen. In
  diesem Lemma sollen die Transitionen jedoch ohne zusätzliche oder entfallende
  $\tau$s möglich sein. Die Induktion aus dem Beweis
  von~\ref{AblaefeSchwVerfSpezLem} kann jedoch entsprechend verstärkt werden.
  Man verwendet für das $j$ mit $0 \leq j < n$ die stärkere Aussage dieses
  Lemmas. Die Beweise der Fälle 1 und 2 können unverändert übernommen werden.
  Für Fall 3 entfällt die Unterscheidung, ob $\alpha _{j+1}$ ein Input oder
  eine lokale Aktion ist. Mit Definition~\ref{SimDef}.3 kann begründet werden,
  dass die $\alpha _{j+1}$-Transition direkt zum Zustand $q_{j+1}$ führt. Es
  gilt also in jedem Schritt der Induktion, der Fall 3 betrifft, $q_j
  \may[\alpha _{j+1}]_Q q_{j+1}$. Es folgt also der hier zu zeigende Ablauf,
  falls kein Fehler"=Zustand in $Q$ angetroffen wird.
\end{proof}

Man kann das in Lemma~\ref{AblaefeVerfSpezLem} angewendete Vorgehen auch auf
unendliche Ablaufe anwenden. Die Aussage gilt für alle Längen $n$ von Abläufen.
Falls ein Fehler"=Zustand erreicht wird für ein $k$, hat man einen endlichen
Fehler"=Trace. Wenn kein Fehler"=Zustand erreicht wird, kann jedes beliebiges
Anfangsstück des unendlichen Ablaufes aus $P$ durch einen Ablauf in $Q$
gematched werden. Durch wiederholte Anwendung von Fall 3, kann dieser Ablauf
schrittweise verlängert werden. Es muss also auch in $Q$ einen analogen
unendlichen Ablauf zu dem aus $P$ geben.\\
Dieser Punkt wird in einem späteren Kapitel vor allem für unendliche
$\tau$-Abläufe bezüglich Divergenz relevant.

\begin{Kor}[unendliche Abläufe in as-Verfeinerungen und Spezifikationen]
  \label{unendlAblKor}
  Sei $P$ eine as"=Verfeinerung eines \MEIO{}s $Q$ und $\mathcal{R}$ die
  as"=Verfeinerungs"=Relation zwischen den beiden Transitionssystemen. Ein
  unendlicher Ablauf $p_0 \may[\alpha _1]_P p_2 \may[\alpha _2]_P \dots$ aus
  $P$ kann durch einen unendlichen Ablauf $q_0 \may[\alpha _1]_Q q_1
  \may[\alpha _2]_Q \dots$ in $Q$ gematched werden oder es gibt ein endliche
  Anfangsstück des Ablaufes, das in $Q$ zu einen Fehler"=Zustand führt.
\end{Kor}

Aus der Proposition für die Sprache (\ref{LImpProp}) und der Proposition über
die in der Menge \ET{} relevanten Traces (\ref{KommTracesProp}) konnte für die
Vereinigung der gleichen Mengen über die Implementierungen immer nur eine
Inklusionsrichtung gefolgert werden, da die Definition~\ref{SimDef} nach einem
Fehler"=Zustand in $P$ beliebiges Verhalten in dessen as"=Implementierungen
zulässt. Mit dem Einsatz der \cont{}-Funktion zum beliebigen Fortsetzten der
Fehler"=Traces kann dies ausgeglichen werden. Somit gilt, wie die nächste
Proposition zeigt, für die Fehler"=Traces und die Fehler-geflutete Sprache
Gleichheit und nicht nur die Inklusion.

\begin{Prop}[Kommunikationsfehler-Semantik und Implementierungen]
  \label{KommSemProp}
  Sie $P$ ein \MEIO{}.
  \begin{enumerate}
    \item Für die Menge der Fehler-Traces von $P$ gilt $\ET (P) =
      \underset{P'\in\asimp (P)}{\bigcup} \ET (P')$.
    \item Für die Fehler-geflutete Sprache von $P$ gilt $\EL (P) =
      \underset{P'\in\asimp (P)}{\bigcup} \EL (P')$.
  \end{enumerate}
\end{Prop}
\begin{proof}\mbox{}\\
  1. \glqq$\subseteq$\grqq{}:
  {\allowdisplaybreaks
  \begin{align*}
    \ET (P)&\overset{\ref{KommFehlerSemDef}}{=} \cont (\PrET (P))\cup \cont
    (\MIT (P))\\
    &\overset{\ref{KommTracesProp}}{\subseteq} \cont
    \left(\underset{P'\in\asimp (P)}{\bigcup} \PrET (P')\right)\cup \cont
    \left(\underset{P'\in\asimp (P)}{\bigcup} \MIT (P')\right)\\
    &= \underset{P'\in\asimp (P)}{\bigcup} \cont (\PrET (P'))\cup \cont (\MIT
    (P'))\\
    &\overset{\ref{KommFehlerSemDef}}{=} \underset{P'\in\asimp
    (P)}{\bigcup} \ET (P').
  \end{align*}}

  1. \glqq$\supseteq$\grqq{}:\\
  Da für $P$ die Aussage $\ET (P) = \cont (\PrET (P)) \cup \cont (\MIT (P))$
  gilt und für alle as"=Implementierungen $P'$ von $P$ die analogen Gleichungen
  für $\ET (P')$ gelten, genügt es ein präfix-minimales $w$ aus $\ET (P')$ für
  eine as"=Implementierung $P'$ von $P$ zu betrachten. In $P'$ ist $w$ entweder
  vollständig oder bis auf den letzten Buchstaben ausführbar. Dies hängt davon
  ab, ob $w\in \PrET (P')$ oder $w\in \MIT (P')$ gilt. Für $P$ muss jedoch
  nicht einmal das Präfix von $w$ ohne den letzten Buchstaben von $w$
  ausführbar sein. Da $P'$ eine as"=Implementierung von $P$ ist, gibt es eine
  as"=Verfeinerungs"=Relation $\mathcal{R}$ zwischen den beiden
  Transitionssystemen. Es muss $p'_0\mathcal{R}p_0$ für die Startzustände von
  $P'$ und $P$ gelten.
  \begin{itemize}
    \item Fall 1 ($w\in\PrET (P')$): In $P'$ existiert eine Verlängerung $v\in
      O^*$ von $w$, so dass $wv\in\StET (P')$ gilt. Das Wort $wv$ ist in $P'$
      ausführbar ($wv\in L(P')$). Es kann somit das
      Lemma~\ref{AblaefeVerfSpezLem} angewendet werden, wobei
      vorausgesetzt werden kann, dass der Ablauf in $P'$ zu einem Zustand
      $p'_n$ führt, der in $E_{P'}$ enthalten ist. Falls ein $p_k$ mit $0\leq k
      < n$ in $E_P$ enthalten ist, dann ist ein Präfix von $wv$ ein strikter
      Fehler-Trace in $P$ und mit $w=\prune(wv)$ ist somit ein Präfix von $w$
      in $\ET (P)$ enthalten. Da \ET{} unter Fortsetzung der Traces
      abgeschlossen ist, gilt auch $w\in \ET (P)$. Falls für alle $p_k$ mit $k
      < n$ $p_k\notin E_P$ gilt, kann $p'_n \mathcal{R} p_n$ gefolgert werden
      durch Lemma~\ref{AblaefeVerfSpezLem}. Da $p'_n\in E_{P'}$ gilt, folgt
      draus mit Definition~\ref{SimDef}.1, dass bereits $p_n$ in $E_P$
      enthalten sein muss. Es gilt also $wv\in\StET (P)$ und mit der
      Argumentation von oben folgt daraus $w\in\ET (P)$.
    \item Fall 2 ($w\in\MIT (P')\backslash\PrET (P')$): Da $w$ in $\MIT (P')$
      enthalten ist, gibt es ein $a\in I$ für das $w=va$ gilt mit $v\in\Sigma
      ^*$. Analog zu Fall 1 kann das $v$ in $P'$ ausgeführt werden und dafür
      das Lemma~\ref{AblaefeVerfSpezLem} angewendet werden, wobei das
      erreichte $p'_n$ den Input $a$ nicht als ausgehenden must"=Transition
      besitzen soll. Falls es ein $p_k\in E_P$ mit $0\leq k \leq n$ gibt, gilt
      mit Lemma~\ref{AblaefeVerfSpezLem} $v\in\ET (P)$ und wegen des
      Abschlusses unter \cont{} auch $w\in\ET (P)$. Ansonsten kann davon
      ausgegangen werden, dass $p'_n \mathcal{R} p_n$ für einen Zustand $p_n$
      aus $P$ erfüllt ist. Falls $a$ für $p_n$ eine ausgehende must"=Transition
      wäre, würde Definition~\ref{SimDef}.2 auch für $p'_n$ die Implementierung
      der $a$-Transition fordern, dies wäre jedoch ein Widerspruch zur Wahl des
      Zustandes $p'_n$. Es gilt also $p_n\nmust[a]_P$ und $va\in\MIT (P)$.
      Daraus ergibt sich direkt $w\in\ET (P)$.
  \end{itemize}

  2. \glqq$\subseteq$\grqq{}:
  {\allowdisplaybreaks
  \begin{align*}
    \EL (P)&\overset{\ref{KommFehlerSemDef}}{=} L(P)\cup \ET (P)\\
    &\overset{\ref{LImpProp}}{\subseteq} \left(\underset{P'\in\asimp
    (P)}{\bigcup} L (P')\right)\cup \ET (P)\\
    &\overset{1.}{=} \left(\underset{P'\in\asimp (P)}{\bigcup} L
    (P')\right)\cup \left(\underset{P'\in\asimp (P)}{\bigcup} \ET (P')\right)\\
    &= \underset{P'\in\asimp (P)}{\bigcup} L (P')\cup \ET (P')\\
    &\overset{\ref{KommFehlerSemDef}}{=} \underset{P'\in\asimp (P)}{\bigcup}
    \EL (P').
  \end{align*}}

  2. \glqq$\supseteq$\grqq{}:\\
  Da der erste Punkt dieser Proposition bereits beweisen ist, reicht es aus für
  diesen Punkt zu zeigen, dass $\underset{P'\in\asimp (P)}{\bigcup} \EL
  (P')\backslash \ET (P')$ eine Teilmenge von $\EL (P)$ ist. Die Menge $\EL
  (P')\backslash \ET (P')$ entspricht $L (P') \backslash \ET (P')$. Es muss
  also ein Wort $w$ aus der Sprache einer as"=Implementierung von $P$
  betrachtet werden, das nicht in den Fehler-Traces dieser as"=Implementierung
  enthalten ist. Das Wort $w$ ist also in $P'$ ausführbar. Falls das $w$ in $P$
  jedoch nicht ausführbar ist, folgt wie zuvor mit
  Lemma~\ref{AblaefeVerfSpezLem} $w\in\ET (P)\subseteq \EL (P)$. Falls $w$
  ausführbar ist in $P$ gilt $w\in L(P)\subseteq \EL (P)$.
\end{proof}

\begin{Kor}[lokale Fehler-Erreichbarkeit]\mbox{}
  \label{lokalFehlerErrKor}
  \begin{enumerate}[(i)]
    \item Es ist ein Fehler lokal erreichbar in einem \MEIO{} $P$
      $\Leftrightarrow \exists$ as"=Implementierung von $P$, in der ein Fehler
      lokal erreichbar ist.
    \item Falls für zwei \MEIO{}s $P_1\EBRel P_2$ gilt und in $P_1$ ein Fehler
      lokal erreichbar ist, dann ist auch in $P_2$ ein Fehler lokal erreichbar.
  \end{enumerate}
\end{Kor}
\begin{proof}\mbox{}\\
  (i) $\Rightarrow$:\\
  Da ein Fehler in $P$ lokal erreichbar ist, gilt $\varepsilon \in\PrET _P
  \subseteq \ET _P$. Es muss aufgrund von Proposition~\ref{KommSemProp}.1
  mindestens ein $P'\in\asimp (P)$ geben, für das $\varepsilon \in \ET _{P'}$
  gilt. Dies kann nur der Fall sein, wenn durch lokale Aktionen in $P'$
  ein Fehler-Zustand erreicht werden kann. Es ist also auch in der
  as"=Implementierung $P'$ ein Fehler lokal erreichbar, da \ET{} die Fortsetzungen
  von \PrET{} und \MIT{} enthält und Elemente aus \MIT{} mindestens die Länge 1
  haben müssen.

  (i) $\Leftarrow$:\\
  Sei $P'$ die as"=Implementierung von $P$, in der ein Fehler lokal erreichbar
  ist. Es gilt dann $\varepsilon\in \PrET (P') \subseteq \ET _{P'}$. Mit
  Proposition~\ref{KommSemProp}.1 folgt daraus $\varepsilon \in\ET _P$. Es
  muss also auch in $P$ ein Fehler-Zustand lokal erreichbar sein.

  (ii):\\
  Da für $P_1$ ein Fehler lokale erreichbar ist folgt mit 1.\, dass es auch
  eine as"=Implementierung $P'_1$ von $P_1$ gibt, für die ein Fehler lokal
  erreichbar ist. Mit $P_1\EBRel P_2$ ergibt sich daraus, dass es auch eine
  as"=Implementierung $P'_2$ von $P_2$ geben muss, die lokal einen
  Fehler-Zustand erreichen kann. $P_2$ muss aufgrund von 1.\ ebenfalls einen
  Fehler lokal erreichen können, da es eine as"=Implementierung gibt, die dies
  kann.
\end{proof}

\begin{Satz}[Kommunikationsfehler-Semantik für Parallelkompositionen]
  \label{KommFehlerSemSatz}
  Für zwei komponierbare \MEIO{}s $P_1,P_2$ und ihre Komposition $P_{12}$ gilt:
  \begin{enumerate}
    \item $\ET _{12} = \cont (\prune ((\ET _1\|\EL _2) \cup (\EL _1\|\ET
      _2)))$,
    \item $\EL _{12} = (\EL _1\|\EL _2) \cup \ET _{12}$.
  \end{enumerate}
\end{Satz}
\begin{proof}\mbox{}\\
  1. \glqq$\subseteq$\grqq{}:\\
  Da beide Seiten der Gleichung unter der Fortsetzungs-Funktion \cont{}
  abgeschlossen sind, genügt es ein präfix-minimales Element $w$ aus $\ET
  _{12}$ zu betrachten. Dieses Element ist aufgrund der Definition der Menge der
  Fehler-Traces in $\MIT _{12}$ oder in $\PrET _{12}$ enthalten.
  \begin{itemize}
    \item Fall 1 ($w\in\MIT _{12}$): Aus der Definition von \MIT{} folgt, dass
      es eine Aufteilung $w=va$ gibt mit $(p_{01},p_{02}) \weakmay[v]_{12}
      (p_1,p_2) \land a \in I_{12} \land (p_1,p_2) \nmust[a]_{12}$. Da $I_{12}
      = (I_1\cup I_2) \backslash (O_1\cup O_2)$ ist, folgt $a\in (I_1\cup I_2)$
      und $a\notin (O_1\cup O_2)$. Es wird unterschieden, ob $a\in (I_1\cap
      I_2)$ oder $a\in (I_1\cup I_2) \backslash (I_1\cap I_2)$ ist.
    \begin{itemize}
      \item Fall 1a) ($a\in (I_1\cap I_2)$): Durch Projektion des Ablaufes auf
        die einzelnen Transitionssysteme erhält man \oBdA{}
        $p_{01}\weakmay[v_1]_1 p_1\nmust[a]_1$ und $p_{02}\weakmay[v_2]_2
        p_2\nmust[a]_2$ oder $p_{02}\weakmay[v_2]_2 p_2\must[a]_2$ mit $v\in
        v_1\|v_2$. Daraus kann $v_1a\in MIT _1 \subseteq \ET _1$ und
        $v_2a\in \EL _2$ ($v_2a\in \MIT _2$ oder $v_2a \in L_2$) gefolgert
        werden. Damit folgt $w\in (v_1\|v_2) \cdot \{a\} =
        (v_1a)\|(v_2a)\subseteq \ET _1\|\EL _2$, und somit ist $w$ in der
        rechten Seite der Gleichung enthalten.
      \item Fall 1b) ($a\in (I_1\cup I_2)\backslash (I_1\cap I_2)$): \OBdA{}
        gilt $a\in I_1$. Durch die Projektion auf die einzelnen Komponenten
        erhält man: $p_{01}\weakmay[v_1]_1 p_1\nmust[a]_1$ und
        $p_{02}\weakmay[v_2]_2 p_2$ mit $v\in v_1\|v_2$. Daraus folgt $v_1a\in
        \MIT _1 \subseteq \ET _1$ und $v_2\in L_2\subseteq \EL _2$. Somit gilt
        $w\in (v_1\|v_2) \cdot \{a\} \subseteq (v_1a)\|v_2\subseteq \ET _1\|\EL
        _2$. Dies ist eine Teilmenge der rechten Seite der Gleichung.
    \end{itemize}
  \item Fall 2 ($w\in\PrET _{12}$): Aus der Definitionen von \PrET{} und
      \prune{} folgt, dass ein $v\in O_{12}^*$ existiert, so dass
      $(p_{01},p_{02}) \weakmay[w]_{12} (p_1,p_2) \weakmay[v]_{12} (p'_1,p'_2)$
      gilt mit $(p'_1,p'_2)\in E_{12}$ und $w=\prune (wv)$. Durch Projektion
      auf die Komponenten erhält man $p_{01} \weakmay[w_1]_1 p_1
      \weakmay[v_1]_1 p'_1$ und $p_{02} \weakmay[w_2]_2 p_2 \weakmay[v_2]_2
      p'_2$ mit $w\in w_1\|w_2$ und $v\in v_1\|v_2$. Aus $(p'_1,p'_2)\in\ET
      _{12}$ folgt, dass es sich bei dem Zustands"=Tupel entweder um einen
      geerbten oder einen neuen Fehler handelt. Bei einem geerbten Fehler wäre
      bereits einer der beiden Zustände $p'_1$ bzw.\ $p'_2$ ein Fehler"=Zustand
      gewesen. Ein neuer Fehler hingegen wäre durch das fehlende Sicherstellen
      der Synchronisation (fehlende must"=Input"=Transition) in einer der
      Komponenten entstanden.
    \begin{itemize}
      \item Fall 2a) (geerbter Fehler): \OBdA{} gilt $p'_1\in E_1$. Daraus
        folgt, $w_1v_1\in StET_1 \subseteq \cont (\PrET _1) \subseteq \ET _1$.
        Da $p_{02} \weakmay[w_2v_2]_2$ gilt, erhält man $w_2v_2\in L_2\subseteq
        \EL _2$. Dadurch ergibt sich $wv\in \ET _1\|\EL _2$ mit $w=\prune (wv)$
        und somit ist $w$ in der rechten Seite der Gleichung enthalten.
      \item Fall 2b) (neuer Fehler): \OBdA{} gilt $a\in I_1\cap O_2$ mit
        $p'_1\nmust[a]_1$ und $p'_2\may[a]_2$. Daraus folgt $w_1v_1a\in \MIT _1
        \subseteq \ET _1$ und $w_2v_2a\in L_2 \subseteq \EL _2$. Damit ergibt
        sich $wva\in \ET _1\|\EL_2$, da $a\in O_1\subseteq O_{12}$ gilt
        $w=\prune (wva)$ und somit ist $w$ in der rechten Seite der Gleichung
        enthalten.
    \end{itemize}
  \end{itemize}

  1. \glqq$\supseteq$\grqq{}:\\
  Wegen der Abgeschlossenheit beider Seiten der Gleichung gegenüber \cont{}
  wird auch in diesem Fall nur ein präfix-minimales Element $x\in\prune ((\ET
  _1\|\EL _2)\cup (\EL _1\| \ET _2))$ betrachtet. Da $x$ durch die Anwendung
  der \prune{}-Funktion entstanden ist, existiert ein $y\in O_{12} ^*$ mit
  $xy\in (\ET _1\|\EL _2)\cup (\EL _1\| \ET _2)$. \OBdA{} wird davon
  ausgegangen, dass $xy\in \ET _1\| \EL _2$ gilt, d.h.\ es gibt $w_1\in \ET _1$
  und $w_2\in \EL _2$ mit $xy \in w_1\| w_2$.\\
  Im Folgenden wird für alle Fälle von $xy$ gezeigt, dass es ein $v\in \PrET
  _{12} \cup \MIT _{12}$ gibt, das ein Präfix von $xy$ ist. Also: entweder
  endet $v$ auf einen Input $I_{12}$ oder $v=\varepsilon$. Damit muss $v$ ein
  Präfix von $x$ sein, denn $\varepsilon$ ist Präfix von jedem Wort und sobald
  $v$ mindestens einen Buchstaben enthält, muss das Ende von $v$ vor dem Anfang
  von $y\in O_{12}^*$ liegen. Dadurch ist ein Präfix von $x$ in $\PrET
  _{12}\cup \MIT _{12}$ enthalten und somit gilt $x\in \ET _{12}$, da \ET{} die
  Fortsetzung der Mengenvereinigung aus \PrET{} und \MIT{} ist.\\
  Sei $v_1$ das kürzeste Präfix von $w_1$ in $\PrET _1\cup \MIT _1$. Falls $w_2
  \in L_2$, so sei $v_2=w_2$, sonst soll $v_2$ das kürzeste Präfix von $w_2$ in
  $\PrET _2\cup \MIT _2$ sein. Jede Aktion in $v_1$ und $v_2$ hängt mit einer
  aus $xy$ zusammen. Es kann nun davon ausgegangen werden, dass entweder $v_2 =
  w_2\in L_2$ gilt oder die letzte Aktion von $v_1$ vor oder gleichzeitig mit
  der letzten Aktion von $v_2$ statt findet. Ansonsten endet $v_2 \in \PrET
  _2\cup \MIT _2$ vor $v_1$. Es gilt dann $w_2\in\ET _2$ und somit ist dieser
  Fall analog zu $v_1$ endet vor $v_2$.
  \begin{itemize}
    \item Fall 1 ($v_1=\varepsilon$): Da $\varepsilon\in\PrET _1\cup \MIT _1$,
      ist bereits in $P_1$ ein Fehler"=Zustand lokal erreichbar. $\varepsilon
      \in \MIT _1$ ist nicht möglich, da jedes Element aus \MIT{} nach
      Definition mindestens die Länge $1$ haben muss. Mit der Wahl
      $v'_2=v'=\varepsilon$ ist $v'_2$ ein Präfix von $v_2$.
    \item Fall 2 ($v_1\neq\varepsilon$): Aufgrund der Definitionen von \PrET{}
      und \MIT{} endet $v_1$ auf ein $a\in I_1$, d.h.\ $v_1=v'_1a$. $v'$ sei
      das Präfix von $xy$, das mit der letzten Aktion von $v_1$ endet, d.h.\
      mit $a$ und $v'_2=v'|_{\Sigma _2}$. Falls $v_2=w_2\in L_2$, dann ist
      $v'_2$ ein Präfix von $v_2$. Falls $v_2\in \PrET _2\cup \MIT _2$ gilt,
      dann ist durch die Annahme, dass $v_2$ nicht vor $v_1$ endet, $v'_2$ ein
      Präfix von $v_2$. Im Fall $v_2 \in \MIT _2$ weiß man zusätzlich, dass
      $v_2$ auf $b\in I_2$ endet. Es kann jedoch $a=b$ gelten.
  \end{itemize}
  In den beiden vorangegangen Fällen erhält man $v'_2=v'|_{\Sigma _2}$ ist ein
  Präfix von $v_2$ und $v'\in v_1\|v'_2$ ist ein Präfix von $xy$. Es kann nur
  für die Fälle $a\notin I_2$ gefolgert werden, dass $p_{02} \weakmay[v'_2]_2$
  gilt. (*) Falls $p_{02} \weakmay[v'_2]$ nicht gilt, ist $v'_2=v_2\in\MIT _2$ und
  $v'_2$ endet auf $b=a\in I_2$.
  \begin{itemize}
    \item Fall I ($v_1\in\MIT _1$): Da $v_1\in\MIT _1$ gilt, muss $v_1$
      ungleich $\varepsilon$ sein. Es gibt einen Ablauf der Form
      $p_{01}\weakmay[v'_1]_1p_1\nmust[a]_1$ und es gilt $v'=v''a$.
      \begin{itemize}
        \item Fall Ia) ($a\notin\Sigma _2$): Es gilt $p_{02}\weakmay[v'_2]_2
          p_2$ mit $v''\in v'_1\|v'_2$. Dadurch erhält man $(p_{01},p_{02})
          \weakmay[v'']_{12} (p_1,p_2) \nmust[a]_{12}$ mit $a\in I_{12}$. Somit
          wird $v := v''a=v'\in\MIT _{12}$ gewählt.
        \item Fall Ib) ($a\in I_2$ und $v'_2\in\MIT _2$): Es gilt $v'_2=v''_2a$
          mit $p_{02}\weakmay[v''_2]_2 p_2 \nmust[a]_2$ und $v''\in
          v'_1\|v''_2$. $a$ ist für $P_2$, ebenso wie für $P_1$ ein nicht
          sichergestellter Input. Daraus folgt, dass $(p_1,p_2)\nmust[a]_{12}$
          gilt. Es wird ebenfalls $v := v''a=v'\in\MIT _{12}$ gewählt.
        \item Fall Ic) ($a\in I_2$ und $v'_2\notin\MIT _2$): Es gilt
          $p_{02}\weakmay[v''_2]_2p_2\must[a]_2$ mit $v'_2=v''_2a \in L_2$,
          wegen (*). Da die gemeinsamen Inputs synchronisiert werden, folgt
          bereits aus $p_1\nmust[a]_1$ $(p_1,p_2) \nmust[a]_{12}$. Somit kann
          hier nochmals $v:=v''a=v'\in \MIT _{12}$ gewählt werden.
        \item Fall Id) ($a\in O_2$): Es gilt $v'_2=v''_2a$ und $p_{02}
          \weakmay[v'_2]_2$. Man erhält also $p_{02}\weakmay[v''_2]_2 p_2
          \may[a]_2$ mit $v''\in v'_1\|v''_2$. Daraus ergibt sich
          $(p_{01},p_{02}) \weakmay[v'']_{12} (p_1,p_2)$ mit $p_2\may[a]_2$,
          $p_1\nmust[a]_1, a\in I_1$ und $a\in O_2$, somit gilt $(p_1,p_2)\in
          E_{12}$. Es wird $v:= \prune (v'')\in\PrET _{12}$ gewählt.
      \end{itemize}
    \item Fall II ($v_1\in\PrET _1$): $\exists u_1\in O_1^*: p_{01}
      \weakmay[v_1]_1 p_1 \weakmay[u_1]_1 p'_1$ mit $p'_1\in E_1$. Im Fall $v_1
      \neq\varepsilon$ kann das $a$, auf das $v_1$ endet, ebenfalls der letzte
      Buchstabe von $v_2$ sein. Im Fall von $v_2\in\MIT _2$ kann somit $a=b$
      gelten, wodurch $v_2=v'_2$ gilt. Dieser Fall verläuft jedoch analog zu
      Fall Ic) und wird hier nicht weiter betrachtet. Für alle anderen Fälle
      gilt $p_{02}\weakmay[v'_2]_2p_2$ mit $(p_{01},p_{02}) \weakmay[v']_{12}
      (p_1,p_2)$.
      \begin{itemize}
        \item Fall IIa) \big($u_2\in (O_1\cap I_2)^*,c\in (O_1\cap I_2)$,
          so dass $u_2c$ Präfix von $u_1|_{I_2}$ mit $p_2 \weakmust[u_2]_2 p'_2
          \nmust[c]_2$\big): Für das Präfix $u'_1c$ von $u_1$ mit
          $(u'_1c)|_{I_2}=u_2c$ weiß man, dass $p_1\weakmay[u'_1]_1 p''_1
          \may[c]_1$. Somit gilt $u'_1\in u'_1\|u_2$ und $(p_1,p_2)
          \weakmay[u'_1]_{12} (p''_1,p'_2)\in E_{12}$, da für $P_2$ der
          entsprechende Input nicht sichergestellt wird, der mit dem $c$ Output
          von $P_1$ zu synchronisieren wäre. Es handelt sich also um einen
          neuen Fehler. Es wird $v := \prune (v'u'_1)\in \PrET _{12}$
          gewählt, dies ist ein Präfix von $v'$, da $u_1\in O_1^*$.
        \item Fall IIb) \big($p_2\weakmust[u_2]_2p'_2$ mit
          $u_2=u_1|_{I_2}$\big): Es gilt $u_1\in u_1\|u_2$ und $(p_1,p_2)
          \weakmay[u_1]_{12} (p'_1,p'_2)\in E_{12}$, da $p'_1\in E_1$ und somit
          handelt es sich in $P_{12}$ um einen geerbten Fehler. Nun wird
          $v:=\prune (v'u_1)\in\PrET _{12}$ gewählt, das wiederum ein Präfix
          von $v'$ ist.
      \end{itemize}
  \end{itemize}

  2.:\\
  Durch die Definitionen ist klar, dass $L_j\subseteq \EL _j$ und $\ET
  _j\subseteq \EL _j$ gilt. Die Argumentation startet auf den rechten Seite der
  Gleichung:
  {\allowdisplaybreaks
  \begin{align*}
    (\EL{}_1\| \EL{}_2)\cup
    \ET{}_{12}&\overset{\ref{KommFehlerSemDef}}{=}\left(\left(L_1\cup
    \ET{}_1\right)\|\left(L_2\cup \ET{}_2\right)\right)\cup \ET{}_{12}\\
    &=(L_1\|L_2) \cup \underset{\overset{1.}{\subseteq}
    \ET{}_{12}}{\underset{\subseteq
    (\EL{}_1\|\ET{}_2)}{\underbrace{(L_1\|\ET{}_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \ET{}_{12}}{\underset{\subseteq
    (\ET{}_1\|\EL{}_2)}{\underbrace{(\ET{}_1\|L_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \ET{}_{12}}{\underset{\subseteq
    (\EL{}_1\|\ET{}_2)}{\underbrace{(\ET{}_1\|\ET{}_2)}}} \cup \ET{}_{12}\\
    &=(L_1\|L_2) \cup \ET{}_{12}\\
    &\overset{\ref{LParallelProp}}{=}L_{12}\cup \ET{}_{12}\\
    &\overset{\ref{KommFehlerSemDef}}{=}\EL{}_{12}.
  \end{align*}}
\end{proof}

\begin{Kor}[Kommunikationsfehler-Präkongruenz]
  \label{KommPraekonKor}
  Die Relation \ERel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{Kor}
\begin{proof}
  Es muss nachgewiesen werden: Wenn $P_1\ERel P_2$ gilt, dann für jedes
  komponierbare $P_3$ auch $P_{31}\ERel P_{32}$. D.h.\ es ist zu zeigen,
  dass aus $\ET{}_1\subseteq \ET{}_2$ und $\EL{}_1\subseteq \EL{}_2$,
  $\ET{}_{31}\subseteq \ET{}_{32}$ und $\EL{}_{31}\subseteq
  \EL{}_{32}$ folgt. Dies ergibt sich aus der Monotonie von \cont{},
  \prune{} und $\cdot \|\cdot$ auf Sprachen wie folgt:\\
  \begin{itemize}
    \item $\begin{aligned}[t]
        \ET{}_{31} &\overset{\ref{KommFehlerSemSatz}.1}{=}
      \cont{}\left(\prune{}\left(\left(\ET{}_3\|\EL{}_1\right)\cup
          \left(\EL{}_3\|\ET{}_1\right)\right)\right)\\
      &\hspace{-0.4cm}\overset{\ET{}_1\subseteq
    \ET{}_2}{\overset{\mathrm{und}}{\overset{\EL{}_1\subseteq \EL{}_2}{\subseteq}}}
    \cont{}\left(\prune{}\left(\left(\ET{}_3\|\EL{}_2\right)\cup
        \left(\EL{}_3\|\ET{}_2\right)\right)\right)\\
    &\overset{\ref{KommFehlerSemSatz}.1}{=} \ET{}_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \EL{}_{31} &\overset{\ref{KommFehlerSemSatz}.2}{=}
        (\EL{}_3\|\EL{}_1)\cup E_{31}\\
        &\hspace{-0.5cm}\overset{\EL{}_1\subseteq
      \EL{}_2}{\overset{\mathrm{und}}{\overset{\ET{}_{31}\subseteq
      \ET{}_{32}}{\subseteq}}} (\EL{}_3\|\EL{}_2)\cup \ET{}_{32}\\
      &\overset{\ref{KommFehlerSemSatz}.2}{=} \EL{}_{32}.
    \end{aligned}$
  \end{itemize}
\end{proof}

\begin{Lem}[Verfeinerung mit Kommunikationsfehlern]
  \label{KommVerfeinLem}
  Gegeben sind zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur. Wenn
  $U\|P_1\EBRel{} U\|P_2$ für alle Partner $U$ gilt, dann folgt daraus die
  Gültigkeit von $P_1\ERel{} P_2$.
\end{Lem}
\begin{proof}
  Da $P_1$ und $P_2$ die gleiche Signaturen haben, wird $I:=I_1=I_2$ und
  $O:=O_1=O_2$ definiert. Für jeden Partner $U$ gilt $I_U=O$ und $O_U=I$.\\
  Um $P_1\ERel{}P_2$ zu zeigen wird nachgeprüft, ob folgendes gilt:
  \begin{itemize}
    \item $\ET _1\subseteq \ET _2$,
    \item $\EL _1\subseteq \EL _2$.
  \end{itemize}
  Für ein gewähltes präfix-minimales Element $w\in\ET _1$ wir gezeigt, dass
  dieses $w$ oder eines seiner Präfixe in $\ET _2$ enthalten ist. Dies ist
  möglich, da die beiden Mengen $\ET _1$ und $\ET _2$ durch \cont{}
  abgeschlossen sind.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Fehler-Zustand in $P_1$. Für $U$ wird ein Transitionssystem verwendet,
      das nur aus dem Startzustand und einer must-Schleife für alle Inputs
      $x\in I_U$ besteht. Somit kann $P_1$ die im Prinzip gleichen
      Fehler-Zustände lokal erreichen wie $U\|P_1$.
      Wegen~\ref{lokalFehlerErrKor}~(ii) erreicht auch $U\|P_2$ lokal einen
      Fehler-Zustand. Durch die Definition von $U$ kann dieser Fehler nur von
      $P_2$ geerbt sein. Es muss also in $P_2$ ein Fehler-Zustand durch interne
      Aktionen und Outputs erreichbar sein, d.h.\ es gilt $\varepsilon\in
      \PrET{}_2$.
    \item Fall 2 ($w=x_1\dots x_n x_{n+1}\in\Sigma ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I = O_U$): Es wird der folgende Partner $U$ betrachtet (siehe
      auch Abbildung~\ref{UohneE}):
      \begin{itemize}
        \item $U=\{p_0,p_1,\dots ,p_{n+1}\}$,
        \item $p_{0U}=p_0$,
        \item $\begin{aligned}[t]
            \may _U = \must _U&=\left\{(p_j,x_{j+1},p_{j+1})\mid  0\leq j\leq
            n\right\}\\
            &\cup\left\{(p_j,x,p_{n+1})\mid  x\in I_U\backslash\{x_{j+1}\},
            0\leq j\leq n\right\}\\
            &\cup\left\{(p_{n+1},x,p_{n+1})\mid  x\in I_U\right\},
        \end{aligned}$
        \item $E_U=\emptyset$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[auto,node distance =3cm, semithick]

          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$p_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$p_{n+1}$};

          \path[line width=1pt] (dots) edge [loosely dotted] (n1);

          \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (n1)
                (dots) edge node {$x_n$} (n)
                (n) edge node [above, sloped] {$x?\in I_U$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_U$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_U\backslash\{x_j\}$}
      \label{UohneE}
      \end{center}
      \end{figure}
      Für $w$ können nun zwei Fälle unterschieden werden. Aus beiden wird
      folgen, dass $\varepsilon\in\PrET(U\|P_1)$ gilt.
      \begin{itemize}
        \item Fall 2a) ($w\in\MIT _1$): In $U\|P_1$ erhält man $(p_0,p_{01})
          \lweakmay[x_1\dots x_n]_{U\|P_1} (p_n,p')$ mit $p'\nmust[x_{n+1}]_1$
          und $p_n\must[x_{n+1}]_U$. Deshalb ist $(p_n,p')$ ein Element der
          Menge $E_{U\|P_1}$. Da alle Aktionen aus $w$ bis auf $x_{n+1}$
          synchronisiert werden und $I\cap I_U=\emptyset$, gilt $x_1,\dots ,
          x_n\in O_{U\|P_1}$. Da $(p_n,p')\in E_{U\|P_1}$ in $U\|P_1$ lokal
          erreichbar ist gilt $\varepsilon\in\PrET (U\|P_1)$.
        \item Fall 2b) ($w\in\PrET _1$): In der Parallelkomposition von $U$ und
          $P_1$ erhält man $(p_0,p_{01}) \weakmay[w]_{U\|P_1} (p_{n+1},p'')
          \weakmay[v]_{U\|P_1} (p_{n+1},p')$ für $v\in O^*$ und $p'\in E_1$.
          Daraus folgt $(p_{n+1},p')\in E_{U\|P_1}$ und somit $wv\in\StET
          (U\|P_1)$. Da alle Aktionen in $w$ synchronisiert werden und $I\cap
          I_U=\emptyset$, gilt $x_1,\dots ,x_n,x_{n+1}\in O_{U\|P_1}$ und, da
          $v\in O^*$, folgt $v\in O_{U\|P_1}^*$. Somit ergibt sich
          $\varepsilon\in\PrET (U\|P_1)$.
      \end{itemize}
      Da $\varepsilon\in\PrET (U\|P_1)$ gilt, kann durch $U\|P_1\EBRel U\|P_2$
      unter Zuhilfenahme von Korollar~\ref{lokalFehlerErrKor}~(ii) geschlossen
      werden, dass auch in $U\|P_2$ ein Fehler-Zustand lokal erreichbar sein
      muss.\\
      Der in $U\|P_2$ lokal erreichbare Fehler kann geerbt oder neu sein.
      \begin{itemize}
        \item Fall 2i) (neuer Fehler): Da jeder Zustand von $U$ alle Inputs
          $x\in O=I_U$ durch must"=Transitionen sicherstellt, muss ein lokal
          erreichbarer Fehler-Zustand der Form sein, dass ein Output $a\in O_U$
          von $U$ möglich ist, dessen Synchronisation mit einem passenden Input
          in $P_2$ nicht sichergestellt ist ($P_2$ enthält die entsprechende
          $a$ Transitionen nicht als must"=Transition). Durch die Konstruktion
          von $U$ sind in $p_{n+1}$ keine Outputs möglich. Ein neuer Fehler
          muss also die Form $(p_j,p')$ haben mit $j\leq n,
          p'\nmust[x_{j+1}]_2$ und $x_{j+1}\in O_U=I$. Durch Projektion erhält
          man dann $p_{02}\lweakmay[x_1\dots x_j]_2p'\nmust[x_{j+1}]_2$ und
          damit gilt $x_1\dots x_{j+1}\in\MIT _2\subseteq \ET _2$. Somit ist
          ein Präfix von $w$ in $\ET _2$ enthalten.
        \item Fall 2ii) (geerbter Fehler): $U$ hat $x_1\dots x_jv$ mit $v\in
          I_U^*=O^*$ ausgeführt und ebenso hat $P_2$ dieses Wort abgearbeitet.
          Durch dies hat $P_2$ einen Zustand  in $E_2$ erreicht, da von $U$
          keine Fehler geerbt werden können. Es gilt dann $\prune (x_1\dots
          x_j v) = \prune (x_1\dots x_j)\in\PrET _2\subseteq \ET _2$. Da
          $x_1\dots x_j$ ein Präfix von $w$ ist, führt in diesem Fall eine
          Verlängerung um lokale Aktionen eines Präfix von $w$ zu einem
          Fehler-Zustand. Da \ET{} der Menge aller Verlängerungen von gekürzten
          Fehler-Traces entspricht, ist $x_1\dots x_j$ in $\ET
          _2$ enthalten und somit gilt auch $w\in\ET _2$.
      \end{itemize}
  \end{itemize}

  Um die andere Inklusion zu beweisen, reicht es aufgrund der ersten
  Inklusion und der Definition von \EL{} aus zu zeigen, dass $L_1\backslash\ET
  _1\subseteq \EL _2$ gilt.\\
  Es wird dafür ein beliebiges $w\in L_1\backslash \ET _1$ gewählt und gezeigt,
  dass es in $\EL _2$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Da $\varepsilon$ immer in $\EL _2$
      enthalten ist, muss hier nichts gezeigt werden.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Es wird ein Partner $U$ wie
      folgt konstruiert (siehe dazu auch Abbildung~\ref{UmitE}):
      \begin{itemize}
        \item $U=\{p_0,p_1,\dots ,p_n,p\}$,
        \item $p_{0U}=p_0$,
        \item $\begin{aligned}[t]
            \may _U = \must _U&=\left\{(p_j,x_{j+1},p_{j+1})\mid 0\leq j<
            n\right\}\\
            &\cup\left\{(p_j,x,p)\mid x\in I_U\backslash\{x_{j+1}\},0\leq j<
            n\right\}\\
            &\cup\left\{(p,x,p)\mid x\in I_U\right\},
        \end{aligned}$
        \item $E_U=\{p_n\}$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[auto,node distance =3cm, semithick]

          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$p_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$p_n\in E_U$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$p$};

          \path[line width=1pt] (dots) edge [loosely dotted] (q);

          \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (q)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (q)
                (dots) edge node {$x_{n-1}$} (n1)
                (n1) edge node {$x_n$} (n)
                edge [bend left] node [below, sloped] {$x?\neq x_n$} (q)
                (q) edge [loop below] node {$x?\in I_U$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_U\backslash\{x_j\}$, $p_n$
          ist der einzige Fehler-Zustand}
      \label{UmitE}
      \end{center}
      \end{figure}
      Da $p_{01}\weakmay[w]_1p'$ gilt, kann man schließen, dass $U\|P_1$ einen
      lokal erreichbaren geerbten Fehler hat. Aufgrund von
      Korollar~\ref{lokalFehlerErrKor}~(ii) muss ebenfalls ein Fehler-Zustand
      in $U\|P_2$ lokal erreichbar sein.
      \begin{itemize}
        \item Fall 2a) (neuer Fehler aufgrund von $x_j\in O_U$ und $p_{02}
          \lweakmay[x_1\dots x_{j-1}]_2p''\nmust[x_j]_2$): Es gilt $x_1\dots
          x_j\in \MIT _2$ und somit $w\in \EL_2$. Anzumerken ist, dass nur
          auf diesem Weg Outputs von $U$ möglich sind, deshalb gibt es keine
          anderen Outputs von $U$, die zu einem neuen Fehler führen könnten.
        \item Fall 2b) (neuer Fehler aufgrund von $a\in O=I_U$): Der einzige
          Zustand, in dem $U$ nicht alle Inputs erlaubt sind, ist $p_n$, der
          bereits ein Fehler-Zustand ist. Da in diesem Fall der Fehler-Zustand
          in $U\|P_2$ erreichbar ist, besitzt das komponierte \MEIO{} einen
          geerbten Fehler und es gilt $w\in L_2\subseteq \EL _2$ wegen des
          folgenden Falles 2c).
        \item Fall 2c) (geerbter Fehler von $U$): Da $p_n$ der einzige
          Fehler"=Zustand in $U$ ist und alle Aktionen synchronisiert werden,
          ist dies nur möglich, wenn $p_{02} \lweakmay[x_1\dots x_n]_2$ gilt.
          In diesem Fall ist $w$ ausführbar und es gilt $w\in L_2\subseteq \EL
          _2$.
        \item Fall 2d) (geerbter Fehler von $P_2$): Es gilt $p_{02}
          \lweakmay[x_1\dots x_jv]_2 p'\in E_2$ für ein $j\geq 0$ und $v\in
          O^*$. Somit ist $x_1\dots x_j v\in\StET _2$ und damit $\prune
          (x_1\dots x_j v) =\prune (x_1\dots x_j)\in\PrET _2\subseteq \EL _2$.
          Es gilt also $w\in\EL _2$.
      \end{itemize}
  \end{itemize}
\end{proof}

Der folgende Satz sagt aus, dass \ERel{} die gröbste Präkongruenz ist, die
charakterisiert werden soll, also gleich der vollständig abstrakten
Präkongruenz \ECRel{}.

\begin{Satz}[Vollständige Abstraktheit für Kommunikationsfehler-Semantik]
  \label{KommVollAbstraktSatz}
  Für zwei \MEIO{}s $P_1$ und $P_2$ mit derselben Signatur gilt $P_1\ECRel
  P_2\Leftrightarrow P_1\ERel{} P_2$.
\end{Satz}
\begin{proof}\mbox{}\\
  \glqq$\Leftarrow$\grqq: Nach Definition gilt, genau dann wenn
  $\varepsilon\in\ET (P)$, ist ein Fehler-Zustand lokal erreichbar in $P$. $P_1
  \ERel P_2$ impliziert, dass $\varepsilon\in\ET _2$ gilt, wenn
  $\varepsilon\in\ET _1$. Somit ist ein Fehler-Zustand in $P_1$ nur dann lokal
  erreichbar, wenn dieser auch in $P_2$ lokal erreichbar ist. Falls es also
  eine as"=Implementierung von $P_1$ gibt, in der ein Fehler-Zustand lokal
  erreichbar ist, dann gibt es auch mindestens eine as"=Implementierung von
  $P_2$, die einen Fehler-Zustand lokal erreichen kann. Diese
  as"=Implementierung muss es wegen Korollar~\ref{lokalFehlerErrKor}~(i) geben,
  wenn $P_1$ und $P_2$ lokal erreichbare Fehler enthalten. Daraus folgt, dass
  $P_1\EBRel P_2$ gilt, da \EBRel{} in Definition~\ref{EBRelDef} über die
  lokale Erreichbarkeit der Fehler-Zustande in den as"=Implementierungen
  definiert wurde. Es ist also \ERel{} in \EBRel{} enthalten. Wie in
  Korollar~\ref{KommPraekonKor} gezeigt, ist \ERel{} eine Präkongruenz
  bezüglich $\cdot\|\cdot$. Da \ECRel{} die gröbste Präkongruenz bezüglich
  $\cdot\|\cdot$ ist, die in \EBRel{} enthalten ist, muss \ERel{} in \ECRel{}
  enthalten sein. Es folgt also aus $P_1\ERel P_2$, dass auch $P_1\ECRel P_2$
  gilt.

  \glqq$\Rightarrow$\grqq: Durch die Definition von \ECRel{} als Präkongruenz
  in~\ref{EBRelDef} folgt aus $P_1\ECRel{} P_2$, dass $U\|P_1\ECRel U\|P_2$ für
  alle \MEIO{}s $U$ gilt, die mit $P_1$ komponierbar sind. Da \ECRel{} nach
  Definition auch in \EBRel{} enthalten ist, folgt aus $U\|P_1\ECRel{}
  U\|P_2$ auch die Gültigkeit von $U\|P_1\EBRel{}U\|P_2$ für alle diese
  \MEIO{}s $U$. Mit Lemma~\ref{KommVerfeinLem} folgt dann $P_1\ERel{} P_2$.
\end{proof}

Es wurde somit eine Kette an Folgerungen gezeigt, die sich zu einem Ring
schließt. Dies ist in Abbildung~\ref{KommFolgerungskette} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}[scale = 3]
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        P_1\ERel P_2 & P_1\ECRel P_2 \\
        \substack{\forall~\mathrm{Partner}~U:\\U\|P_1\EBRel U\|P_2} &
    \substack{\forall~\mathrm{komponierbaren}~U:\\U\|P_1\EBRel U\|P_2} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
            Satz~\ref{KommVollAbstraktSatz}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition von \ECRel{}
          in~\ref{EBRelDef}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{KommVerfeinLem}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
          (m-2-2) -- node [below]
          {$\substack{U~\mathrm{Partner}\\\Downarrow\\
          U~\mathrm{komponierbar}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette der Fehler-Relationen}
  \label{KommFolgerungskette}
  \end{center}
\end{figure}

Angenommen man definiert, dass $P_1$ $P_2$ verfeinern soll, genau dann wenn für
alle Partner \MEIO{}s $U$ für die $P_2$ fehler-frei mit $U$ kommuniziert,
folgt, dass $P_1$ ebenfalls fehler-frei mit $U$ kommuniziert. Dann wird auch
diese Verfeinerung durch \ERel{} charakterisiert.

\begin{Kor}
  Es gilt: $P_1\ERel P_2\Leftrightarrow U\|P_1\EBRel U\|P_2$ für alle Partner
  $U$.
\end{Kor}
