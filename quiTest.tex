\section{Testing-Ansatz}

Zustände, die keine must-Transitionen für lokale Aktionen ohne einen Input
ausführen können, werden als in einer Art Verklemmung angesehen, da sie ohne
Zutun von Außen den Zustand nicht mehr verlassen können, falls ein
möglicherweise vorhandener may"=Transition für lokale Aktionen nicht
implementiert wird. So ein Zustand hat also keine
must"=Transitions"=Möglichkeiten für einen lokale Aktion, es ist also ein
Deadlock-Zustand, in denen das System nichts mehr tun können muss ohne einen
Input. Diese Zustände werden in dieser Arbeit als sill bezeichnet, da wenn
dieser Zustand erreicht wird, dass System still steht bis die Umwelt eine
Aktion ausführt.

\begin{Def}[Stillstand]
  Ein \emph{stiller Zustand} ist ein Zustand in einem \MEIO{} $P$, der keine
  Outputs und kein $\tau$ zulässt via must"=Transitionen.\\
  Somit ist die Menge der stillen Zustände in einem \MEIO{} $P$ wie folgt
  formal definiert: $Qui(P):=\left\{p\in P\mid \forall\alpha\in
  (O\cup\{\tau\}):p \nmust[\alpha]_P\right\}$.
\end{Def}

Der Ansatz, dass stille Zustände keine Output und keine $\tau$-Transitionen
sicherstellen basiert auf der Definition der Stille für \EIO{}s in
z.B.~\cite{Schinko2016BA}.\\
Alternativ wäre es auch möglich gewesen eine andere Betrachtung zu wählen, die
für Stille Zustände nur fordert, dass keine must"=Outputs möglich sein dürfen.
Falls dieser Zustand die Möglichkeit für eine interne Aktion via einer
must"=Transition hat, darf durch die $\tau$s niemals ein Zustand erreicht
werden, von dem aus ein Output in Implementierungen sicher gestellt wird.
Zusätzlich zu den in dieser Arbeit betrachteten Verklemmungen der Art Deadlock,
lässt die Betrachtungsweise mit den zugelassenen $\tau$-must"=Transitionen auch
Verklemmungen der Art Livelock zu, da diese Zustände möglicherweise beliebig
viele interne Aktionen ausführen können, jedoch nie aus eigener Kraft einen
wirklichen Fortschritt in Form eines Outputs bewirken können müssen. Die Menge
der Zustände, die sich in einer Verklemmung befinden, würde also in einer
einer alternativen Betrachtung durch $\left\{p\in P\mid \forall a\in O:
p\nweakmust[a]_P \right\}$ beschrieben werden. Somit wären dies alle Zustände,
die keine Möglichkeit haben ohne einen Input von Außen oder eine implementierte
may"=Output"=Transition je wieder einen Output machen zu können. Falls man
diese Definition verwenden würde, müsste man immer alle Zustände betrachten,
die durch $\tau$s erreichbar sind. Es ist unklar, zu Konsequenzen dies führen
kann. Vor allem im Bezug auf Hiding ist es schwierig, da unterschiedliche
Transitionen in einem System zu unterschiedlichem Verhalten führen, obwohl sie
von der Transitionsbeschriftung her nicht zu unterscheiden sind. Hierzu ist
auch das Beispiel in Abbildung~\ref{QuiTracesBsp} zu beachten. Die Sprachen
beider \MEIO{}s sind gleich und auch die strikten stille Traces stimmen
überein, da jeweils durch beliebig viele $o$s (mindestens eins), die von einem
$o'$ gefolgt werden eine ruhiger Zustand erreicht wird. Bei $P$ ist dies immer
möglich. Falls aber in $Q$ die erste $o$ Transition nach rechts ausgeführt
wird, kann kein stiller Zustand mehr erreicht werden. Die \MEIO{}s können also
auf Trace-Ebenen nicht von einander unterschieden werden, jedoch können durch
lokal Entscheidungen sehr verschiedenen Ergebnisse entstehen. Falls man das $o$
durch Hiding in ein $\tau$ umwandelt, wäre $p_1$ sicher nicht still. $q_{12}$
hingegen würde in der alternativen Betrachtung still werden. Die davor über die
Trace-Mengen nicht unterscheidbaren Systeme würden durch Hiding dann einen
Unterschied in den Trace-Mengen aufweisen.

\begin{figure}[htbp]
  \begin{center}
    \begin{tikzpicture}[->, >=latex', auto,node distance=2.5cm, semithick]
      \node [initial above,initial text=$Q$:] (q0) at (0,0) {$q_0$};
      \node (q11) [below left of=q0] {$q_{11}$};
      \node (q12) [below right of=q0] {$q_{12}$};
      \node (q2) [below of=q11] {$q_2$};

      \path
      (q0) edge node[swap]{$o$} (q11)
      (q0) edge node{$o$} (q12)
      (q11) edge node{$o'$} (q2)
      (q11) edge[loop left] node{$o$} (q11)
      (q12) edge[loop right] node{$o$} (q12)
      ;

      \node [initial above,initial text=$P$:] (p0) at (7,0) {$p_0$};
      \node (p1) [below of=p0] {$p_1$};
      \node (p2) [below of=p1] {$p_2$};

      \path
      (p0) edge node{$o$} (p1)
      (p1) edge[loop left] node{$o$} (p1)
      (p1) edge node{$o'$} (p2)
      ;
    \end{tikzpicture}
    \caption{}
    \label{QuiTracesBsp}
  \end{center}
\end{figure}

Im nächsten Kapitel, in dem Zustände mit Divergenz betrachtet werden, heben
sich die Unterschiede in den Trace-Mengen, die die beiden unterschiedlichen
Ansätze hier erzeugen würden auf. Da die Zustände die eine unendliche Folge an
$\tau$s ausführen können als divergent betrachtet werden und die Stille als
nicht so schlimm angesehen wird und auf Trace-Ebene somit geflutet wird.

Ob ein stiller Zustand relevant ist für einen Transitionssystem wird wie im
letzten Kapitel für die Fehler"=Zustände ein optimistischer Ansatz der lokalen
Erreichbarkeit verwendet. Stille ist aber keine unabwendbare \glqq
Fehler-Art\grqq{}, sondern kann durch einen Input repariert werden oder im Fall
von vorhandenen may"=Output"=Transitionen oder may"=$\tau$"=Transitionen, durch
eine Implementierung dieser lokalen Aktionen. Daraus ergibt sich, dass Stille
im Vergleich zu den Fehlern aus dem letzten Kapitel als weniger \glqq schlimmer
Fehler\grqq{} anzusehen ist. Somit ist ein stiller Zustand ebenso wie ein
Fehler-Zustand unmittelbar relevant, sobald er durch Outputs und $\tau$s
erreicht werden kann, jedoch ist nicht jede beliebige Fortsetzung eines Traces,
das durch lokale Aktionen zu einem stillen Zustand führt ein Stille"=Trace.

\begin{Def}[Test und Verfeinerung für Stillstand]
  \label{StilleTestDef}
  Sei $P$ ein \MEIO{}. Ein \emph{Test} $T$ für $P$ ist eine zu $P$
  komponierbare Implementierung. $P$ \emph{as-erfüllt} $T$ als einen
  Stillstands-Test, falls $S\|T$ lokal fehler- und
  stillstand-frei ist für alle $S\in \asimp (P)$. Es wird dann $P \QsatAs T$
  geschrieben. Die Parallelkomposition $S\|T$ ist \emph{lokal fehler-} und
  \emph{stillstand-frei}, wenn kein Fehler- und kein stiller Zustand lokal
  erreichbar ist.\\
  Ein \MEIO{} $P$ \emph{Stille-verfeinert} $P'$, falls sie die selbe Signatur
  haben und für alle ihre Tests $T$: $P'\QsatAs T \Rightarrow P\QsatAs T$.
\end{Def}

Um eine genauere Auseinandersetzung mit dem Fehlverhalten in unterschiedlichen
Systemen zu ermöglichen, benötigt man wie im letzten Kapitel die Definition von
Traces auf der Struktur. Wie bereits oben erwähnt, ist Stille ein reparierbares
Fehlverhalten im Gegensatz zu Fehlern. Es genügt deshalb für Stille die
strikten Traces ohne Kürzung zu betrachten.

\begin{Def}[Stillstands-Traces]
  \label{StilleTraceDef}
  Sei $P$ ein \MEIO{} und definiere:
  \begin{itemize}
    \item \emph{strikte Stille-Traces}: $\StQT (P) := \left\{w\in\Sigma ^*\mid
      p_0 \weakmay[w]_P p\in Qui(P)\right\}$.
  \end{itemize}
\end{Def}

Die Definition der strikten Stille-Traces befasst sich mit \MEIO{}s im
allgemeinen. Jedoch ist auch in diesem Kapitel der Zusammenhang mit den
entsprechenden Traces der as"=Implementierungen relevant.

\begin{Prop}[Stillstands-Traces und Implementierungen]
  \label{StilleTraceProp}
  Für ein \MEIO{} $P$ gilt für die strikte Stille-Traces: $\StQT (P) \subseteq
  \underset{P'\in\asimp (P)}{\bigcup} \StQT (P')$.
\end{Prop}
\begin{proof}
  Analog zu den Propositionen~\ref{LImpProp} und~\ref{KommTracesProp} ist die
  Inklusion am Besten mit einer as"=Implementierung zu zeigen und der
  entsprechenden as"=Verfeinerungs"=Relation $\mathcal{R}$. Falls der
  Startzustand $p_0$ von $P$ ein stiller Zustand ist, muss man zwei
  as"=Implementierungen betrachten, ansonsten genügt es eine für alle $w$ aus
  $\StQT (P)$ anzugeben, wobei $w$ möglicherweise nicht $\varepsilon$
  entsprechend darf.

  Für alle $w\neq \varepsilon$ und, mit $w\in\StQT (P)$ kann $P'$ als die
  folgende as"=Implementierung gewählt werden. Diese deckt auch für $w =
  \varepsilon$ ab, wenn $\varepsilon$ zu einem anderen stillen Zustand wie
  $p_0$ führt.
  \begin{itemize}
    \item $P'= \{p'\mid p\in P\}\; \dot{\cup}\; \{p''\mid p\in P\}$,
    \item $p'_0=p'_0$,
    \item $I_{P'}=I_P$ und $O_{P'}=O_P$,
    \item $\begin{aligned}[t] \must _{P'}=\may _{P'} &=
        \left\{(p'_j,\alpha ,p'_k)\mid p_j\may[\alpha] p_k\right\}\\
        &\cup \left\{(p'_j,\alpha ,p''_k)\mid p_j\may[\alpha] p_k\right\}\\
        &\cup \left\{(p''_j,\alpha ,p''_k)\mid p_j\must[\alpha] p_k\right\}
    \end{aligned}$
    \item $E_{P'}=\emptyset$.
  \end{itemize}
  \TODO{Beispiel einfügen}\\
  Als as"=Verfeinerungs"=Relation zwischen $P$ und $P'$ wird die Relation
  $\mathcal{R}=\{(p'_j,p_j)\mid p_j\in P\} \cup \{(p''_j,p_j)\mid p_j\in P\}$
  verwendet. Es werden in $P'$ für die Zustände mit einem Strich $p'$ werden
  die must- und may"=Transitionen zu beiden \glqq Arten\grqq{} von Zuständen
  implementiert und für die Zustände mit zwei Strichen $p''$ nur die
  must"=Transitionen zu den anderen Zuständen mit zwei Strichen. Die Zustände
  $p''$ mit zwei Strich sind die potentiell ruhigen Zustände, die nur die
  zwingend notwendigen ausgehenden Transitionen besitzen. Die Zustände mit
  einem Strich $p'$ hingegen sind die Zustände, die das gesamte erlaubte
  Verhalten umsetzten. Durch die Transitionen, die von den zweifach
  gestrichenen Zuständen zu den einfach gestrichenen führen, ist alles erlaubte
  möglich bis entschieden wird, nur noch das geforderte zu benötigen. Da die
  Menge der Fehler-Zustände leer ist, gilt~\ref{SimDef}.1 für $\mathcal{R}$.
  Die must"=Transitionen werden für die einfach und zweifach gestrichenen
  Zustände umgesetzt, dies erfüllt zusammen mit $\mathcal{R}$ die
  Definition~\ref{SimDef}.2. Ebenso wird der dritte Punkt der
  Definition~\ref{SimDef} erfüllt, da sowohl die Zustände mit einem wie auch
  mit zwei Strichen mit den entsprechenden Zuständen aus $P$ in der Relation
  $\mathcal{R}$ stehen. $\mathcal{R}$ ist also eine starke alternierende
  Simulations-Relation zwischen $P'$ und $P$.\\
  Falls ein Zustand $p_j$ in $P$ still ist, ist es auch der entsprechenden
  Zustand $p''_j$ in $P'$, da für $p''_j$ alle ausgehenden must"=Transitionen
  von $p''_j$ implementiert wurden, aber keine einzige may"=Transition, die
  keiner der must"=Transitionen entspricht. Wenn also für $p_j$ keine Outputs
  und kein $\tau$ möglich waren via must"=Transitionen, dann ist es dies auch
  für $p''_j$ nicht. $p''_j$ ist in $P'$ mit den selben Traces erreichbar wie
  $p_j$ in $P$, da jeder Zustand in $P'$ die selben eingehenden Transitionen
  hat wie der entsprechende Zustand in Relation $\mathcal{R}$ stehende Zustand
  aus $P$. Von $p'_0$ aus kann der Trace, der in $P$ zu einem stillen Zustand
  $p_j$, in $P'$ nachgemacht werden über die einfach gestrichenen Zustände. Die
  letzte Transition des Ablaufes muss dann zum Zustand $p''_j$ genommen werden.
  Es gilt also $\StQT (P)\backslash \{\varepsilon\} = \StQT (P')\backslash
  \{\varepsilon\}$. Falls $\varepsilon$ zu einem stillen Zustand $p \neq p_0$
  in $P$ geführt hat, gilt sogar $\StQT(P) = \StQT (P')$, da ein Trace aus
  internen Aktionen in $P$ und $P'$ zu dem entsprechenden stillen Zustand $p$
  bzw.\ $p''$ führt.

  Die oben aufgeführte as"=Implementierung und die as"=Verfeinerungs"=Relation
  lassen sich für fasst alle Traces aus \StQT{} einsetzen und zu zeigen, dass
  es diese auch in der Vereinigung dieser Traces aller as"=Implementierungen
  gibt. Jedoch gibt es ein Problem, wenn der Trace in $\StQT (P)$ keine
  Transition in $P$ ausführen muss, um den stillen Zustand zu erreichen. Für
  diesen Fall muss eine andere as"=Implementierung mit einer entsprechend
  angepassten as"=Verfeinerungs"=Relation verwendet werden. Die
  as"=Implementierung $P'$ für den Fall, dass der Startzustand $p_0$ in der
  Zustandsmenge $Qui (P)$ enthalten ist, implementiert alle must"=Transitionen,
  keine may"=Transitionen und keine Fehler-Zustände von $P$ und hat die
  Identitäts-Relation als starke as"=Verfeinerungs"=Relation $\mathcal{R}$. In
  diesem Fall gilt $\varepsilon\in\StQT (P)$. Für alle $a\in\Sigma$ folgt, wenn
  in $P$ für einen Zustand $p$ $p\nmust[a]_P$, gilt auch in $P'$ $p
  \nmust[a]_{P'}$ für den Zustand, der mit $p$ in Relation steht. Der
  Startzustand von $P'$ ist mit $\varepsilon$ erreichbar und ebenfalls still.
  Es gilt also $p_0\in Qui (P')$ für den Startzustand von $P'$ und
  $\varepsilon\in\StQT (P')$. Der 2.\ Punkt der Definition~\ref{SimDef} ist für
  die Identitäts-Relation als as"=Verfeinerungs"=Relation $\mathcal{R}$
  erfüllt, da alle must"=Transitionen aus $P$ entsprechend in $P'$ umgesetzt
  wurden. Alle must"=Transitionen in $P$ müssen zugrundeliegende
  may"=Transitionen haben, somit gilt auch 3.\ von~\ref{SimDef}. Der 1.\ Punkt
  der Definition ist auch erfüllt, da $E_{P'}=\emptyset$ gilt, wenn keine
  Fehler-Zustände implementiert werden.
\end{proof}

Man hätte anstatt des hier verwendeten $P'$ mit zwei Arten von Zuständen auch
den Ansatz des ausrollens für jeden Trace analog zu
Proposition~\ref{KommTracesProp}.3 anwenden können. Es wäre auch möglich die
Inklusion der Input"=kritischen Traces aus Proposition~\ref{KommTracesProp}.3
mit dem $P'$ aus dem Beweis der Proposition~\ref{StilleTraceProp} zu
begründen.\\
Für \ET{} und \EL{} gelten die Definitionen aus dem letzten Kapitel. Es wir nur
für Stille eine neue Semantik definiert.

\begin{Def}[Stillstands-Semantik]
  \label{StilleSemDef}
  Sei $P$ ein \MEIO{}.
  \begin{itemize}
    \item Die Menge der \emph{fehler-gefluteten Stille-Traces} von $P$ ist $\QET
      (P):= \StQT (P)\cup\ET (P)$.
  \end{itemize}
  Für zwei \MEIO{}s $P_1,P_2$ mit der gleichen Signatur wird $P_1\QRel{} P_2$
  geschrieben, wenn $P_1\ERel{} P_2$ und $\QET _1\subseteq \QET _2$ gilt.
\end{Def}

\vspace{0.2cm}

\begin{Prop}[Stillstands-Semanik und Implementierungen]
  \label{StilleSemProp}
  Für die Menge der fehler-gefluteten Stille-Traces von $P$ gilt $\QET (P) =
  \underset{P'\in\asimp (P)}{\bigcup} \QET (P')$.
\end{Prop}
\begin{proof}\mbox{}\\
  \glqq$\subseteq$\grqq{}:
  \begin{align*}
    \QET (P)&\overset{\ref{StilleSemDef}}{=} \StQT (P) \cup \ET (P)\\
    &\overset{\ref{StilleTraceProp}}{\subseteq} \left(\underset{P'\in\asimp
    (P)}{\bigcup} \StET (P')\right)\cup \ET (P)\\
    &\overset{\ref{KommSemProp}}{=} \left(\underset{P'\in\asimp
    (P)}{\bigcup} \StET (P')\right)\cup \left(\underset{P'\in\asimp
    (P)}{\bigcup} \ET (P')\right)\\
    &= \underset{P'\in\asimp (P)}{\bigcup} \StQT (P') \cup \ET (P')\\
    &\overset{\ref{StilleSemDef}}{=} \underset{P'\in\asimp (P)}{\bigcup} \QET
    (P').\\
  \end{align*}

  \glqq$\supseteq$\grqq{}:\\
  Es wird hier für ein $w\in \QET (P')$ einer beliebigen as"=Implementierung
  $P'$ von $P$ gezeigt, dass das Wort $w$ auch in $\QET (P)$ enthalten ist. Es
  kann danach unterschieden werden, ob $w$ aus $\StQT (P')\backslash \ET (P')$
  stammt oder aus $\ET (P')$. Falls $w\in\ET (P')$ gilt, folgt mit
  Proposition~\ref{KommSemProp} bereits, dass $w\in \ET (P) \subseteq \QET (P)$
  gilt. Somit wird für den Rest des Beweises davon ausgegangen, dass $w\in\StQT
  (P')\backslash \ET (P')$ ist. $w$ führt in $P'$ also nur zu einem stillen
  Zustand und hat nichts mit Fehler-Zuständen in $P'$ zu tun. Der Trace, der
  durch $w$ in $P'$ beschrieben wird, hat die folgende Form aus
  Lemma~\ref{AblaefeVerfSpezLem}. Da $P'$ eine as"=Verfeinerung von $P$ ist,
  gibt es auch eine as"=Verfeinerungs"=Relation $\mathcal{R}$, die zwischen den
  beiden \MEIO{}s gilt. In $P$ führt entweder ein Präfix von $w$ zu einem
  Fehler"=Zustand oder $w$ ist in $P$ zu einem Zustand ausführbar, für den
  $p'_n \mathcal{R} p_n$ gilt, wegen~\ref{AblaefeVerfSpezLem}. Falls ein Präfix
  von $w$ zu einem Fehler"=Zustand führt, gilt $w\in\ET _P\subseteq \QET _P$.
  Andernfalls wird also durch $w$ ein Zustand $p_n$ erreicht, der mit dem
  Zustand $p'_n$ in der starken as"=Verfeinerungs"=Relation $\mathcal{R}$
  stehen. $p'_n$ ist still, nach Voraussetzung. Es gilt also für alle
  $\omega\in O\cup \{\tau\}$ $p'_n\nmust[\omega]$. Da $(p'_n,p_n)
  \in\mathcal{R}$ gilt und beide Zustände keine Fehler-Zustände sind, muss auch
  $p_n\nmust[\omega]$ für alle $\omega\in O\cup \{\tau\}$ gelten, da
  sonst~\ref{SimDef}.2 verletzt würde. Es gilt also in diesem Fall $w\in\StQT
  (P)\subseteq\QET (P)$.
\end{proof}

Wie im letzten Kapitel kann aus der vorangegangen Proposition über die
Gleichheit der betrachteten Trace Mengen in der Relation \QRel{} auch eine
Aussage über die lokale Erreichbarkeit \glqq fehlerhafter Zustände\grqq{} in
einer Spezifikation und den zugehörigen Implementierungen getroffen werden.

\begin{Kor}[lokale Stillstands Erreichbarkeit]\mbox{}
  \label{lokaleStilleErrKor}
  \begin{enumerate}[(i)]
    \item Falls in einem \MEIO{} $P$ ein Fehler lokal erreichbar ist, dann
      existiert auch eine as"=Implementierung, in der ein Fehler lokal
      erreichbar ist.
    \item Falls ein \MEIO{} $P$ einen lokal erreichbaren stillen Zustand
      besitzt, dann existiert auch eine as"=Implementierung, in der ein
      stiller Zustand lokal erreichbar ist.
    \item Falls es eine as"=Implementierung von $P$ gibt, die einen Fehler oder
      Stille lokal erreicht, dann ist auch ein Fehler oder Stille in $P$ lokal
      erreichbar.
  \end{enumerate}
\end{Kor}
\begin{proof}\mbox{}
  \begin{enumerate}[(i)]
    \item Dieser Punkt folgt direkt aus Korollar~\ref{lokalFehlerErrKor}~(i).
    \item Da ein stiller Zustand in $P$ lokal erreichbar ist, gilt $w\in \StQT
      _P$ für $w\in O$. Es muss wegen Proposition~\ref{StilleTraceProp}
      mindestens ein $P'\in \asimp (P)$ geben, für dass $w\in \StQT _{P'}$
      gilt. Da $w$ nur aus lokalen Aktion bestehen kann, ist auch in $P'$ ein
      stiller Zustand lokal erreichbar.
    \item Sei $P'$ die as"=Implementierung von $P$, in der ein Fehler- oder
      stiller Zustand lokal erreichbar ist. Es gilt dann $w\in \QET _{P'}$ für
      $w\in O$. Mit Proposition~\ref{StilleSemProp} folgt draus $w\in \QET _P$.
      Es muss also auch in $P$ ein Fehler- oder stiller Zustand lokal
      erreichbar sein.
  \end{enumerate}
\end{proof}

Für spätere Beweise werden noch Zusammenhänge zwischen Stille-Zuständen in den
einzelnen Komponenten und in einer Parallelkomposition dieses Komponenten
benötigt.

\begin{Lem}[Stillstands-Zustände unter Parallelkomposition]\mbox{}
  \label{StilleZustLem}
  \begin{enumerate}
    \item Ein Zustand $(p_1,p_2)$ aus der Parallelkomposition $P_{12}$ ist
      still, wenn es auch die Zustände $p_1$ und $p_2$ in $P_1$ bzw. $P_2$
      sind.
    \item Wenn der Zustand $(p_1,p_2)$ still ist und nicht in $E_{12}$
      enthalten ist, dann sind auch die auf die Teilsysteme projizierten
      Zustände $p_1$ und $p_2$ still.
  \end{enumerate}
\end{Lem}
\begin{proof}\mbox{}
  \begin{enumerate}
    \item Da $p_1\in Qui_1$ und $p_2\in Qui_2$ gilt, haben diese beiden
      Zustände jeweils höchstens die Möglichkeit für Input-Transitionen oder
      Output- und $\tau$-may"=Transitionen, jedoch keine Möglichkeit für Outputs
      oder $\tau$s als must"=Transitionen.\\
      Angenommen der Zustand, der durch die Parallelkomposition aus den
      Zuständen $p_1$ und $p_2$ entsteht, ist nicht still, d.h.\ er hat eine
      ausgehende must"=Transition für einen Output oder ein $\tau$.
      \begin{itemize}
        \item Fall 1 \big($(p_1,p_2)\must[\tau]_{12}$\big): Ein $\tau$ ist eine
          interne Aktion und kann in der Parallelkomposition nicht durch das
          Verbergen von Aktionen bei der Synchronisation entstehen. Ein $\tau$
          in der Parallelkomposition ist also auch nur möglich, wenn dies
          bereits als must"=Transition in einer Komponente möglich war für
          einen der Zustände, aus denen $(p_1,p_2)$ zusammensetzt ist. Jedoch
          verbietet die Voraussetzung, dass $p_1$ oder $p_2$ eine ausgehende
          $\tau$"=must"=Transition haben, deshalb kann auch $(p_1,p_2)$ keine
          solche Transition besitzen.
        \item Fall 2 \big($(p_1,p_2)\must[a]_{12}$ mit $a\in O_{12}\backslash
          \Synch(P_1,P_2)$\big): Da es sich bei $a$ um einen Output handelt, der
          nicht in $\Synch (P_1,P_2)$ enthalten ist, kann dieser nicht aus der
          Synchronisation von zwei Aktionen entstanden sein, sondern muss
          bereits für $P_1$ oder $P_2$ als must"=Transition ausführbar gewesen
          sein. Es gilt also \oBdA{} $p_1\must[a]_1$ mit $a\in O_1$. Dies ist
          jedoch aufgrund der Voraussetzung nicht möglich. Somit kann die
          Parallelkomposition diese Transition für $(p_1,p_2)$ ebenfalls nicht
          als must"=Transition enthalten sein.
        \item Fall 3 \big($(p_1,p_2)\must[a]_{12}$ mit $a\in O_{12}\cap\Synch
          (P_1,P_2)$\big): Der Output $a$ ist in diesem Fall durch
          Synchronisation von einem Output mit einem Input entstanden. \OBdA{}
          gilt $a\in O_1\cap I_2$. Für die einzelnen Systeme muss also gelten,
          dass $p_1\must[a]_1$ und $p_2\must[a]_2$. Die Transition für das
          System $P_1$ ist jedoch in der Voraussetzung ausgeschlossen worden.
          Somit ist es nicht möglich, dass $P_{12}$ diese in diesem Fall
          angenommene must"=Transition für den Zustand $(p_1,p_2)$ ausführen
          kann.
      \end{itemize}
      Da alle diese Fälle zu einem Widerspruch mit der Voraussetzung führen
      folgt, dass bereits die Annahme, dass der Zustand $(p_1,p_2)$ nicht still
      ist, falsch war. Es gilt also, dass aus $p_j\in Qui_j$ für $j\in\{1,2\}$
      $(p_1,p_2)\in Qui_{12}$ folgt.
    \item Es gilt $(p_1,p_2)\in Qui_{12}\backslash E_{12}$, somit hat dieser
      Zustand allenfalls die Möglichkeit für must"=Transitionen, die mit Inputs
      beschriftet sind.\\
      Angenommen $p_1\notin Qui _1$, dann ist für $p_1$ entweder eine
      $\tau$"=must"=Transition oder eine Output"=must"=Transition möglich.
      \begin{itemize}
        \item Fall 1 \big($p_1\must[\tau]_1$\big): Da die Transition für $p_1$
          möglich ist, hat auch $(p_1,p_2)$ die Möglichkeit für eine
          $\tau$"=must"=Transition. Dies ist jedoch durch die Voraussetzung
          verboten und somit kann dieser Fall nicht eintreten.
        \item Fall 2 \big($p_1\must[a]_1$ mit $a\in O_1\backslash
          \Synch(P_1,P_2)$\big): Dieser Fall kann wegen einer analogen
          Begründung wie in Fall 1 nicht auftreten.
        \item Fall 3 \big($p_1\must[a]_1$ mit $a\in O_1\cap\Synch(P_1,P_2)$ und
          $p_2\must[a]_2$\big): In diesem Fall ist die Synchronisation des
          Outputs $a$ von $P_1$ mit dem Input $a$ von $P_2$ möglich, so dass in
          der Parallelkomposition der Output $a$ als must"=Transition für
          $(p_1,p_2)$ entsteht. Diese must"=Transition ist jedoch in $P_{12}$
          nach Voraussetzung nicht erlaubt. Es folgt also auch, dass dieser
          Fall nicht eintreten kann.
        \item Fall 4 \big($p_1\must[a]_1$ mit $a\in O_1\cap\Synch(P_1,P_2)$ und
          $p_2\nmust[a]_2$\big): Da $P_2$ die $a$ Transition nicht als
          must"=Transition enthält, handelt es sich hier um einen neuen
          Fehler. Das $a$ kann für $P_2$ kein Output sein, da sonst $P_1$ und
          $P_2$ nicht komponierbar wäre. Der neue Fehler kann dadurch
          entstehen, dass die Synchronisation des Outputs $a$ von $P_1$ mit dem
          Input $a$ von $P_2$ an dieser Stelle nicht möglich ist, oder da der
          Input $a$ für $p_2$ nur als may"=Transition vorliegt und somit die
          Gefahr besteht, dass dieser in einer Implementierung nicht vorhanden
          ist. Im zweiten Fall synchronisieren die beiden Transitionen zu einer
          $a$ Output"=may"=Transition, die in $P_{12}$ zulässig wäre. Jedoch
          wird der Zustand $(p_1,p_2)$ in beiden Fällen in die Menge $E_{12}$
          der Parallelkomposition eingefügt (Definition~\ref{ParallelDef}).
          Dies wurde in der Voraussetzung für den Zustand ausgeschlossen und
          dieser Fall ist somit nicht möglich.
      \end{itemize}
      Alle aufgeführten Fälle führen zu einem Widerspruch mit der
      Voraussetzung, somit folgt, dass die Annahme bereits falsch war und
      $p_1\in Qui_1$ gelten muss. Analog kann für $p_2$ argumentiert werden, so
      dass dann auch $p_2\in Qui_2$ folgt.
  \end{enumerate}
\end{proof}

In dem folgenden Satz sind die Punkte 1.\ und 3.\ nur zur Vollständigkeit
aufgeführt. Sie entsprechen Punkt 1.\ und 2.\ aus Satz~\ref{KommFehlerSemSatz}.

\begin{Satz}[Kommunikationsfehler- und Stillstands-Semantik für Parallelkompositionen]
  \label{StilleSemSatz}
  Für zwei komponierbare \MEIO{}s $P_1,P_2$ und ihre Komposition $P_{12}$ gilt:
  \begin{enumerate}
    \item $\ET _{12}=\cont (\prune ((\ET _1\|\EL _2)\cup (\EL _1\|\ET _2)))$,
    \item $\QET _{12}=(\QET _1\|\QET _2)\cup\ET _{12}$,
    \item $\EL _{12}=(\EL _1\|\EL _2)\cup\ET _{12}$.
  \end{enumerate}
\end{Satz}
\begin{proof}
  Es wird nur der 2. Punkt beweisen.\\
  \glqq$\subseteq$\grqq{}:\\
  Hier muss unterschieden werden, ob ein $w\in\StQT _{12}\backslash\ET _{12}$
  oder ein $w\in\ET _{12}$ betrachtet wird. Im zweiten Fall ist das $w$
  offensichtlich in der rechten Seite enthalten. Somit wird im Folgenden ein
  $w\in\StQT _{12}\backslash\ET _{12}$ betrachtet und es wird dessen
  Zugehörigkeit zur rechten Menge gezeigt. Aufgrund von
  Definition~\ref{StilleTraceDef} weiß man, dass $(p_{01},p_{02})
  \weakmay[w]_{12} (p_1,p_2)$ gilt mit $(p_1,p_2)\in Qui_{12} \backslash
  E_{12}$. Durch Projektion erhält man $p_{01} \weakmay[w_1]_1 p_1$ und $p_{02}
  \weakmay[w_2]_2p_2$ mit $w\in w_1\|w_2$. Aus $(p_1,p_2)\in Qui_{12}
  \backslash E_{12}$ kann mit dem zweiten Punkt von Lemma~\ref{StilleZustLem}
  gefolgert werden, dass $q_1\in Qui_1$ und $q_2\in Qui_2$ gilt. Somit gilt
  $w_1 \in \StQT _1\subseteq \QET _1$ und $w_2\in \StQT _2\subseteq\QET _2$.
  Daraus folgt $w\in \QET _1\|\QET _2$ und somit ist $w$ in der rechten Seite
  der Gleichung enthalten.

  \glqq$\supseteq$\grqq{}:\\
  Es muss wieder danach unterschieden werden aus welcher Menge das betrachtete
  Element stammt. Falls $w\in\ET _{12}$ gilt, so kann die Zugehörigkeit zur
  linken Seite direkt gefolgert werden. Somit wird für den weiteren Beweis
  dieser Inklusionsrichtung ein Element $w\in\QET _1\|\QET _2$ betrachtet und
  gezeigt, dass es in der linken Menge enthalten ist. Da $\QET _i=\StQT _i\cup
  \ET _i$ gilt, existieren für $w_1$ und $w_2$ mit $w\in w_1\|w_2$
  unterschiedliche Möglichkeiten:
  \begin{itemize}
    \item Fall 1 ($w_1\in\ET _1\lor w_2\in\ET _2$): \OBdA{} gilt $w_1\in\ET
      _1$. Nun kann $w_2\in\StQT _2\subseteq L_2$ oder $w_2\in\ET _2$ gelten
      und somit ist auf jeden Fall $w_2$ in $\EL _2$ enthalten. Daraus kann
      dann mit dem ersten Punkt von Satz~\ref{KommFehlerSemSatz} gefolgert
      werden, dass $w\in\ET _{12}$ gilt und damit ist $w$ in der linken Seite
      der Gleichung enthalten.
    \item Fall 2 ($w_1\in\StQT _1\backslash\ET _1\land w_2\in\StQT _2\backslash
      \ET _2$): Es gilt in diesem Fall $p_{01} \weakmay[w_1]_1 p_1\in Qui_1$
      und $p_{02} \weakmay[w_2]_2 p_2\in Qui_2$. Da $p_1$ und $p_2$ in der
      jeweiligen Stillstands-Menge enthalten sind, ist auch der Zustand, der
      aus ihnen zusammengesetzt ist, in der Parallelkomposition still, wie
      bereits im ersten Punkt von Lemma~\ref{StilleZustLem} gezeigt. Es gilt
      also für die Komposition $(p_{01},p_{02}) \weakmay[w]_{12} (p_1,p_2)\in
      Qui_{12}$ und dadurch ist $w$ in der linken Seite der Gleichung
      enthalten, da $w\in \StQT _{12}\subseteq \QET _{12}$ gilt.
  \end{itemize}
\end{proof}

Aus diesem Satz kann direkt gefolgert werden, dass \QRel{} eine Präkongruenz
ist. Den Beweis dazu liefert das folgende Korollar.

\begin{Kor}[Stillstands-Präkongruenz]
  \label{StillePraekonKor}
  Die Relation \QRel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{Kor}
\begin{proof}
  Es muss gezeigt werden: Wenn $P_1\QRel P_2$ für zwei \MEIO{}s $P_1$ und $P_2$
  gilt, so auch $P_{31}\QRel P_{32}$ für jedes alle komponierbare Systeme
  $P_3$. D.h.\ es ist zu zeigen, dass aus $P_1\ERel P_2$ und $\QET{}_1\subseteq
  \QET{}_2$ sowohl $P_{31}\ERel P_{32}$ als auch $\QET{}_{31}\subseteq
  \QET{}_{32}$ folgt, wegen der Definition von \QRel{} in~\ref{StilleSemDef}.
  Dies ergibt sich, wie im Beweis zu Korollar~\ref{KommPraekonKor}, aus der
  Monotonie von $\cdot\|\cdot$ auf Sprachen wie folgt:
  \begin{itemize}
    \item $\begin{aligned}[t]
        P_{31} \overset{\mathrm{Korollar}~\ref{KommPraekonKor}}{
          \overset{\mathrm{und}}{\overset{P_1\ERel P_2}{\ERel}}}
        P_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \QET{}_{31} &\overset{\ref{StilleSemSatz}.2}{=}
        (\QET{}_3\|\QET{}_1)\cup \ET{}_{31}\\
        &\hspace{-0.6cm}\overset{\ET{}_{31}\subseteq
      \ET{}_{32}}{\overset{\mathrm{und}}{\overset{\QET{}_1\subseteq
      \QET{}_2}{\subseteq}}} (\QET{}_3\|\QET{}_2) \cup \ET{}_{32}\\
        &\overset{\ref{StilleSemSatz}.2}{=} \QET{}_{32}.
    \end{aligned}$
  \vspace*{-0.7cm}
  \end{itemize}
\end{proof}

Im nächsten Lemma soll eine Verfeinerung bezüglich guter Kommunikation mit
Partnern betrachtet werden. Die gute Kommunikation stützt sich dabei auf die
Definition von Tests und der daraus resultierenden Verfeinerung
in~\ref{StilleTestDef}.

\begin{Lem}[Testing-Verfeinerung mit Stillstand]
  \label{StilleTestVerfeinLem}
  Gegeben sind zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur. Wenn
  für alle Tests $T$, die Partner von $P_1$ bzw. $P_2$ sind, $P_2\QsatAs T
  \Rightarrow P_1\QsatAs T$ gilt, dann folgt daraus die Gültigkeit von
  $P_1\QRel P_2$.
\end{Lem}
\begin{proof}
  Da $P_1$ und $P_2$ die gleiche Signatur haben, wird $I:=I_1=I_2$ und
  $O:=O_1=O_2$ definiert. Für jeden Test Partner $T$ gilt $I_T=O$ und
  $O_T=I$.\\
  Um zu zeigen, dass die Relation $P_1\QRel P_2$ gilt, müssen die folgenden
  Punkte nachgewiesen werden:
  \begin{itemize}
    \item $P_1\ERel P_2$,
    \item $\QET _1\subseteq \QET _2$.
  \end{itemize}
  In Lemma~\ref{KommTestVerfeinLem} wurde bereits etwas Ähnliches gezeigt,
  jedoch wurde dort als Voraussetzung $P_2\EsatAs T\Rightarrow P_1\EsatAs T$
  für alle Test Partner $T$ verwendet und hier dieselbe Aussage mit der Test
  Erfüllung für Stillstand. Die hier verwendeten Tests sagen nichts darüber
  aus, welche Art von fehlerhaftem Zustand enthalten ist. Die Aussage des
  Lemmas~\ref{KommTestVerfeinLem} kann hier also nicht verwendet werden. Aus
  der lokalen Erreichbarkeit eines Fehler-Zustandes in der Parallelkomposition
  einer as"=Implementierung von $P_1$ mit $T$ lässt sich nur schließen, dass
  $P_2$ den Test $T$ ebenfalls nicht as"=erfüllt. Dies kann aber aufgrund einer
  as"=Implementierung von $P_2$ sein, die in Parallelkomposition mit $T$ einen
  Fehler- oder stillen Zustand lokal erreicht. Analoges gilt auch für die
  lokale Erreichbarkeit eines stillen Zustandes in der Komposition einer
  as"=Implementierung von $P_1$ mit einem Test $T$.\\
  Es muss also für den ersten Punkt noch folgendes nachgewiesen werden:
  \begin{itemize}
    \item $\ET _1\subseteq\ET _2$,
    \item $\EL _1\subseteq\EL _2$.
  \end{itemize}
  Es wird nun damit begonnen, den ersten Unterpunkt des ersten Beweispunktes zu
  zeigen, d.h.\ es wird unter der Voraussetzung $P_2\QsatAs T\Rightarrow
  P_1\QsatAs T$ gezeigt, dass $\ET _1\subseteq\ET _2$ gilt. Da beide
  \ET{}-Mengen unter \cont{} abgeschlossen sind, reicht es ein präfix-minimales
  Element $w\in\ET _1$ zu betrachten und zu zeigen, dass dieses $w$ oder eines
  seiner Präfixe in $\ET _2$ enthalten ist. $w$ muss, wegen
  Proposition~\ref{KommSemProp}, in einer as"=Implementierung $P'_1$ von $P_1$
  ebenfalls ein präfix-minimales Element in $\ET _{P'_1}$ sein.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Fehler-Zustand in $P'_1$. Für $T$ wird ein Transitionssystem verwendet,
      das nur aus dem Startzustand, einer must-Schleife für alle Inputs $x\in
      I_T$ und einer must-Schlinge für $\tau$ besteht. Somit kann $P'_1$ die im
      Prinzip gleichen Fehler-Zustände lokal erreichen wie $P'_1\|T$. Es gibt
      also einen lokal erreichbaren Zustand von $P'_1\|T$, der in $E_{P'_1\|T}$
      enthalten ist. Somit erfüllt $P_1$ den Tests $T$ nicht und es muss somit
      auch mindestens eine as"=Implementierung $P'_2$ von $P_2$ geben, die den
      Test $T$ ebenfalls nicht erfüllt. Da eine Implementierung den Test $T$
      erfüllt, wenn die Parallelkomposition der Implementierung mit dem Test
      fehler- und stillstand-frei ist, kann die nicht Erfüllung eines Testes
      sowohl an einem Fehler- wie auch einem stillen Zustand liegen. Bei dem
      lokal erreichbaren fehlerhaften Zustand kann es sich nur um einen Fehler
      handeln, da es wegen der $\tau$-Schlinge in der Komposition mit $T$ keine
      Stille geben kann. Da $T$ keinen Fehler-Zustand und auch keine fehlenden
      Input-Möglichkeiten enthält, kann der Fehler nur von $P'_2$ geerbt sein.
      Somit muss in $P'_2$ ein Fehler-Zustand lokal erreichbar sein. Es gilt
      also $\varepsilon \in \PrET _{P'_2} \subseteq \ET _{P'_2}$ und mit
      Proposition~\ref{KommSemProp} auch $\varepsilon\in\ET _2$.
    \item Fall 2 ($w=x_1\dots x_n x_{n+1}\in\Sigma ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I$): Es wird der folgende Partner $T$ betrachtet (siehe auch
      Abbildung~\ref{TohneEmitTau}):
      \begin{itemize}
        \item $T=\{p_0,p_1,\dots ,p_{n+1}\}$,
        \item $p_{0T}=p_0$,
        \item $\begin{aligned}[t]
            \may _T = \must _T&=\{(p_j,x_{j+1},p_{j+1})\mid  0\leq j\leq n\}\\
            &\cup\{(p_j,x,p_{n+1})\mid  x\in I_T\backslash\{x_{j+1}\}, 0\leq
            j\leq n\}\\
            &\cup\{(p_{n+1},x,p_{n+1})\mid  x\in I_T\}\\
            &\cup\{(p_j,\tau,p_j)\mid 0\leq j\leq n+1\},
        \end{aligned}$
        \item $E_T=\emptyset$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[auto,node distance =3cm, semithick]
          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$p_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$p_{n+1}$};

          \path[line width=1pt] (dots) edge [loosely dotted] (n1);

          \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (n1)
                    edge [loop above] node {$\tau$} (0)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (n1)
                    edge [loop above] node {$\tau$} (1)
                (dots) edge node {$x_n$} (n)
                (n) edge node [above, sloped] {$x?\in I_T$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                    edge [loop above] node {$\tau$} (n)
                (n1) edge [loop below] node {$x?\in I_T, \tau$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_T\backslash\{x_j\}$}
      \label{TohneEmitTau}
      \end{center}
      \end{figure}
      Die Menge der stillen Zustände des hier betrachteten $T$s ist leer. Da im
      Vergleich zum Transitionssystem in Abbildung~\ref{UohneE} nur die
      $\tau$-Schlingen ergänzt wurden und die Umbenennung der Mengen, ändert
      sich nichts an den Fällen 2a) und 2b) aus dem Beweis der selben Inklusion
      von Lemma~\ref{KommTestVerfeinLem}. Die Begründungen, wieso in den beiden
      Fällen $\varepsilon\in\PrET (P'_1\|T)$ gilt, bleibt also analog zum
      Beweis des ersten Punktes des Lemmas aus dem vorangegangenen Kapitel.
      Durch die must-$\tau$-Schlingen wurde, genau wie im letzten Fall nur
      erreicht, das in einer Parallelkomposition mit $T$ keine stillen Zustände
      möglich sind. Es kann also auch hier aus der lokalen Erreichbarkeit eines
      Fehler in $P'_1\|T$ auf die lokale Erreichbarkeit eines Fehler-Zustandes
      in $P'_2\|T$ für eine as"=Implementierung $P'_2$ von $P_2$ geschlossen
      werden. Die weitere Argumentation verläuft analog zu Fall 2, derselben
      Inklusion im Beweis von Lemma~\ref{KommTestVerfeinLem}. Da $\tau$s nur
      interne Aktionen einer einzelnen Komponente sind, verändert sich auch
      nichts an den Traces über die argumentiert wird. Es können zwar
      möglicherweise $\tau$-Transitionen ausgeführt werden, diese können jedoch
      weder zu einem Fehler führen noch beeinflussen, dass ein anderer Trace
      nicht ausgeführt werden kann.
  \end{itemize}

  Nun wird mit dem zweiten Unterpunkt des ersten Beweispunktes begonnen. Genau
  wie im Beweis zu~\ref{KommTestVerfeinLem} ist hier jedoch aufgrund des
  bereits geführten Beweisteils nur noch $L_1\backslash\ET _1\subseteq\EL _2$
  zu zeigen. Es wird also für ein beliebig gewähltes $w\in L_1\backslash\ET _1$
  gezeigt, dass dieses auch in $\EL _2$ enthalten ist. Aufgrund der
  Propositionen~\ref{LImpProp} und~\ref{KommSemProp} gibt es auch eine
  as"=Implementierung $P'_1$ von $P_1$ für die $w\in L_{P'_1}\backslash \ET
  _{P'_1}$ gilt.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Ebenso wie in~\ref{KommTestVerfeinLem} gilt
      auch hier, dass $\varepsilon$ immer in $\EL _2$ enthalten ist.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Die Konstruktion des
      Partners $T$ weicht wie im letzten Beweisteil nur durch die
      $\tau$-must-Schleifen an den Zuständen des Transitionssystems vom Beweis
      des zweiten Punktes aus Lemma~\ref{KommTestVerfeinLem} ab. Somit ist der
      Partner $T$ dann wie folgt definiert (siehe dazu auch
      Abbildung~\ref{TmitEundTau}):
      \begin{itemize}
        \item $T=\{p_0,p_1,\dots ,p_n,p\}$,
        \item $p_{0T}=p_0$,
        \item $\begin{aligned}[t]
            \may _T = \must _T&=\{(p_j,x_{j+1},p_{j+1})\mid 0\leq j< n\}\\
            &\cup\{(p_j,x,p)\mid x\in I_T\backslash\{x_{j+1}\},0\leq j < n\}\\
            &\cup\{(p_j,\tau ,p_j)\mid 0\leq j\leq n\}\\
            &\cup\{(p,\alpha ,p)\mid \alpha\in I_T\cup \{\tau\}\},
              \end{aligned}$
        \item $E_T=\{p_n\}$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[auto,node distance =3cm, semithick]

          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$p_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$p_n\in E_T$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$p$};

          \path[line width=1pt] (dots) edge [loosely dotted] (q);

          \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (q)
                    edge [loop above] node {$\tau$} (0)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (q)
                    edge [loop above] node {$\tau$} (1)
                (dots) edge node {$x_{n-1}$} (n1)
                (n1) edge node {$x_n$} (n)
                     edge [bend left] node [below, sloped] {$x?\neq x_n$} (q)
                     edge [loop above] node {$\tau$} (n1)
                (q) edge [loop below] node {$x?\in I_T, \tau$} (q)
                (n) edge [loop above] node {$\tau$} (n);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_T\backslash\{x_j\}$, $p_n$
          ist der einzige Fehler-Zustand}
      \label{TmitEundTau}
      \end{center}
      \end{figure}
      Da durch die $\tau$-must-Schlingen an den Zuständen wie oben vermieden
      wird, dass es in einer Komposition mit $T$ und auch in $T$ selbst
      stille Zustände gibt, verläuft der Rest des Beweises dieses Punktes
      analog zum Beweis der selben Inklusions von
      Lemma~\ref{KommTestVerfeinLem}. Und somit gilt für alle Fälle (2a) bis
      2d)), dass $w$ in $\EL _2$ enthalten ist.
  \end{itemize}

  So bleibt nur noch der letzt Beweispunkt zu zeigen, d.h.\ die Inklusion $\QET
  _1\subseteq\QET _2$. Diese kann jedoch, analog zum Beweis der Inklusion der
  Fehler-gefluteten Sprache, noch weiter eingeschränkt werden. Da bereits
  bekannt ist, dass $\ET _1\subseteq\ET _2$ gilt, muss nur noch $\StQT
  _1\backslash\ET _1\subseteq\QET _2$ gezeigt werden.\\
  Es wird ein $w\in\StQT _1\backslash\ET _1$ gewählt und gezeigt, dass dieses
  auch in $\QET _2$ enthalten ist. Mit den Propositionen~\ref{KommSemProp}
  und~\ref{StilleTraceProp} kann gefolgert werden, dass es auch eine
  as"=Implementierung $P'_1$ von $P_1$ gibt, für die $w\in\StQT _{P'_1}
  \backslash \ET _{P'_1}$ gilt.\\
  Durch die Wahl des $w$s wird vom Startzustand von $P'_1$ durch das Wort $w$
  ein stiller Zustand erreichbar. Dies hat nur Auswirkungen auf die
  Parallelkomposition $P'_1\|T$, wenn in $T$ ebenfalls ein stiller Zustand
  durch $w$ erreichbar ist.\\
  Das betrachtete $w$ hat also die Form $w=x_1\dots x_n\in\Sigma ^*$ mit $n\geq
  0$. Es wird der folgende Partner $T$ betrachtet (siehe auch
  Abbildung~\ref{TohneEmitI}):
  \begin{itemize}
    \item $T=\{p_0,p_1,\dots ,p_n, p\}$,
    \item $p_{0T}=p_0$,
    \item $\begin{aligned}[t]
        \may _T = \must _T&=\{(p_j,x_{j+1},p_{j+1})\mid  0\leq j< n\}\\
        &\cup\{(p_j,x,p)\mid  x\in I_T\backslash\{x_{j+1}\}, 0\leq j< n\}\\
        &\cup\{(p_j,\tau,p_j)\mid 0\leq j< n\}\\
        &\cup\{(p_n,x,p)\mid x\in I_T\}\\
        &\cup\{(p,\alpha,p)\mid \alpha\in I_T\cup\{\tau\}\},
    \end{aligned}$
    \item $E_T=\emptyset$.
  \end{itemize}
  \begin{figure} [h!tbp]
  \begin{center}
    \begin{tikzpicture}[auto,node distance =3cm, semithick]
      \node (0) {$p_0$};
      \node (1) [right of=0] {$p_1$};
      \node (dots) [right of=1] {$\dots$};
      \node (n) [right of=dots, rectangle, dotted, draw] {$p_n\in Qui_T$};
      \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$p$};

      \path[line width=1pt] (dots) edge [loosely dotted] (q);

      \path[->, >=latex'] ($ (0) + (-1,0) $) edge (0)
            (0) edge node {$x_1$} (1)
                edge [loop above] node {$\tau$} (0)
                edge [bend right] node [below, sloped] {$x?\neq x_1$} (q)
            (1) edge node {$x_2$} (dots)
                edge [loop above] node {$\tau$} (1)
                edge [below, sloped] node {$x?\neq x_2$} (q)
            (dots) edge node {$x_n$} (n)
            (n) edge [bend left] node [below,sloped] {$x?\in I_T$} (q)
            (q) edge [loop below] node {$x?\in I_T, \tau$} (q);
    \end{tikzpicture}
    \caption{$x?\neq x_j$ steht für alle $x\in I_T\backslash\{x_j\}$, $p_n$
    ist der einzige stille Zustand}
  \label{TohneEmitI}
  \end{center}
  \end{figure}
  Falls für das betrachtete $w=\varepsilon$ gilt, reduziert sich der Partner
  $T$ auf den Zustand $p_n=p_0$ und den Zustand $p$. Es ist also in diesem Fall
  der Startzustand gleich dem stillen Zustand.\\
  Allgemein ist der Zustand $p_n$ aus $T$ der einzig stille Zustand in $T$. Es
  gilt wegen des ersten Punktes von Lemma~\ref{StilleZustLem}, dass auch in der
  Parallelkomposition $P'_1\|T$ ein stiller Zustand mit $w$ erreicht wird. Bei
  allen in $w$ befindlichen Aktionen handelt es sich um synchronisierte
  Aktionen und es gilt $I_T\cap I=\emptyset$. Daraus folgt $w\in O_{P'_1\|T}$
  und $w\in\StQT (P'_1\|T)$. Es kann also in der Parallelkomposition durch $w$
  ein stiller Zustand lokal erreicht werden. Da ein stiller Zustand in
  $P'_1\|T$ lokal erreichbar ist, muss auch in $P'_2\|T$ für eine
  as"=Implementierung $P'_2$ von $P_2$ ein fehlerhafter Zustand lokal
  erreichbar sein. Es kann zunächst keine Aussage getroffen werden, ob das $w$
  in $P'_2\|T$ ausführbar ist und ob es sich bei dem fehlerhaften Zustand um
  Stille oder einen Fehler handelt.
  \begin{itemize}
    \item Fall a) ($\varepsilon\in\ET (P'_2\|T)$): Es handelt sich bei dem
      lokal erreichbaren fehlerhaften Zustand um einen Fehler. Es ist somit
      nicht relevant, ob $w$ ausführbar ist. Der Fehler-Zustand kann sowohl von
      $P'_2$ geerbt sein, wie auch durch fehlende Input"=must"=Transitionen als
      neuer Fehler in der Parallelkomposition entstanden sein. Von $T$ kann
      kein Fehler geerbt werden und $T$ kann hat in allen Zuständen die
      Möglichkeit alle Inputs entgegen zu nehmen. Die einzigen Outputs, die $T$
      ausführen kann, befinden sich auf dem Trace, auf dem $T$ das Wort $w$
      ausführt. Es gilt, dass ein Präfix von $w$ in $\ET _{P'_2}$ enthalten
      ist, wegen des Beweises des ersten Punktes aus
      Lemma~\ref{KommTestVerfeinLem} und da $T$ nur neue Fehler auf dem Trace
      $w$ zulässt. Die Menge \ET{} ist unter \cont{} abgeschlossen, somit gilt
      $w\in\ET _{P'_2}\subseteq\QET _{P'_2}$. Mit
      Proposition~\ref{StilleSemProp} folgt daraus $w\in\QET _2$.
    \item Fall b) (stiller Zustand lokal erreichbar in $P'_2\|T$ und
      $\varepsilon \notin \ET (P'_2\|T)$): Da in $T$ nur durch $w$ ein stiller
      Zustand erreicht werden kann, muss es sich bei dem lokal erreichbaren
      stillen Zustand in $P'_2\|T$ um einen handeln, der mit $w$ erreicht
      werden kann. Mit Lemma~\ref{StilleZustLem} kann somit gefolgert werden,
      dass auch in $P'_2$ ein stiller Zustand mit $w$ erreichbar sein muss. Es
      gilt $w\in \StQT _{P'_2}\subseteq\QET _{P'_2}\subseteq\QET _2$, wegen
      Proposition~\ref{StilleSemProp}.
  \end{itemize}
\end{proof}

\begin{Satz}
  \label{StilleTestVerfSatz}
  Aus $P_1\QRel P_2$ folgt, dass $P_1$ $P_2$ Stille-verfeinert.
\end{Satz}
\begin{proof}
  In einem \MEIO{} $P$ ist ein Fehler- oder stiller Zustand nach Definition
  genau dann lokal erreichbar, wenn $w\in\QET _P$ für $w\in O_P$ gilt.\\
  $P_1$ Stille-verfeinert $P_2$ genau dann, wenn für alle Tests $T$ von $P_1$
  und $P_2$ die Implikation $P_2\QsatAs T \Rightarrow P_1\QsatAs T$ gilt. Wenn
  man die Implikation negiert, ist für alle Tests $T$ der beiden \MEIO{}s $\neg
  P_1\QsatAs T \Rightarrow \neg P_2\QsatAs T$ zu zeigen. Es soll $\neg P_1
  \QsatAs T$ für einen beliebig gewählten Test $T$ gelten. Es existiert also
  ein $P'_1$ aus der Menge $\asimp (P_1)$, für das $P'_1\|T$ einen Fehler oder
  einen stillen Zustand lokal erreicht. Für ein $w\in O_{P'_1\|T}^*$ gilt also
  $w\in\QET _{P'_1\|T}$. Aufgrund von~\ref{StilleSemSatz} kann die Menge $\QET
  _{P'_1\|T}$ auch als die Vereinigung von $\StQT _{P'_1\|T}$ und $\ET
  _{P'_1\|T}$ geschrieben werden.
  \begin{itemize}
    \item Fall 1 ($w\in\ET _{P'_1\|T}$): Es muss auch $\varepsilon\in\ET
      _{P'_1\|T}$ gelten, da $w$ keinen Input aus der Menge $I _{P'_1\|T}$
      enthält und somit $w$ kein Element der Menge $\cont (\MIT _{P'_1\|T})$
      sein kann. Es kann also der Beweis von Satz~\ref{KommTestVerfSatz}
      angewendet werden, um in diesem Fall zu folgern, dass für eine
      as"=Implementierung $P'_2$ von $P_2$ ein Fehler in $P'_2\|T$ lokal
      erreichbar ist und somit $\neg P_2\QsatAs T$ gilt.
    \item Fall 2 ($w\in\StQT _{P'_1\|T}\backslash\ET _{P'_1\|T}$): Damit dieser
      Fall eintreten kann, muss das Wort $w$ in $P'_1\|T$ einen stillen
      Zustand $(p_1,p_T)$ erreichen, der nicht in $E_{P'_1\|T}$ enthalten ist.
      Mit Lemma~\ref{StilleZustLem}.2 sind auch die Zustände $p_1$ und $p_T$ in
      den Teilsystemen still. Es gibt also eine Projektion des Wortes $w$ auf
      die Teilsysteme, so dass $w\in w_1\|w_T$, $w_1\in\StQT _{P'_1}$ und
      $w_T\in\StQT _T$ gilt, wobei $w_1$ den Zustand $p_1$ in $P'_1$ und $w_T$
      den Zustand $p_T$ in $T$ erreicht. $w_1$ ist in der Menge $\StQT _{P'_1}
      \subseteq \QET _{P'_1}$ enthalten. Mit Proposition~\ref{StilleSemProp}
      gilt also auch $w_1\in\QET _1$ und mit $P_1\QRel P_2$ folgt draus
      $w_1$ auch in der Menge $\QET _2$ enthalten sein muss. Es gibt wegen
      Proposition~\ref{StilleSemProp} auch eine as"=Implementierung $P'_2$ von
      $P_2$, für die $w_1\in\QET _{P'_2}$ gilt. Da die Menge \QET{} der
      fehler-gefluteten Stille-Trace ist, können im folgenden zwei Fälle
      unterschieden werden.
      \begin{itemize}
        \item Fall 2a) ($w_1\in\ET _{P'_2}$): Da $w_T$ in $T$ ausführbar ist,
          gilt $w_T\in L_T\subseteq\EL _T$ und somit folgt mit
          Satz~\ref{KommFehlerSemSatz}.1 $w\in\ET _{P'_2\|T}$. Es ist also wie
          im Beweis von Satz~\ref{KommTestVerfSatz} ein Fehler in $P'_2\|T$
          lokal erreichbar. Somit folgt wie in Fall 1 $\neg P_2\QsatAs T$.
        \item Fall 2b) ($w_1\in\StQT _{P'_2}$): Das Wort $w_1$ führt in $P'_2$
          zu einem Zustand $p_2$, der still ist. Wenn man also die Wörter $w_1$
          und $w_T$ in $P'_2\|T$ parallel zum Zustand $(p_2,p_T)$ ausführt, ist
          dieser Zustand durch Lemma~\ref{StilleZustLem}.1 still. Es gilt also
          $w\in\StQT _{P'_2\|T}$ mit $w\in O_{P'_2\|T}$, da $P_1$ und $P_2$ die
          selbe Signatur haben müssen. Ein stiller Zustand ist als in der
          Parallelkomposition $P'_2\|T$ lokal erreichbar. Es gilt also auch in
          diesem Fall $\neg P_2\QsatAs T$.
      \end{itemize}
  \end{itemize}
\end{proof}

Es wurde, wie im letzten Kapitel, eine Kette an Folgerungen gezeigt, die
sich zu einem Ring schließen. Dies ist in Abbildung~\ref{FolgerungsketteQui}
dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}[scale = 3]
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        P_1\QRel P_2 & P_1 \text{ verfeinert } P_2 \\
        \substack{\forall \text{ Test Partner } T:\\P_2\QsatAs T\Rightarrow
        P_1\QsatAs T} &
    \substack{\forall \text{ Tests } T:\\P_2\QsatAs T\Rightarrow P_1\QsatAs T} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {Satz~\ref{StilleTestVerfSatz}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition~\ref{StilleTestDef}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{StilleTestVerfeinLem}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
          (m-2-2) -- node [below]
          {$\substack{T \text{ Test Partner}\\\Downarrow\\ T \text{ Test}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette der Testing-Verfeinerung und Stillstands-Relation}
  \label{FolgerungsketteQui}
  \end{center}
\end{figure}

Aus der Abbildung~\ref{FolgerungsketteQui} folgt eine Äquivalenz, die im
nächsten Korollar noch extra hervorgehoben wird.

\begin{Kor}
  Es gilt: $P_1\QRel P_2 \Leftrightarrow P_1$ Stille-verfeinert $P_2$.
\end{Kor}
