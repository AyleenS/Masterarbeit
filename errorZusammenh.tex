\section{Zusammenhänge}

\begin{Satz}[Zusammenhang der Verfeinerungs-Relationen mit der Fehler-Relation]
  \label{ZusammenhFehlerSatz}
  Für \MEIO{}s $P$ und $Q$ gilt $P\wasRel Q\Rightarrow P\ERel Q$. Die
  Implikation in die andere Richtung gilt jedoch nicht.
\end{Satz}
\begin{proof}\mbox{}\\
  $P\wasRel Q\Rightarrow P\ERel Q$:\\
  Um diese Implikation zu beweisen wird gezeigt, dass eine beliebige
  schwache as"=Verfeinerungs"=Relation $\mathcal{R}$ zwischen $P$ und $Q$ auch
  die Eigenschaften der Relation $\ERel$ erfüllt. Da $\mathcal{R}$ eine
  schwache as"=Verfeinerungs"=Relation zwischen $P$ und $Q$ ist, muss $p_0
  \mathcal{R} q_0$ gelten. Es sind die folgenden Punkte nachzuweisen:
  \begin{itemize}
    \item $\ET _P \subseteq \ET _Q$,
    \item $\EL _P \subseteq \EL _Q$.
  \end{itemize}
  Für den ersten Punkt wird ein beliebiges $w$ aus $\ET _P$ betrachtet und
  gezeigt, dass dieses auch in $\ET _Q$ enthalten ist. Es kann davon
  ausgegangen werden, dass $w$ präfix-minimal ist, da beide \ET{}-Mengen unter
  \cont{} abgeschlossen sind. $w$ kann ein Element aus $\PrET (P)$ sein oder
  ein Element aus $\MIT (P)$.
  \begin{itemize}
    \item Fall 1 ($w\in\PrET (P)$): Es existiert ein $v\in O_P$, sodass das
      Wort $wv$ in $P$ einen Fehler-Zustand erreicht. Es gibt eine
      Transitionsfolge wie in Lemma~\ref{AblaefeSchwVerfSpezLem}, so dass $wv =
      (\alpha _1\alpha _2\dots \alpha _n)|_{\Sigma}$ gilt und der dadurch
      erreichte Zustand $p_n$ ein Zustand aus der Menge $E_P$ ist. Falls eines
      des $q_j$ für $0 \leq j < n$ in $E_Q$ enthalten ist, folgt mit dem Beweis
      von Lemma~\ref{AblaefeSchwVerfSpezLem}, dass ein Präfix von $wv$ in
      $\StET (Q)$ enthalten ist. Mit $w=\prune (wv)$ und dem Abschluss von
      \ET{} unter \cont{} gilt dann $w\in\ET _Q$. Ansonsten gibt es in $Q$
      einen Trace für das Wort $wv$, dass einen Zustand $q_n$ erreicht, für den
      $p_n \mathcal{R} q_n$ gilt. Mit~\ref{wSimDef}.1 folgt, dass $q_n\in E_Q$
      gelten muss und somit auch $w\in\ET _Q$ mit der Begründung von oben.
    \item Fall 2 ($w\in\MIT (P)$): $w$ ist in $P$ ein Input-kritischer Trace.
      Es existiert also eine Aufteilung von $w$ in $va$ mit $v\in \Sigma ^*$
      und $a\in I$, wobei $v$ in $P$ zu einem Zustand ausführbar ist, der den
      Input $a$ nicht sicherstellt. Es gibt also ein Ablauf des Wortes $v$ wie
      in Lemma~\ref{AblaefeSchwVerfSpezLem}, der zu einem Zustand $p_n$ führt,
      der keine ausgehende must"=Transition für $a$ besitzt. Falls ein $q_j$
      für $0 \leq j \leq n$ in $E_Q$ enthalten ist, folgt mit dem Beweis des
      Lemmas~\ref{AblaefeSchwVerfSpezLem} und dem Abschluss der Menge \ET{}
      unter \cont{} $w\in\ET _Q$. Ansonsten wird durch $v$ in $Q$ ein Zustand
      $q_n$ erreicht, für den $p_n\mathcal{R} q_n$ gilt. Da $a$ für $p_n$ in
      $P$ keine ausgehende must"=Transition sein kann, gilt mit~\ref{wSimDef}.2
      auch $q_n \nmust[a]$. $w$ ist in $\MIT _Q \subseteq \ET _Q$ enthalten.
  \end{itemize}
  Für den zweiten Punkt kann man sich auf die Inklusion $\EL _P\backslash\ET _P
  \subseteq \EL _Q$ einschränken, da der erste Punkt bereits vorausgesetzt
  werden kann. $\EL _P\backslash\ET _P$ ist eine Teilmenge der Sprache $L _P$.
  Somit ist ein $w$ aus $\EL _P\backslash\ET _P$ in $P$ ausführbar. Es gibt
  also einen Trace für $w$ in $P$ der Form, wie sie in
  Lemma~\ref{AblaefeSchwVerfSpezLem} vorausgesetzt wird. Falls ein $q_j$ für $0
  \leq j \leq n$ in $E_Q$ enthalten ist, gilt $w\in\ET _Q \subseteq \EL _Q$. Es
  wird also im Folgenden davon ausgegangen, dass kein $q_j$ ein Fehler-Zustand
  ist. Es gilt dann $q_0 \weakmay[\widehat{\alpha _1}]_Q q_1
  \weakmay[\widehat{\alpha _2}]_Q \dots q_{n-1} \weakmay[\widehat{\alpha _n}]_Q
  q_n$ in $Q$ mit $p_j \mathcal{R} q_j$ für $0 \leq j \leq n$ und somit $w\in L
  _Q\subseteq \EL _Q$.

  $P\wasRel Q\hspace{0.1cm}\not\hspace{-0.1cm}\Leftarrow P\ERel Q$:\\
  Die nicht Gültigkeit dieser Implikation beruht darauf, dass Simulationen
  strenger sind als Sprach Inklusionen. Das Gegenbeispiel hier ist also so
  aufgebaut, dass $\ET (P) =\ET (Q) = \emptyset$ und $L(P) \subseteq L(Q)$
  gilt, jedoch keine schwache as"=Verfeinerungs"=Relation zwischen $P$ und $Q$
  existieren kann. $Q$ und $P$ sind in der Abbildung~\ref{WasEGegenBsp}
  dargestellt. Damit $\ET (P) =\ET (Q) = \emptyset$ gilt, dürfen keine der
  Zustände Fehler-Zustände sein und es muss gefordert werden, dass die Menge
  $I$ der Inputs für die \MEIO{}s leer ist, ansonsten würde es Input-kritische
  Traces gegen. $P$ kann keine Aktionen ausführen und $Q$ nur die Output Aktion
  $o$ somit gilt für die Sprachen $\{\varepsilon\} = L(P) \subset L(Q) =
  \{\varepsilon , o\}$.\\
  Angenommen es gibt eine schwache as"=Verfeinerungs"=Relation $\mathcal{R}$
  zwischen $P$ und $Q$. Dafür muss $(p_0,q_0)\in \mathcal{R}$ gelten.Da die
  Transition $q_0 \must[o]_Q q_1$ in $Q$ vorhanden ist, wird die Verfeinerung
  dieser in $P$ gefordert es müsste auch eine must"=Output"=Transition in $P$
  geben. Es gibt jedoch keine must"=Transition in $P$, dies stellt einen
  Widerspruch zur Annahme dar und es folgt, dass es keine schwache
  as"=Verfeinerungs"=Relation zwischen $P$ und $Q$ geben kann.

  \begin{figure}[htbp]
    \begin{center}
      \begin{tikzpicture}[->, >=latex', auto,node distance=2.5cm, semithick]
        \node [initial,initial text=$P$:] (p0) at (0,0) {$p_0$};

        \node [initial,initial text=$Q$:] (q0) at (6,0) {$q_0$};
        \node (q1) [right of=q0] {$q_1$};

        \path
        (q0) edge node{$o!$} (q1)
        ;
      \end{tikzpicture}
      \caption{Gegenbeispiel zu $\wasRel \Leftarrow \ERel$ mit $I_P = I_Q =
      \emptyset$}
      \label{WasEGegenBsp}
    \end{center}
  \end{figure}
\end{proof}

In dieser Arbeit werden im Gegensatz zu~\cite{Vogler2016MIA3} die Fehler bei
einer Parallelkomposition beibehalten bzw.\ aus dieser entstehend angesehen. Es
werden dabei alle Transitionen, die nicht durch fehlende
Synchronisations"=Möglichkeiten wegfallen, übernommen. In~\cite{Vogler2016MIA3}
hingegen wird der Ansatz verfolgt alle Fehler zu entfernen und durch einen
universal Zustand zu ersetzten, der nur eingehende may"=Input"=Transitionen
zulässt. Außer dem universalen Zustand gibt es in einem \MIA wie
in~\cite{Vogler2016MIA3} keine anderen Fehler"=Zustände. Auf diese Normierung
wurde hier mit Absicht verzichtete um sehen zu können, dass die Fehler einen
Ursprung haben, den man später auch noch einsehen kann. Jedoch gibt es trotzdem
einen Zusammenhang zwischen diesen beiden Ansätzen.\\
Die Unterscheidung, die die Basisrelation \EBRel{} hier herbei führt, würde
dort der Unterscheidung zwischen Transitionssystemen, die den universal
Zustand $e$ als Startzustand haben und denen, die einen Startzustand ungleich
$e$ besitzen, entsprechen. Falls hier in einer as"=Implementierung von $P$ ein
Fehler lokal erreichbar ist, dann muss auch in $P$ ein Fehler-Zustand lokal
erreichbar sein, wegen~\ref{lokalFehlerErrKor}~(i). Dies entspricht
$\varepsilon \in \PrET (P)$. Das Abschneiden der lokalen Aktionen wird hier nur
in der Trace Menge praktiziert, in~\cite{Vogler2016MIA3} jedoch direkt auf den
Transitionssystemen. Im Fall der lokalen Fehler-Erreichbarkeit bleibt also
nur noch der Zustand $e$ als universal Zustand übrig, für den jedes Verhalten
zulässig ist. Für die Fehler"=Zustände ist in dem hier verwendeten Ansatz nur
auf Trace-Ebene bzw.\ bezüglich der Verfeinerungs-Relationen beliebiges
Verhalten möglich. In den Transitionssystemen gibt es die Transitionen für das
beliebiges Verhalten im allgemeinen nicht.\\
Da auch der Testing-Ansatz die lokale Fehler-Erreichbarkeit verwendet,
existiert der Zusammenhang auch dort für die Parallelkomposition mit dem
entsprechenden Test.\\
Für eine entsprechende Normierung, die die Input-kritischen Traces zum
universal Zustand führt und somit die \MEIO{}s bis auf den Fehler"=Zustand
Input"=enabled macht, gibt es zu jedem \MEIO{} einen äquivalenten \MIA{}. Mit
dieser Normierung für die \MEIO{}s entspricht \ERel{} der Relation
$\sqsubseteq$ aus~\cite{Vogler2016MIA3} für Input-enabled \MIA{}s bis auf den
Zustand $e$.\\
Gibt es in $Q$ jedoch einen Input-kritische Traces, würde $P \ERel Q$ zulassen,
dass $P$ einen gekürzten Fehler-Trace anstatt dessen besitzt. Diese Art der
Verfeinerung lässt $\sqsubseteq$ nicht zu. Jedoch sind die Input-kritischen
Traces auch dort die potentiellen Auslöser für neue Fehler-Zustände in einer
Parallelkomposition. Diese Problem basiert auf dem Problem, dass \ERel{} keine
schwache as"=Verfeinerungs"=Relation sein muss, die in \wasRel{} enthalten ist.

\begin{Def}[Normal Form]
  \label{NFDef}
  Ein \MEIO{} $P$ ist in \emph{Normal Form} (\NF{}), falls die Menge $E_P$ der
  Fehler"=Zustände nur ein einziges Element enthält $E_P=\{e\}$ und $P$ bis auf
  den Zustand $e$ Input-enabled ist. Zusätzlich soll für jede Transition, für
  die $p \may[\alpha] e$ mit $p\neq e$ gilt, $\alpha$ ein Element der Menge der
  Input"=Aktionen $I$ sein.

  Die \emph{Normal Form} von $P$ ist ein \MEIO{} $\NF (P)$, das man aus $P$
  durch die nachfolgenden zwei Schritte erhält:
  \begin{enumerate}[(i)]
    \item Definiere $\overline{E_P} = \{p \mid \exists p'\in E_P, w\in O^*:
      p\weakmay[w]_P p'\}$ und ersetzte $E_P$ durch $\overline{E_P}$.
    \item Falls $p_0\in \overline{E_P}$, ist $NF(P) = (\{p_0\}, I, O, \emptyset
      , \emptyset , p_0, \{p_0\})$.\\
      Ansonsten, füge einen neuen Zustand $e$ hinzu, der der einzige
      Fehler"=Zustand wird. Wann immer $p \may[\alpha]_P p'\in \overline{E_P}$
      und $p\notin \overline{E_P}$ für ein $\alpha\in \Sigma \cup \{\tau\}$
      gilt (dann gilt zwingendermaßen $\alpha \in I$), entferne alle
      $\alpha$-Transitionen, die von $P$ ausgehen und füge die Transition
      $p\may[\alpha]_{\NF (P)} e$ hinzu. Für alle $p\neq \overline{E_P}$, für
      die $p \nmust[i]$ für einen Input $i$ gilt, füge die Transitionen $p
      \must[i] e$ und $p \may[i] e$ hinzu.
  \end{enumerate}
\end{Def}

An allen Zuständen außer $e$, für die nicht alle Inputs sichergestellt wurden,
wurde die entsprechende must"=Transition zum Zustand $e$ in der Normal Form
hinzugefügt. Somit hat die Normal Form nur $e$ als einzigen Fehler"=Zustand und
bis auf $e$ sind auch für alle Zustände alle Inputs sichergestellt.\\
Schritt (i) den Normal Form Konstruktion verändert nicht an den Transitionen
und auch nichts daran, ob ein Zustand einen nicht sichergestellten Input hat
oder nicht. Die Menge \StET{} wird verändert jedoch bleibt die Menge \PrET{}
gleich, da \StET{} mach dem Schritt (i) alle Traces enthält, die direkt oder
durch lokal Aktionen zu einem Fehler"=Zustand des ursprünglichen \MEIO{}s
führen. Für die Menge $\MIT (P)\backslash\cont (\PrET (P))$ ändert sich nichts
durch die Anwendung des ersten Schrittes auf $P$, da sich an den Zuständen ohne
Zusammenhang zu Fehler"=Zuständen nicht ändert. Das Ergebnis des Schrittes (i)
entspricht also also $P$ bezüglich der Relation \ERel{}. Im ersten Fall von
Schritt (ii) gilt $\ET (P) = \Sigma ^* = \ET (\NF (P))$. Im zweiten Fall ändert
der Schritt (ii) nichts an Zuständen, die keine Transitionen zu Zuständen in
der Menge $\overline{E _P}$ besitzen und alle Inputs sicherstellen. Da jeweils
die erste Transition, die zu einem Zustand in der Menge $\overline{E _P}$ führt
zum Zustand $e$ umgebogen wird, sind die Traces, die in $\PrET (P)$ enthalten
sind auch alle in $\PrET (\NF (P))$ enthalten. Alle Traces aus $\MIT (P)$ waren
in $P$ nicht ausführbar. Durch das hinzufügen Input"=Transitionen an den
Zuständen mit nicht sichergestellten Inputs, führt dazu, dass die Menge $\MIT
(\NF (P))$ der Menge $\PrET (\NF (P))$ entspricht, da der Zustand $e$ als
Fehler"=Zustand keine ausgehenden Transitionen besitzt und alle fehlenden
must"=Input"=Transitionen aus $P$ in $\NF (P)$ zum Zustand $e$ führen. Die Menge
der Fehler"=Traces \ET{} bleibt somit im Schritt (ii) gleich. Die Sprache des
\MEIO{}s $P$ wird durch die Konstruktion in (ii) um die Traces in $(\cont
(\PrET (P))\backslash \PrET (P)) \cup (\cont (\MIT (P))\backslash \MIT (P))$
verkleinert. Da diese Traces jedoch in der Menge \ET{} enthalten sind, mit
denen die Sprache $L$ in \EL{} geflutet wird, spielt diese bezüglich der
Relation \ERel{} keine Rolle. Es gilt also auch $\EL (P) = \EL (\NF (P))$.
Somit ist $\NF (P)$ äquivalent zu $P$ bezüglich der Relation \ERel{}. Es gilt
also die folgende Proposition.

\begin{Prop}[Normal Form]
  Jedes \MEIO{} $P$ ist äquivalent zu seiner Normal Form $\NF (P)$ bezüglich
  der Relation \ERel{}.
\end{Prop}

Durch die Konstruktion in Definition~\ref{NFDef} kann man zu jedem \MEIO{} $P$
einen bezüglich der Relation \ERel{} äquivalenten \MEIO{} in Normal Form
konstruieren. Um zu zeigen, dass es auch immer einen bezüglich \ERel{}
äquivalenten \MIA{} wie in~\cite{Vogler2016MIA3} definiert gibt, reicht es nun
aus zu beweisen, dass ein \MEIO{} in Normal Form in einem \MIA{} umgewandelt
werden kann.

\begin{Satz}[Existenz äquvialenter \MIA{}s]
  Für jeden \MEIO{} $P$ gibt es einen äquivalenten \MIA{} $P'$ bezüglich der
  Relation \ERel{}.
\end{Satz}
\begin{proof}
  Man kann \oBdA{} davon ausgehen, dass $P$ ein \MEIO{} in Normal Form ist. $P$
  besitzt also genau einen Fehler"=Zustand. Dies ist der universale Zustand des
  \MIA{}s. Alle eingehenden Transitionen in den Zustand $e$ sind
  Input"=Transitionen un alle must"=Transitionen haben zugrundeliegende
  may"=Transitionen. Das einzige noch vorhandene Problem besteht in der Signatur
  der must"=Transitionen. Jedoch kann die Relation der must"=Transitionen einen
  äquivalenten \MIA{} $P'$ auf Basis der must"=Transitions"=Relation des
  \MEIO{}s $P$ definiert werden als: $\must _{P'} = \{(p, \alpha , Q) \mid
  (\forall p' \in Q: p \must[\alpha]_P p') \land (\neg \exists p' \in P
  \backslash Q: p \must[\alpha]_P p')\}$. Die Menge der Zustände von $P'$
  entspricht $P$. Die Startzustände von $P$ und $P'$ sind gleich, genau so wie
  die Mengen der Input- und Output-Aktionen. Für die Relation $\may _{P'}$ gilt
  $\may _{P'} = \may _{P}$. Das daraus resultierende Transitionssystem $P'$ ist
  ein \MIA{} nach der Definition in~\cite{Vogler2016MIA3}.
\end{proof}

Die \MIA{}s aus~\cite{Vogler2016MIA3} müssen jedoch im allgemeinen nicht
Input-enabled für alle Zustände außer $e$ sein. Falls jedoch alle nicht
sichergestellten Input"=Transitionen in einem \MIA{} ergänzt werden, wie in der
Konstruktion in Definition~\ref{NFDef}, ist jeder \MIA{} auch ein \MEIO{}, wenn
die must"=Transitions"=Relation in die entsprechenden einzelnen Transitionen
aufgespalten wird, die nur noch einen Zustand als Ziel haben und keine Menge
von Zuständen.
