\chapter{Verfeinerungen für Kommunikationsfehler-Freiheit}

\section{Erweiterungs-Ansatz}

Dieses Kapitel versucht die Präkongruenz für Error bei \EIO{}s aus
z.B.~\cite{Schinko2016BA} auf die hier betrachten \MEIO{}s zu erweitern.

\begin{Def}[fehler-freie Kommunikation]
  Ein Fehler"=Zustand ist \emph{lokal erreichbar} in einem \MEIO{} $P$, wenn
  ein $w\in O^*$ existiert mit $p_0 \weakmay[w]_{P} p\in E$.\\
  Zwei \MEIO{}s $P_1$ und $P_2$ \emph{kommunizieren fehler-frei}, wenn keine
  as"=Implementierungen ihrer Parallelkomposition $P_{12}$ einen
  Fehler"=Zustände lokal erreichen kann.
\end{Def}

\vspace{0.2cm}

\begin{Def}[Kommunikationsfehler-Verfeinerungs-Basirelation]
  \label{EBRelDef}
  Für zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur wird $P_1\EBRel{}
  P_2$ geschrieben, wenn nur dann ein Fehler"=Zustand in einer
  as"=Implementierung von $P_1$ lokal erreichbar ist, wenn es auch eine
  as"=Implementierung von $P_2$ gibt, in der ein Fehler"=Zustand auch lokal
  erreichbar ist. Die Basisrelation stellt eine \emph{Verfeinerung-Relation}
  bezüglich \emph{Kommunikationsfehler"=Freiheit} dar.\\
  \ECRel{} bezeichnet die \emph{vollständig abstrakte Präkongruenz} von
  \EBRel{} bezüglich $\cdot\|\cdot$, d.h.\ die gröbste Präkongruenz bezüglich
  $\cdot\|\cdot$, die in \EBRel{} enthalten ist.
\end{Def}

Für as"=Implementierungen $P_1$ und $P_2$ entspricht \EBRel{} der Relation
\EBbaRel{} aus~\cite{Schinko2016BA}.

Wie z.B.\ in~\cite{Schinko2016BA} werden die Fehler hier Trace-basiert
betrachtet.

\begin{Def}[Kommunikationsfehler-Traces]
  \label{KommTracesDef}
  Für ein \MEIO{} $P$ wird definiert:
  \begin{itemize}
    \item \emph{strikte Fehler-Traces}: $\StET (P) :=
      \left\{w\in\Sigma ^* \mid p_0 \weakmay[w]_P p \in E\right\}$,
    \item \emph{gekürzte Fehler-Traces}: $\PrET (P) :=
      \left\{\prune (w) \mid w\in\StET (P)\right\}$,
    \item \emph{Input-kritische-Traces}: $\MIT (P) := \left\{wa\in\Sigma ^*
      \mid p_0 \weakmay[w]_P p \land a\in I\land p\nmust[a]_P \right\}$.
  \end{itemize}
\end{Def}

Da die Basisrelation über as"=Implementierungen spricht, ist es wichtig bereits
in den Trace-Mengen eine Beziehung zwischen der allgemeinen Definition für
\MEIO{}s und deren as"=Implementierungen herzustellen. Die nächste Proposition
stellt eine Teilmengen"=Beziehung zwischen den Traces eines \MEIO{}s und den
Traces seiner as"=Implementierungen dar.

\begin{Prop}[Kommunikationsfehler-Traces und Implementierungen]
  \label{KommTracesProp}
  Sei $P$ ein \MEIO{}.
  \begin{enumerate}
    \item Für die strikten Fehler-Traces von $P$ gilt: $\StET (P) \subseteq
      \big\{w\in\Sigma ^* \mid \exists P' \in\asimp (P) :$ $p'_0
      \weakmust[w]_{P'} p' \in E\big\} = \underset{P' \in\asimp (P)}{\bigcup}
      \StET (P')$.
      \TODO{erzwungen Zeilenumbruch kontrollieren}
    \item Für die gekürzten Fehler-Traces von $P$ gilt: $\PrET (P) \subseteq
      \{\prune (w) \mid \exists P' \in$\linebreak $\asimp (P) : w\in\StET (P')
      \} = \underset{P' \in\asimp (P)}{\bigcup} \PrET (P')$,
      \TODO{erzwungen Zeilenumbruch kontrollieren}
    \item Für Input-kritischen-Traces von $P$ gilt: $\MIT (P) \subseteq
      \big\{wa\in\Sigma ^* \mid \exists P' \in\asimp (P) :$ $p'_0
      \weakmust[w]_{P'} p' \land a\in I\land p'\nmust[a]_{P'} \big\} =
      \underset{P' \in\asimp (P)}{\bigcup} \MIT (P')$.
      \TODO{erzwungen Zeilenumbruch kontrollieren}
  \end{enumerate}
\end{Prop}
\begin{proof}\mbox{}
  \begin{enumerate}
    \item Um die Inklusion zu zeigen wird eine Implementierung $P'$ angegeben,
      die die strickten Fehler-Traces von $P$ implementiert und zusätzlich auch
      noch eine passende as"=Verfeinerungs"=Relation $\mathcal{R}$ zwischen den
      beiden Transitionssystemen. $P'$ implementiert wie im Beweis zu
      Proposition~\ref{LImpProp} alle Transitionen von $P$. Das $P'$ wird hier
      jedoch im Gegensatz zu Beweis von~\ref{LImpProp} auch noch alle
      Fehler-Zustände aus $P$ implementieren. Die entsprechende
      as"=Verfeinerungs"=Relation $\mathcal{R}$ ist jedoch hier ebenfalls
      wieder die Identitäts-Relation zwischen den Zuständen der
      Transitionssysteme. Die Definition von $P'$ lautet also:
      \begin{itemize}
        \item $P'=P$,
        \item $p'_0=p_0$,
        \item $I_{P'}=I_P$ und $O_{P'}=O_P$,
        \item $\must _{P'} =\may _{P'} = \may _P$,
        \item $E_P'=E_P$.
      \end{itemize}
      Die Tupel, die von~\ref{SimDef}~2.\ und 3.\ als Elemente der
      as"=Verfeinerungs"=Relation $\mathcal{R}$ gefordert werden, sind bereits
      durch die Identitäts"=Relation garantiert. Wie im Beweis~\ref{LImpProp}.
      Für~\ref{SimDef}~1.\ muss für jedes in der as"=Verfeinerungs"=Relation
      $\mathcal{R}$ enthaltene Zustands-Paar gelten, wenn der Zustand aus $P$
      kein Fehler-Zustand ist, dann ist auch der Zustand aus $P'$ keiner, dies
      folgt aus der Gleichheit der Mengen $E_P$ und $E_P'$. Jeder Trace aus
      $\StET (P)$ ist via may"=Transitionen in $P$ ausführbar und führt dort zu
      einem Fehler-Zustand. Der analoge Trace ist auch in $P'$ möglich, da alle
      may"=Transitionen aus $P$ in $P'$ als must"=Transitionen implementiert
      wurden. Der dabei erreichte Zustand steht mit dem Fehler-Zustand in $P$
      in der Identitäts"=Relation $\mathcal{R}$, die Zustände entsprechen sich
      also. Es gilt mit $E_P'=E_P$, dass auch der in $P'$ erreichte Zustand ein
      Fehler-Zustand ist. Für die as"=Implementierung $P'$ von $P$ und der
      Identitäts"=Relation $\mathcal{R}$ als starke as"=Verfeinerungs"=Relation
      zwischen den Transitionssystemen gilt also $\StET (P) =\StET (P')$.
    \item Da der erste Punkt dieser Proposition bereits beweisen wurde, gilt
      bereits, dass alle strikten Fehler-Traces von $P$ in der Vereinigung
      aller strikten Fehler-Traces der as"=Implementierungen von $P$ enthalten
      sind. Wenn auf alle Wörter in beiden Mengen die \prune{}-Funktion
      angewendet wird, gilt die Inklusion der daraus entstanden Mengen
      weiterhin. Dies entspricht der Behauptung dies Punktes.
    \item Auch für diese Inklusion wird eine starke as"=Verfeinerungs"=Relation
      $\mathcal{R}$ und eine Implementierung $P'$ angegeben. Jedoch werden
      nicht wie bei 1.\ alle Transitionen von $P$ in $P'$ implementiert. Es
      wird auch für alle $wa$ aus $\MIT (P)$ eine eigene Implementierung $P'$
      geben und nicht eine für alle. Es werden alle must"=Transitionen aus $P$
      in $P'$ implementiert und zusätzlich die may"=Transitionen, die zum
      Ausführen von $w$ benötigt werden, so dass das $a$ danach in $P$ nicht
      gefordert wird. Es kann aufgrund möglicher Schleifen in $P$ auch nicht
      mehr die Identitäts"=Relation als as"=Verfeinerungs"=Relation gewählt
      werden. Der $w$ Trace wird entsprechend seiner Länge abgewickelt, so dass
      sicher gestellt wird, dass der Zustand am Ende dieses Traces wirklich
      ruhig ist und nicht Teil einer Schlinge in $w$. Für das Abwickeln werden
      die Zustände entsprechend ihrer Position in $w$ durchnummeriert. Für ein
      $w$, für das $wa\in\MIT (P)$, gilt: $\exists w'\in\Sigma _{\tau} ^*,
      \exists \alpha _1,\alpha _2,\dots ,\alpha _n, \exists p_1,p_2,\dots ,p_n:
      \hat{w'} = w\land w'=\alpha _1\alpha _2\dots \alpha _n\land p_0
      \may[\alpha _1] p_1 \may[\alpha _2] \dots p_{n-1}\may[\alpha _n] p_n$.
      Die starke as"=Verfeinerungs"=Relation $\mathcal{R}$ enthält in diesem
      Fall Tupel $((p,j),p)$ für alle $0\leq j \leq n$. Die entsprechende
      Definition für das $P'$, das $wa$ als Input-kritischen-Trace enthalten
      soll lautet:
      \begin{itemize}
        \item $P'=P\times \{0,1,\dots n\}$,
        \item $p'_0=(p_0,0)$,
        \item $I_P'=I_P$ und $O_P'=O_P$,
        \item $\begin{aligned}[t]
            \must _P'=\may _P'&= \left\{((p,j),\alpha ,(p',j+1))\mid p
            \may[\alpha]_P p', 0\leq j < n\right\}\\
            &\cup\left\{((p,j),\alpha ,(p',j))\mid p\must[\alpha]_P p',
            0\leq j \leq n\right\},
        \end{aligned}$
        \item $E_P'=\emptyset$.
      \end{itemize}
      Der Ablauf von $w$ aus $P$ wird in $P'$ durch $(p_0,0) \must[\alpha _1]
      (p_1,1) \must[\alpha _1]\dots (p_{n-1},n-1) \must[\alpha _n] (p_n,n)$
      simuliert. $w$ ist also in $P'$ ausführbar. $a$ ist für $(p_n,n)$ nicht
      ausführbar, da in $P$ für $p_n$ $p_n\nmust[a]$ gilt und für die Zustände
      mit der Nummer $n$ in $P'$ nur die must"=Transitionen implementiert
      werden. Die implementierten Transitionen in $P'$ haben nach Definition
      alle zugrundeliegende may"=Transitionen in $P$ an den in Relation
      $\mathcal{R}$ stehenden Zuständen. Es werden durch die zweite Menge der
      Transitions-Definition von $P'$ alle must"=Transitionen aus $P$
      entsprechend in $P'$ implementiert. Da die Menge $E_P'$ leer ist, gelten
      alle Bedingungen, damit $\mathcal{R}$ eine as"=Verfeinerungs"=Relation
      zwischen $P'$ und $P$ ist. Mit der Begründung von oben folgt auch $wa\in
      \MIT (P')$. Da für alle $wa$ aus $\MIT (P)$ eine entsprechende
      Implementierung mit as"=Verfeinerungs"=Relation $\mathcal{R}$ angegeben
      werden kann, gilt die Inklusion.
  \end{enumerate}
\end{proof}

\begin{Def}[Kommunikationsfehler-Semantik]
  \label{KommFehlerSemDef}
  Sei $P$ ein \MEIO{}.
  \begin{itemize}
    \item Die Menge der \emph{Fehler-Traces} von $P$ ist $\ET (P)
      := \cont (\PrET (P)) \cup\cont (\MIT (P))$.
    \item Die \emph{Fehler-geflutete Sprache} von $P$ ist $\EL
      (P) := L(P) \cup \ET (P)$.
  \end{itemize}
  Für zwei \MEIO{}s $P_1,P_2$ mit der gleichen Signatur wird $P_1\ERel P_2$
  geschrieben, wenn $\ET _1\subseteq \ET _2$ und $\EL _1 \subseteq \EL _2$
  gilt.
\end{Def}

Hierbei ist zu beachten, dass die Mengen \StET{}, \PrET{}, \MIT{}, \ET{} und
\EL{} nur denen aus~\cite{Schinko2016BA} entsprechen, wenn $P$ bereits eine
as"=Implementierung ist.\\
Aus den Propositionen für die Sprache und die Traces konnte für die Vereinigung
der gleichen Mengen über die Implementierungen immer nur eine
Inklusionsrichtung gefolgert werden, da die Definition~\ref{SimDef} nach einen
Fehler-Zustand in $P$ beliebiges Verhalten ins dessen as"=Implementierungen
zulässt. Mit dem Einsatz der \cont{}-Funktion zum beliebigen fortsetzten der
Traces kann dies ausgeglichen werden. Somit gilt wie die nächsten Proposition
behauptet für die Fehler-Traces und die Fehler-geflutete Sprache Gleichheit
und nicht nur die Inklusion, die aus den Propositionen vorher bereits folgt.

\begin{Prop}[Kommunikationsfehler-Semantik und Implementierungen]
  \label{KommSemProp}
  Sie $P$ ein \MEIO{}.
  \begin{enumerate}
    \item Für die Menge der Fehler-Traces von $P$ gilt $\ET (P) =
      \underset{P'\in\asimp (P)}{\bigcup} \ET (P')$.
    \item Für die Fehler-geflutete Sprache von $P$ gilt $\EL (P) =
      \underset{P'\in\asimp (P)}{\bigcup} \EL (P')$.
  \end{enumerate}
\end{Prop}
\begin{proof}\mbox{}\\
  1. \glqq$\subseteq$\grqq{}:
  \begin{align*}
    \ET (P)&\overset{\ref{KommFehlerSemDef}}{=} \cont (\PrET (P))\cup (\MIT
    (P))\\
    &\overset{\ref{KommTracesProp}}{\subseteq} \cont
    \left(\underset{P'\in\asimp (P)}{\bigcup} \PrET (P')\right)\cup \cont
    \left(\underset{P'\in\asimp (P)}{\bigcup} \MIT (P')\right)\\
    &\hspace{-0.4cm}\overset{\cont}{\overset{\text{monoton}}{=}} \underset{P'\in\asimp
    (P)}{\bigcup} \cont (\PrET (P'))\cup \cont (\MIT (P'))\\
    &\overset{\ref{KommFehlerSemDef}}{=} \underset{P'\in\asimp
    (P)}{\bigcup} \ET (P').\\
  \end{align*}

  1. \glqq$\supseteq$\grqq{}:\\
  Da für $P$ $\ET (P) = \cont (\PrET (P)) \cup \cont (\MIT (P))$ gilt und für
  alle as"=Implementierungen $P'$ von $P$ die analogen Gleichungen für $\ET
  (P')$ gelten, genügt es ein präfix-minimales $w$ aus $\ET (P')$ für eine
  as"=Implementierung $P'$ von $P$ zu betrachten. Da $w$ präfix-minimal ist für
  $P'$ ist $w$ entweder vollständig oder bis auf den letzten Buchstaben in $P'$
  ausführbar. Dies hängt davon ab, ob $w\in \PrET (P')$ oder $w\in \MIT (P')$
  gilt. Für $P$ muss jedoch nicht mal das Präfix von $w$ ohne den letzten
  Buchstaben von $w$ ausführbar sein. Für den weiteren Teil dieses Beweises
  soll gelten $w=va$ für $a\in\Sigma$ und $v\in\Sigma ^*$.
  \begin{itemize}
    \item Fall 1 ($v\notin L (P)$): Das $v$ kann in $P$ nicht ausgeführt
      werden. Dies kann nur der Fall sein, wenn ein Präfix von $v$ zu einem
      Fehler-Zustand in $P$ führt, da sonst~\ref{SimDef}~3.\ verletzt wäre. Es
      ist also ein Präfix von $w$ in $\StET (P)$ enthalten und somit gilt wegen
      der \cont{}-Funktion $w\in\ET (P)$.
    \item Fall 2 ($v\in L (P)$ und $w\in\PrET (P')$): In diesem Fall kann das
      Wort $v$ in $P$ ausgeführt werden. Falls $a$ in $P$ nicht ausgeführt
      werden kann, ist $w$ aufgrund der gleichen Argumentation wie im 1.\ Fall
      in $\ET (P)$ enthalten. Es wird also davon ausgegangen, dass $w\in L(P)$
      gilt. Die Definition~\ref{SimDef} fordert, dass alle Zustände $p_j$ und
      $p'_j$ aus $P$ bzw. $P'$ auf dem $w$-Trace in der starken
      as"=Verfeinerungs"=Relation $\mathcal{R}$ stehen. In $P'$ existiert eine
      Verlängerung $v\in O^*$ von $w$, so dass $wv\in\StET (P')$. Diese
      Verlängerung kann in $P$ möglicherweise nicht ausführbar sein, dann ist
      jedoch analog zu Fall 1 ein Präfix von $wv$ in $\StET (P)$ enthalten. Da
      $v$ nur aus Outputs besteht gilt $\prune (wv) = \prune (w)$. Es folgt
      also für ein Präfix von $w$ die Zugehörigkeit zur Menge $\PrET (P)$.
      Somit ist $w$ in $\ET (P)$ enthalten. Falls jedoch $wv$ in $P$
      ausführbar, kann immer noch ein echtes Präfix von $wv$ in $P$ zu einem
      Fehler-Zustand führen, wodurch wieder $w\in \ET (P)$ folgt. Falls jedoch
      alle Zustände (bis auf den letzten), die im Trace $wv$ auftauchen keine
      Fehler-Zustände sind, gilt für $p$ und $p'$ mit $p_0 \weakmay[wv]_P p$
      und $p'_0 \weakmust[wv]_{P'} p'$ $(p',p)\in\mathcal{R}$. Da $wv\in\StET
      (P')$ gilt, muss $p'\in E_{P'}$ gelten. Daraus folgt mit~\ref{SimDef}~1.,
      dass $p$ in $E_P$ enthalten sein muss. Es gilt also $wv\in\StET(P)$. Mit
      $\prune (w)=\prune (wv)$ folgt daraus $w\in\ET (P)$.
    \item Fall 3 ($v\in L (P)$ und $w\in\MIT (P')$): Da $w$ in $\MIT (P')$
      enthalten ist, $a\in I$. Falls ein Präfix von $v$ oder $v$ selbst in $P$
      zu einem Fehler Zustand führt, gilt wie in den beiden vorangegangen
      Fällen $w\in\ET (P)$. Es wird also davon ausgegangen, das auf dem $v$
      Trace in $P$ kein Fehler-Zustand erreicht wird auch der durch $v$
      erreichte Zustand $p$ in $P$ soll nicht in $E_P$ enthalten sein. Es gilt
      also $p_0 \weakmay[v]_P p$ und $p'_0 \weakmust[v]_P' p'$ mit $(p',p) \in
      \mathcal{R}$. Wobei $\mathcal{R}$ die as"=Verfeinerungs"=Relation ist,
      die $P'$ zu einer as"=Implementierung von $P$ macht. Falls $a$ für $p$
      eine ausgehende must"=Transition wäre, würde~\ref{SimDef}~2.\ auch für
      $p'$ die Implementierung der $a$ Transition fordern und somit würde nicht
      $wa\in\MIT (P')$ gelten. Es gilt also $p\nmust[a]$ und $va\in\MIT (P)$.
      Daraus ergibt sich direkt $w\in\ET (P)$.
  \end{itemize}

  2. \glqq$\subseteq$\grqq{}:
  {\allowdisplaybreaks
  \begin{align*}
    \EL (P)&\overset{\ref{KommFehlerSemDef}}{=} L(P)\cup \ET (P)\\
    &\overset{\ref{LImpProp}}{\subseteq} \left(\underset{P'\in\asimp
    (P)}{\bigcup} L (P')\right)\cup \ET (P)\\
    &\overset{1.}{=} \left(\underset{P'\in\asimp (P)}{\bigcup} L
    (P')\right)\cup \left(\underset{P'\in\asimp (P)}{\bigcup} \ET (P')\right)\\
    &= \underset{P'\in\asimp (P)}{\bigcup} L (P')\cup \ET (P')\\
    &\overset{\ref{KommFehlerSemDef}}{=} \underset{P'\in\asimp (P)}{\bigcup}
    \EL (P').\\
  \end{align*}}

  2. \glqq$\supseteq$\grqq{}:\\
  Da der erste Punkt dieser Proposition bereits beweisen ist, reicht es aus für
  diesen Punkt zu zeigen, dass $\underset{P'\in\asimp (P)}{\bigcup} \EL
  (P')\backslash \ET (P')$ eine Teilmenge von $\EL (P)$ ist. Die Menge $\EL
  (P')\backslash \ET (P')$ entspricht $L (P') \backslash \ET (P')$. Es musst
  also ein Wort $w$ aus der Sprache einer as"=Implementierung von $P$
  betrachtet werden, dass nicht in den Fehler-Traces dieser as"=Implementierung
  enthalten ist. Das Wort $w$ ist also in $P'$ ausführbar. Falls das $w$ in $P$
  jedoch nicht ausführbar ist, folgt wie zuvor $w\in\ET (P)\subseteq \EL (P)$,
  da ein Präfix von $w$ in $P$ zu einem Fehler-Zustand führen musst. Falls $w$
  ausführbar ist in $P$ gilt $w\in L(P)\subseteq \EL (P)$.
\end{proof}

\begin{Satz}[Kommunikationsfehler-Semantik für Parallelkompositionen]
  \label{KommFehlerSemSatz}
  Für zwei komponierbare \MEIO{}s $P_1,P_2$ und ihre Komposition $P_{12}$ gilt:
  \begin{enumerate}
    \item $\ET _{12} = \cont (\prune ((\ET _1\|\EL _2) \cup (\EL _1\|\ET
      _2)))$,
    \item $\EL _{12} = (\EL _1\|\EL _2) \cup \ET _{12}$.
  \end{enumerate}
\end{Satz}
\begin{proof}\mbox{}\\
  1. \glqq$\subseteq$\grqq{}:\\
  Da beide Seiten der Gleichung unter der Fortsetzung \cont{} abgeschlossen
  sind, genügt es ein präfix-minimales Element $w$ von $\ET _{12}$ zu
  betrachten. Diese Element ist aufgrund der Definition der Menge der
  Fehler-Traces in $\MIT _{12}$ oder in $\PrET _{12}$ enthalten.
  \begin{itemize}
    \item Fall 1 ($w\in\MIT _{12}$): Aus der Definition von \MIT{} folgt, dass
      es eine Aufteilung $w=xa$ gibt mit $(p_{01},p_{02}) \weakmay[x]_{12}
      (p_1,p_2) \land a \in I_{12} \land (p_1,p_2) \nmust[a]_{12}$. Da $I_{12}
      = (I_1\cup I_2) \backslash (O_1\cup O_2)$ ist, folgt $a\in (I_1\cup I_2)$
      und $a\notin (O_1\cup O_2)$. Es wird unterschieden, ob $a\in (I_1\cap
      I_2)$ oder $a\in (I_1\cup I_2) \backslash (I_1\cap I_2)$ ist.
    \begin{itemize}
      \item Fall 1a) ($a\in (I_1\cap I_2)$): Durch Projektion des Ablaufes auf
        die einzelnen Transitionssysteme erhält man \oBdA{}
        $p_{01}\weakmay[x_1]_1 p_1\nmust[a]_1$ und $p_{02}\weakmay[x_2]_2
        p_2\nmust[a]_2$ oder $p_{02}\weakmay[x_2]_2 p_2\must[a]_2$ mit $x\in
        x_1\|x_2$. Daraus kann $x_1a\in \cont (\MIT _1) \subseteq \ET _1$ und
        $x_2a\in \EL _2$ ($x_2a\in \MIT _2$ oder $x_2a \in L_2$) gefolgert
        werden. Damit folgt $w\in (x_1\|x_2) \cdot \{a\} \subseteq
        (x_1a)\|(x_2a)\subseteq \ET _1\|\EL _2$, und somit ist $w$ in der
        rechten Seite der Gleichung enthalten.
      \item Fall 1b) ($a\in (I_1\cup I_2)\backslash (I_1\cap I_2)$): \OBdA{}
        gilt $a\in I_1$. Durch die Projektion auf die einzelnen Komponenten
        erhält man: $p_{01}\weakmay[x_1]_1 p_1\nmust[a]_1$ und
        $p_{02}\weakmay[x_2]_2 p_2$ mit $x\in x_1\|x_2$. Daraus folgt $x_1a\in
        \cont (\MIT _1) \subseteq \ET _1$ und $x_2\in L_2\subseteq \EL _2$.
        Somit gilt $w\in (x_1\|x_2) \cdot \{a\} \subseteq (x_1a)\|x_2\subseteq
        \ET _1\|\EL _2$. Dies ist eine Teilmenge der rechten Seite der Gleichung.
    \end{itemize}
  \item Fall 2 ($w\in\PrET _{12}$): Aus der Definition von \PrET{} und \prune{}
    folgt, dass ein $v\in O_{12}^*$ gibt, so dass $(p_{01},p_{02})
      \weakmay[w]_{12} (p_1,p_2) \weakmay[v]_{12} (p'_1,p'_2)$ gilt mit
      $(p'_1,p'_2)\in E_{12}$ und $w=\prune (wv)$. Durch Projektion auf die
      Komponenten erhält man $p_{01} \weakmay[w_1]_1 p_1 \weakmay[v_1]_1 p'_1$
      und $p_{02} \weakmay[w_2]_2 p_2 \weakmay[v_2]_2 p'_2$ mit $w\in w_1\|w_2$
      und $v\in v_1\|v_2$. Aus $(p'_1,p'_2)\in\ET _{12}$ folgt, dass es sich
      entweder um einen geerbten oder einen neuen Fehler handelt. Bei einem
      geerbten wäre bereits einer der beiden Zustände $p'_1$ bzw.\ $p'_2$ ein
      Fehler"=Zustand gewesen. Ein neuer Fehler hingegen wäre
      durch das fehlen fehlende Sicherstellen der Synchronisation (fehlende
      must"=Transition) in einer der Komponenten entstanden.
    \begin{itemize}
      \item Fall 2a) (geerbter Fehler): \OBdA{} gilt $p'_1\in E_1$. Daraus
        folgt, $w_1v_1\in StET_1 \subseteq \cont (\PrET _1) \subseteq \ET _1$.
        Da $p_{02} \weakmay[w_2v_2]_2$ gilt, erhält man $w_2v_2\in L_2\subseteq
        \EL _2$. Dadurch ergibt sich $wv\in \ET _1\|\EL _2$ mit $w=\prune (wv)$
        und somit ist $w$ in der rechten Seite der Gleichung enthalten.
      \item Fall 2b) (neuer Fehler): \OBdA{} gilt $a\in I_1\cap O_2$ mit
        $p'_1\nmust[a]_1$ und $p'_2\may[a]_2$. Daraus folgt $w_1v_1a\in \MIT _1
        \subseteq \ET _1$ und $w_2v_2a\in L_2 \subseteq \EL _2$. Damit ergibt
        sich $wva\in \ET _1\|\EL_2$, da $a\in O_1\subseteq O_{12}$ gilt
        $w=\prune (wva)$ und somit ist $w$ in der rechten Seite der Gleichung
        enthalten.
    \end{itemize}
  \end{itemize}

  1. \glqq$\supseteq$\grqq{}:\\
  Wegen der Abgeschlossenheit beider Seiten der Gleichung gegenüber \cont{}
  wird auch in diesem Fall nur ein präfix-minimales Element $x\in\prune ((\ET
  _1\|\EL _2)\cup (\EL _1\| \ET _2))$ betrachtet. Da $x$ durch die Anwendung
  der \prune{}-Funktion entstanden ist, existiert ein $y\in O_{12} ^*$ mit
  $xy\in (\ET _1\|\EL _2)\cup (\EL _1\| \ET _2)$. \OBdA{} wird davon
  ausgegangen, dass $xy\in \ET _1\| \EL _2$ gilt, d.h.\ es gibt $w_1\in \ET _1$
  und $w_2\in \EL _2$ mit $xy \in w_1\| w_2$.\\
  Im Folgenden wird für alle Fälle von $xy$ gezeigt, dass es ein $v\in \PrET
  _{12} \cup \MIT _{12}$ gibt, das ein Präfix von $xy$ ist und $v$ entweder auf
  einen Input $I_{12}$ endet oder $v=\varepsilon$. Damit muss $v$ ein Präfix
  von $x$ sein. $\varepsilon$ ist Präfix von jedem Wort und sobald $v$
  mindestens einen Buchstaben enthält, muss das Ende von $v$ vor dem Anfang von
  $y\in O_{12}^*$ liegen. Dadurch ist ein Präfix von $x$ in $\PrET _{12}\cup
  \MIT _{12}$ enthalten und somit gilt $x\in \ET _{12}$, da \ET{} die
  Fortsetzung der Mengenvereinigung aus \PrET{} und \MIT{} ist.\\
  Sei $v_1$ das kürzeste Präfix von $w_1$ in $\PrET _1\cup \MIT _1$. Falls $w_2
  \in L_2$, so sei $v_2=w_2$, sonst soll $v_2$ das kürzeste Präfix von $w_2$ in
  $\PrET _2\cup \MIT _2$ sein. Jede Aktion in $v_1$ und $v_2$ hängt mit einer
  aus $xy$ zusammen. Es kann nun davon ausgegangen werden, dass entweder $v_2 =
  w_2\in L_2$ gilt oder die letzte Aktion von $v_1$ vor oder gleichzeitig mit
  der letzten Aktion von $v_2$ statt findet. Ansonsten endet $v_2 \in \PrET
  _2\cup \MIT _2$ vor $v_1$ und somit ist dieser Fall analog zu $v_1$ endet vor
  $v_2$.
  \begin{itemize}
    \item Fall 1 ($v_1=\varepsilon$): Da $\varepsilon\in\PrET _1\cup \MIT _1$,
      ist bereits in $P_1$ ein Fehler"=Zustand lokal erreichbar. $\varepsilon
      \in \MIT _1$ ist nicht möglich, da jedes Element aus \MIT{} nach
      Definition mindestens die Länge $1$ haben muss. Mit der Wahl
      $v'_2=v'=\varepsilon$ ist $v'_2$ ein Präfix von $v_2$.
    \item Fall 2 ($v_1\neq\varepsilon$): Aufgrund der Definitionen von \PrET{}
      und \MIT{} endet $v_1$ auf ein $a\in I_1$, d.h.\ $v_1=v'_1a$. $v'$ sei
      das Präfix von $xy$, das mit der letzten Aktion von $v_1$ endet, d.h.\
      mit $a$ und $v'_2=v'|_{\Sigma _2}$. Falls $v_2=w_2\in L_2$, dann ist
      $v'_2$ ein Präfix von $v_2$. Falls $v_2\in \PrET _2\cup \MIT _2$ gilt,
      dann ist durch die Annahme, dass $v_2$ nicht vor $v_1$ endet, $v'_2$ ein
      Präfix von $v_2$. Im Fall $v_2 \in \MIT _2$ weiß man zusätzlich, dass
      $v_2$ auf $b\in I_2$ endet. Es kann jedoch $a=b$ gelten.
  \end{itemize}
  In allen Fällen erhält man $v'_2=v'|_{\Sigma _2}$ ist ein Präfix von $v_2$
  und $v'\in v_1\|v'_2$ ist ein Präfix von $xy$. Es kann nur für die Fälle
  $a\notin I_2$ gefolgert werden, dass $p_{02} \weakmust[v'_2]_2$ gilt.
  \begin{itemize}
    \item Fall I ($v_1\in\MIT _1$ und $v_1\neq \varepsilon$): Es gibt einen
      Ablauf der Form $p_{01}\weakmay[v'_1]_1p_1\nmust[a]_1$ und es gilt $v'=v''a$.
      \begin{itemize}
        \item Fall Ia) ($a\notin\Sigma _2$): Es gilt $p_{02}\weakmay[v'_2]_2
          p_2$ mit $v''\in v'_1\|v'_2$. Dadurch erhält man $(p_{01},p_{02})
          \weakmay[v'']_{12} (p_1,p_2) \nmust[a]_{12}$ mit $a\in I_{12}$. Somit
          wird $v := v''a=v'\in\MIT _{12}$ gewählt.
        \item Fall Ib) ($a\in I_2$ und $v'_2\in\MIT _2$): Es gilt $v'_2=v''_2a$
          mit $p_{02}\weakmay[v''_2]_2\nmust[a]_2$ und $v''\in v'_1\|v''_2$. $a$
          ist für $P_2$, ebenso wie für $P_1$, ein nicht sichergestellter
          Input. Daraus folgt, dass $(p_1,p_2)\nmust[a]_{12}$ gilt. Es wird
          ebenfalls $v := v''a=v'\in\MIT _{12}$ gewählt.
        \item Fall Ic) ($a\in I_2$ und $v'_2\in L_2\backslash\MIT _2$): Es gilt
          $p_{02}\weakmay[v''_2]_2p_2\must[a]_2$ mit $v'_2=v''_2a$. Da die
          gemeinsamen Inputs synchronisiert werden, folgt
          $(p_1,p_2)\nmust[a]_{12}$ bereits aus $q_1\nmust[a]_1$. Somit kann
          hier nochmals $v:=v''a=v'\in \MIT _{12}$ gewählt werden.
        \item Fall Id) ($a\in O_2$): Es gilt $v'_2=v''_2a$ und $p_{02}
          \weakmay[v'_2]_2$. Man erhält also $p_{02}\weakmay[v''_2]_2 p_2 \may[a]_2$
          mit $v''\in v'_1\|v''_2$. Daraus ergibt sich $(p_{01},p_{02})
          \weakmay[v'']_{12} (p_1,p_2)$ mit $p_2\may[a]_1$, $p_1\nmust[a]_1,
          a\in I_1$ und $a\in O_2$, somit gilt $(p_1,p_2)\in E_{12}$.
          Es wird $v:= \prune (v'')\in\PrET _{12}$ gewählt.
      \end{itemize}
    \item Fall II ($v_1\in\PrET _1$): $\exists u_1\in O_1^*: p_{01}
      \weakmay[v_1]_1 p_1 \weakmay[u_1]_1 p'_1$ mit $p'_1\in E_1$. Im Fall $v'_1
      \neq\varepsilon$ kann das $a$, auf das $v_1$ endet, ebenfalls der letzte
      Buchstabe von $v_2$ sein. Im Fall von $v_2\in\MIT _2$ kann somit $a=b$
      gelten, wodurch $v_2=v'_2$ gilt. Dieser Fall verläuft jedoch analog zu
      Fall Ic) und wird hier nicht weiter betrachtet. Es gilt für alle anderen
      Fälle $p_{02}\weakmay[v'_2]_2p_2$ mit $(p_{01},p_{02}) \weakmay[v']_{12}
      (p_1,p_2)$.
      \begin{itemize}
        \item Fall IIa) \big($u_2\in (O_1\cap I_2)^*,c\in (O_1\cap I_2)$,
          sodass $u_2c$ Präfix von $u_1|_{I_2}$ mit $p_2 \weakmust[u_2]_2 p'_2
          \nmust[c]_2$\big): Für das Präfix $u'_1c$ von $u_1$ mit
          $(u'_1c)|_{I_2}=u_2c$ weiß man, dass $q_1\weakmay[u'_1]_1 q''_1
          \may[c]_1$. Somit gilt $u'_1\in u'_1\|u_2$ und $(p_1,p_2)
          \weakmay[u'_1]_{12} (q''_1,q'_2)\in E_{12}$, da für $P_2$ der
          entsprechende Input nicht sichergestellt wird, der mit dem $c$ Output
          von $P_1$ zu koppeln wäre. Es handelt sich also um einen neuen
          Fehler. Es wird $v := \prune (v'u'_1)\in \PrET _{12}$
          gewählt, dies ist ein Präfix von $v'$, da $u_1\in O_1^*$.
        \item Fall IIb) \big($p_2\weakmust[u_2]_2p'_2$ mit
          $u_2=u_1|_{I_2}$\big): Es gilt $u_1\in u_1\|u_2$ und $(p_1,p_2)
          \weakmay[u_1]_{12} (p'_1,p'_2)\in E_{12}$, da $p'_1\in E_1$ und somit
          handelt es sich in $P_{12}$ um einen geerbten Fehler. Nun wird
          $v:=\prune (v'u_1)\in\PrET _{12}$ gewählt, das wiederum ein Präfix
          von $v'$ ist.
      \end{itemize}
  \end{itemize}

  2.:\\
  Durch die Definitionen ist klar, dass $L_i\subseteq \EL _i$ und $\ET
  _i\subseteq \EL _i$ gilt. Die Argumentation startet auf den rechten Seite der
  Gleichung:
  \begin{align*}
    (\EL{}_1\| \EL{}_2)\cup
    \ET{}_{12}&\overset{\ref{KommFehlerSemDef}}{=}\left(\left(L_1\cup
    \ET{}_1\right)\|\left(L_2\cup \ET{}_2\right)\right)\cup \ET{}_{12}\\
    &=(L_1\|L_2) \cup \underset{\overset{1.}{\subseteq}
    \ET{}_{12}}{\underset{\subseteq
    (\EL{}_1\|\ET{}_2)}{\underbrace{(L_1\|\ET{}_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \ET{}_{12}}{\underset{\subseteq
    (\ET{}_1\|\EL{}_2)}{\underbrace{(\ET{}_1\|L_2)}}} \cup
    \underset{\overset{1.}{\subseteq} \ET{}_{12}}{\underset{\subseteq
    (\EL{}_1\|\ET{}_2)}{\underbrace{(\ET{}_1\|\ET{}_2)}}} \cup \ET{}_{12}\\
    &=(L_1\|L_2) \cup \ET{}_{12}\\
    &\overset{\ref{LParallelProp}}{=}L_{12}\cup \ET{}_{12}\\
    &\overset{\ref{KommFehlerSemDef}}{=}\EL{}_{12}.
  \end{align*}
\end{proof}

\begin{Kor}[Kommunikationsfehler-Präkongruenz]
  \label{KommPraekonKor}
  Die Relation \ERel{} ist eine Präkongruenz bezüglich $\cdot\|\cdot$.
\end{Kor}
\begin{proof}
  Es muss gezeigt werden: Wenn $P_1\ERel P_2$ gilt, dann für jedes
  komponierbare $P_3$ auch $P_{31}\ERel P_{32}$. D.h.\ es ist zu zeigen,
  dass aus $\ET{}_1\subseteq \ET{}_2$ und $\EL{}_1\subseteq \EL{}_2$,
  $\ET{}_{31}\subseteq \ET{}_{32}$ und $\EL{}_{31}\subseteq
  \EL{}_{32}$ folgt. Dies ergibt sich aus der Monotonie von \cont{},
  \prune{} und $\cdot \|\cdot$ auf Sprachen wie folgt:\\
  \begin{itemize}
    \item $\begin{aligned}[t]
        \ET{}_{31} &\overset{\ref{KommFehlerSemSatz}~1.}{=}
      \cont{}\left(\prune{}\left(\left(\ET{}_3\|\EL{}_1\right)\cup
          \left(\EL{}_3\|\ET{}_1\right)\right)\right)\\
      &\hspace{-0.4cm}\overset{\ET{}_1\subseteq
    \ET{}_2}{\overset{\mathrm{und}}{\overset{\EL{}_1\subseteq \EL{}_2}{\subseteq}}}
    \cont{}\left(\prune{}\left(\left(\ET{}_3\|\EL{}_2\right)\cup
        \left(\EL{}_3\|\ET{}_2\right)\right)\right)\\
    &\overset{\ref{KommFehlerSemSatz}~1.}{=} \ET{}_{32},
    \end{aligned}$
    \item $\begin{aligned}[t]
        \EL{}_{31} &\overset{\ref{KommFehlerSemSatz}~2.}{=}
        (\EL{}_3\|\EL{}_1)\cup E_{31}\\
        &\hspace{-0.5cm}\overset{\EL{}_1\subseteq
      \EL{}_2}{\overset{\mathrm{und}}{\overset{\ET{}_{31}\subseteq
      \ET{}_{32}}{\subseteq}}} (\EL{}_3\|\EL{}_2)\cup \ET{}_{32}\\
      &\overset{\ref{KommFehlerSemSatz}~2.}{=} \EL{}_{32}.
    \end{aligned}$
  \end{itemize}
\end{proof}

\begin{Lem}[Verfeinerung mit Kommunikationsfehlern]
  \label{KommVerfeinLem}
  Gegeben sind zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur. Wenn
  $U\|P_1\EBRel{} U\|P_2$ für alle Partner $U$ gilt, dann folgt daraus die
  Gültigkeit von $P_1\ERel{} P_2$.
\end{Lem}
\begin{proof}
  Da $P_1$ und $P_2$ die gleiche Signaturen haben wird $I:=I_1=I_2$ und
  $O:=O_1=O_2$ definiert. Für jeden Partner $U$ gilt $I_U=O$ und $O_U=I$.\\
  Um $P_1\ERel{}P_2$ zu zeigen, wird nachgeprüft, ob folgendes gilt:
  \begin{itemize}
    \item $\ET _1\subseteq \ET _2$,
    \item $\EL _1\subseteq \EL _2$.
  \end{itemize}
  Für ein gewähltes präfix-minimales Element $w\in\ET _1$ wir gezeigt, dass
  dieses $w$ oder eines seiner Präfixe in $\ET _2$ enthalten ist. Dies ist
  möglich, da die beiden Mengen $\ET _1$ und $\ET _2$ durch \cont{}
  abgeschlossen sind.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es handelt sich um einen lokal erreichbaren
      Fehler-Zustand in $P_1$. Für $U$ wird ein Transitionssystem verwendet,
      das nur aus dem Startzustand und einer must-Schleife für alle Inputs
      $x\in I_U$ besteht. Somit kann $P_1$ die im Prinzip gleichen
      Fehler-Zustände lokal erreichen wie alle möglichen as"=Implementierungen
      von $U\|P_1$ zusammen. Daraus folgt, dass auch mindestens eine
      as"=Implementierung von $U\|P_2$ einen lokal erreichbaren Fehler-Zustand
      haben muss. Durch die Definition von $U$ kann dieser Fehler nur von $P_2$
      geerbt sein. Es muss also in $P_2$ ein Fehler-Zustand durch interne
      Aktionen und Outputs erreichbar sein, d.h.\ es gilt $\varepsilon\in
      \PrET{}_2$.
    \item Fall 2 ($w=x_1\dots x_n x_{n+1}\in\Sigma ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I = O_U$): Es wird der folgende Partner $U$ betrachtet (siehe
      auch Abbildung~\ref{UohneE}):
      \begin{itemize}
        \item $U=\{p_0,p_1,\dots ,p_{n+1}\}$,
        \item $p_{0U}=p_0$,
        \item $\begin{aligned}[t]
            \must _U&=\{(p_j,x_{j+1},p_{j+1})\mid  0\leq j\leq n\}\\
            &\cup\{(p_j,x,p_{n+1})\mid  x\in I_U\backslash\{x_{j+1}\}, 0\leq
            j\leq n\}\\
            &\cup\{(p_{n+1},x,p_{n+1})\mid  x\in I_U\},
        \end{aligned}$
        \item $E_U=\emptyset$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n) [right of=dots] {$p_n$};
          \node (n1) at ($(1)!0.5!(dots) + (0,-3)$) {$p_{n+1}$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (n1)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (n1)
                (dots) edge node {$x_n$} (n)
                       edge [dashed] (n1)
                (n) edge node [above, sloped] {$x?\in I_U$} (n1)
                    edge [bend left] node [sloped] {$x_{n+1}$!} (n1)
                (n1) edge [loop below] node {$x?\in I_U$} (n1);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_U\backslash\{x_j\}$}
      \label{UohneE}
      \end{center}
      \end{figure}
      Für $w$ können nun zwei Fälle unterschieden werden. Aus beiden wird
      folgen, dass für mindestens eine as"=Implementierung $P'$ von $U\|P_1$
      $\varepsilon\in\PrET(P')$ gilt.
      \begin{itemize}
        \item Fall 2a) ($w\in\MIT _1$): In $U\|P_1$ erhält man $(p_0,p_{01})
          \lweakmay[x_1\dots x_n]_{U\|P_1} (p_n,p')$ mit $p'\nmust[x_{n+1}]_1$
          und $p_n\must[x_{n+1}]_U$. Deshalb gilt $(p_n,p')\in E_{U\|P_1}$. Da
          alle Aktionen aus $w$ bis auf $x_{n+1}$ synchronisiert werden und
          $I\cap I_U=\emptyset$, gilt $x_1,\dots , x_n\in O_{U\|P_1}$. Da
          $(p_n,p')\in E_{U\|P_1}$ gibt es mindestens ein $P'$ in $\asimp
          (U\|P_1)$, das diesen Fehler-Zustand ebenfalls enthält. Daraus ergibt
          sich dann $\varepsilon\in\PrET (P')$.
        \item Fall 2b) ($w\in\PrET _1$): In der Parallelkomposition von $U$ und
          $P_1$ erhält man $(p_0,p_{01}) \weakmay[w]_{U\|P_1} (p_{n+1},p'')
          \weakmay[u]_{U\|P_1} (p_{n+1},p')$ für $u\in O^*$ und $p'\in E_1$.
          Daraus folgt $(p_{n+1},p')\in E_{U\|P_1}$ und somit $wu\in\StET
          (U\|P_1)$. Da alle Aktionen in $w$ synchronisiert werden und $I\cap
          I_U=\emptyset$, gilt $x_1,\dots ,x_n,x_{n+1}\in O_{U\|P_1}$ und, da
          $u\in O^*$, folgt $u\in O_{U\|P_1}^*$. Somit ergibt sich für eine
          as"=Implementierung $P'$ von $U\|P_1$ $\varepsilon\in\PrET (P')$.
      \end{itemize}
      Da $\varepsilon\in\PrET (P')$ für ein $P'$ aus $\asimp (U\|P_1)$ gilt,
      kann durch $U\|P_1\EBRel U\|P_2$ geschlossen werden, dass auch in
      mindestens einer as"=Implementierung von $U\|P_2$ ein Fehler-Zustand
      lokal erreichbar sein muss. Da as"=Implementierungen die
      Definition~\ref{SimDef} erfüllen müssen, muss falls in einer
      as"=Implementierung von $U\|P_2$ ein Fehler lokal erreichbare ist auch in
      $U\|P_2$ ein Fehler-Zustand lokal erreichbar sein.\\
      Der in $U\|P_2$ erreichbare Fehler kann geerbt oder neu sein.
      \begin{itemize}
        \item Fall 2i) (neuer Fehler): Da jeder Zustand von $U$ alle Inputs
          $x\in O=I_U$ durch must"=Transitionen sicherstellt, muss ein lokal
          erreichbarer Fehler-Zustand der Form sein, dass ein Output $a\in O_U$
          von $U$ möglich ist, der nicht mit einem passenden Input aus $P_2$
          synchronisiert werden muss ($P_2$ enthält die entsprechende $a$
          Transitionen nicht als must"=Transition). Durch die Konstruktion von
          $U$ sind in $p_{n+1}$ keine Outputs möglich. Ein neuer
          Fehler muss also die Form $(p_i,p')$ haben mit $i\leq
          n, p'\nmust[x_{i+1}]_2$ und $x_{i+1}\in O_U=I$. Durch Projektion
          erhält man dann $p_{02}\lweakmay[x_1\dots x_i]_2p'\nmust[x_{i+1}]_2$
          und damit gilt $x_1\dots x_{i+1}\in\MIT _2\subseteq \ET _2$. Somit
          ist ein Präfix von $w$ in $\ET _2$ enthalten.
        \item Fall 2ii) (geerbter Fehler): $U$ hat $x_1\dots x_iu$ mit $u\in
          I_U^*=O^*$ ausgeführt und ebenso hat $P_2$ dieses Wort abgearbeitet.
          Durch dies hat $P_2$ einen Zustand  in $E_2$ erreicht, da von $U$
          keine Fehler geerbt werden können. Es gilt dann $\prune (x_1\dots
          x_iu) = \prune (x_1\dots x_i)\in\PrET _2\subseteq \ET _2$. Da
          $x_1\dots x_i$ ein Präfix von $w$ ist, führt in diesem Fall eine
          Verlängerung um lokale Aktionen von einem Präfix von $w$ zu einem
          Fehler-Zustand. Da \ET{} der Menge aller Verlängerungen von gekürzten
          Fehler-Traces entspricht, ist $x_1\dots x_i$ in $\ET
          _2$ enthalten und somit ist ein Präfix von $w$ in $\ET _2$ enthalten.
      \end{itemize}
  \end{itemize}

  Um die andere Inklusion zu beweisen, reicht es aufgrund der ersten
  Inklusion und der Definition von \EL{} aus zu zeigen, dass $L_1\backslash\ET
  _1\subseteq \EL _2$ gilt.\\
  Es wird dafür ein beliebiges $w\in L_1\backslash \ET _1$ gewählt und gezeigt,
  dass es in $\EL _2$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Da $\varepsilon$ immer in $\EL _2$
      enthalten ist, muss hier nichts gezeigt werden.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Es wird ein Partner $U$ wie
      folgt konstruiert (siehe dazu auch Abbildung~\ref{UmitE}):
      \begin{itemize}
        \item $U=\{p_0,p_1,\dots ,p_n,p\}$,
        \item $p_{0U}=p_0$,
        \item $\begin{aligned}[t]
            \must _U&=\{(p_j,x_{j+1},p_{j+1})\mid 0\leq j< n\}\\
            &\cup\{(p_j,x,p)\mid x\in I_U\backslash\{x_{j+1}\},0\leq j< n\}\\
            &\cup\{(p,x,p)\mid x\in I_U\},
        \end{aligned}$
        \item $E_U=\{p_n\}$.
      \end{itemize}
      \begin{figure} [h!tbp]
      \begin{center}
        \begin{tikzpicture}[->, >=latex',auto,node distance =3cm, semithick]

          \node (0) {$p_0$};
          \node (1) [right of=0] {$p_1$};
          \node (dots) [right of=1] {$\dots$};
          \node (n1) [right of=dots] {$p_{n-1}$};
          \node (n) [right of=n1, rectangle, draw] {$p_n\in E_U$};
          \node (q) at ($(1)!0.5!(dots) + (0,-3)$) {$p$};

          \path ($ (0) + (-1,0) $) edge (0)
                (0) edge node {$x_1$} (1)
                    edge [bend right] node [below, sloped] {$x?\neq x_1$} (q)
                (1) edge node {$x_2$} (dots)
                    edge node [below, sloped] {$x?\neq x_2$} (q)
                (dots) edge node {$x_{n-1}$} (n1)
                       edge [dashed] (q)
                (n1) edge node {$x_n$} (n)
                edge [bend left] node [below, sloped] {$x?\neq x_n$} (q)
                (q) edge [loop below] node {$x?\in I_U$} (q);
        \end{tikzpicture}
        \caption{$x?\neq x_j$ steht für alle $x\in I_U\backslash\{x_j\}$, $p_n$
          ist der einzige Fehler-Zustand}
      \label{UmitE}
      \end{center}
      \end{figure}
      Da $p_{01}\weakmay[w]_1p'$ gilt, kann man schließen, dass $U\|P_1$ einen
      lokal erreichbaren geerbten Fehler hat. Es gibt also auch mindestens eine
      as"=Implementierung in der Menge $\asimp (U\|P_1)$, die diesen lokal
      erreichbaren Fehler implementiert. Somit muss es eine as"=Implementierung
      von $U\|P_2$ geben, die ebenfalls einen lokal erreichbaren Fehler-Zustand
      hat. Aufgrund von Definition~\ref{SimDef}~3.\ muss dann ebenfalls ein
      Fehler-Zustand in $U\|P_2$ lokal erreichbar sein.
      \begin{itemize}
        \item Fall 2a) (neuer Fehler aufgrund von $x_i\in O_U$ und $p_{02}
          \lweakmay[x_1\dots x_{i-1}]_2p''\nmust[x_i]_2$): Es gilt $x_1\dots
          x_i\in \MIT _2$ und somit $w\in \EL_2$. Anzumerken ist, dass es nur
          auf diesem Weg Outputs von $U$ möglich sind, deshalb gibt es keine
          anderen Outputs von $U$, die zu einem neuen Fehler führen können.
        \item Fall 2b) (neuer Fehler aufgrund von $a\in O=I_U$): Der einzige
          Zustand, in dem $U$ nicht alle Inputs erlaubt sind, ist $p_n$, der
          bereits ein Fehler-Zustand ist. Da in diesem Fall dieser Zustand in
          $U\|P_2$ erreichbar ist, besitzt das komponierte \MEIO{} einen
          geerbten Fehler und es gilt $w\in L_2\subseteq \EL _2$, wegen dem
          folgenden Fall 2c).
        \item Fall 2c) (geerbter Fehler von $U$): Da $p_n$ der einzige
          Fehler-Zustand in $U$ ist und alle Aktionen synchronisiert sind, ist
          dies nur möglich, wenn $p_{02} \lweakmay[x_1\dots x_n]_2$ gilt. In
          diesem Fall gilt $w\in L_2\subseteq \EL _2$.
        \item Fall 2d) (geerbter Fehler von $P_2$): Es gilt dann $p_{02}
          \lweakmay[x_1\dots x_iu]_2 p'\in E_2$ für $i\geq 0$ und $u\in O^*$.
          Somit ist $x_1\dots x_iu\in\StET _2$ und damit $\prune (x_1\dots
          x_iu) =\prune (x_1\dots x_i)\in\PrET _2\subseteq \EL _2$. Es gilt
          also $w\in\EL _2$.
      \end{itemize}
  \end{itemize}
\end{proof}

Der folgende Satz sagt aus, dass \ERel{} die gröbste Präkongruenz ist, die
charakterisiert werden soll, also gleich der vollständig abstrakten
Präkongruenz \ECRel{}.

\begin{Satz}[Vollständige Abstraktheit für Kommunikationsfehler-Semantik]
  \label{KommVollAbstraktSatz}
  Für zwei \MEIO{}s $P_1$ und $P_2$ mit derselben Signatur gilt $P_1\ECRel
  P_2\Leftrightarrow P_1\ERel{} P_2$.
\end{Satz}
\begin{proof}\mbox{}\\
  \glqq$\Leftarrow$\grqq: Nach Definition gilt, genau dann wenn
  $\varepsilon\in\ET (P)$, ist ein Fehler-Zustand lokal erreichbar in $P$. $P_1
  \ERel P_2$ impliziert, dass $\varepsilon\in\ET _2$ gilt, wenn
  $\varepsilon\in\ET _1$. Somit ist ein Fehler-Zustand in $P_1$ nur dann lokal
  erreichbar, wenn dieser auch in $P_2$ lokal erreichbar ist. Falls es also
  eine as"=Implementierung von $P_1$ gibt, in der ein Fehler-Zustand lokal
  erreichbar ist, dann gibt es auch mindestens eine as"=Implementierung von
  $P_2$, die einen Fehler-Zustand lokal erreichen kann. Dadurch folgt,
  dass $P_1\EBRel P_2$ gilt, da \EBRel{} in Definition~\ref{EBRelDef} über die
  lokale Erreichbarkeit der Fehler-Zustande in den as"=Implementierungen
  definiert wurde und die \ET{}-Mengen von $P_1$ und $P_2$ auch in der
  Vereinigung der Traces ihrer as"=Implementierungen enthalten sind, wie in
  Proposition~\ref{KommSemProp}, ausgedrückt werden können. Es ist also
  \ERel{} in \EBRel{} enthalten. Wie in Korollar~\ref{KommPraekonKor} gezeigt,
  ist \ERel{} eine Präkongruenz bezüglich $\cdot\|\cdot$. Da \ECRel{} die
  gröbste Präkongruenz bezüglich $\cdot\|\cdot$ ist, die in \EBRel{} enthalten
  ist, muss \ERel{} in \ECRel{} enthalten sein. Es folgt also aus $P_1\ERel{}
  P_2$, dass auch $P_1\ECRel{} P_2$ gilt.

  \glqq$\Rightarrow$\grqq: Durch die Definition von \ECRel{} als Präkongruenz
  in~\ref{EBRelDef} folgt aus $P_1\ECRel{} P_2$, dass $U\|P_1\ECRel U\|P_2$ für
  alle \MEIO{}s $U$ gilt, die mit $P_1$ komponierbar sind. Da \ECRel{} nach
  Definition auch in \EBRel{} enthalten sein soll, folgt aus $U\|P_1\ECRel{}
  U\|P_2$ auch die Gültigkeit von $U\|P_1\EBRel{}U\|P_2$ für alle diese
  \MEIO{}s $U$. Mit Lemma~\ref{KommVerfeinLem} folgt dann $P_1\ERel{} P_2$.
\end{proof}

Es wurde somit eine Kette an Folgerungen gezeigt, die sich zu einem Ring
schließt. Dies ist in Abbildung~\ref{KommFolgerungskette} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}[scale = 3]
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        P_1\ERel P_2 & P_1\ECRel P_2 \\
        \substack{\forall~\mathrm{Partner}~U:\\U\|P_1\EBRel U\|P_2} &
    \substack{\forall~\mathrm{komponierbaren}~U:\\U\|P_1\EBRel U\|P_2} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {\glqq{}$\Leftarrow$\grqq{} von
            Satz~\ref{KommVollAbstraktSatz}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition von \ECRel{}
          in~\ref{EBRelDef}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{KommVerfeinLem}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
          (m-2-2) -- node [below]
          {$\substack{U~\mathrm{Partner}\\\Downarrow\\
          U~\mathrm{komponierbar}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette der Fehler-Relationen}
  \label{KommFolgerungskette}
  \end{center}
\end{figure}

Angenommen man definiert, dass $P_1$ $P_2$ verfeinern soll, genau dann wenn für
alle Partner \MEIO{}s $U$, für die $P_2$ fehler-frei mit $U$ kommuniziert,
folgt, dass $P_1$ ebenfalls fehler-frei mit $U$ kommuniziert. Dann wird auch
diese Verfeinerung durch \ERel{} charakterisiert.

\begin{Kor}
  Es gilt: $P_1\ERel P_2\Leftrightarrow U\|P_1\EBRel U\|P_2$ für alle Partner
  $U$.
\end{Kor}

\section{Testing-Ansatz}

Der Testing-Ansatz stützt sich auf den Ansatz, der in~\cite{Vogler2015FailSem}
angewendet wurde. Jedoch sind Tests dort Tupel aus einer Implementierung und
einer Menge an Aktionen, über denen synchronisiert werden soll. Die \MEIO{}s,
die hier komponiert werden bringen die Menge $\Synch$ an Aktionen, die
synchronisiert werden bereits mit. Es wird im Gegensatz
zu~\cite{Vogler2015FailSem} mit Inputs und Outputs gearbeitet und dadurch
scheint der Ansatz die gemeinsamen Aktionen zu synchronisieren natürlicher, wie
eine Menge beim Test vorzugeben.\\
Die Definition von lokaler Erreichbarkeit eines Fehler-Zustandes soll aus dem
Erweiterungs"=Ansatz übernommen werden.

\begin{Def}[Test und Verfeinerung für Kommunikationsfehler]
  \label{KommTestDef}
  Ein \emph{Test} $T$ ist eine Implementierung. Ein \MEIO{} $P$
  \emph{as-erfüllt} einen Kommunikationsfehler-Test $T$, falls $S\|T$
  fehler-frei ist für alle $S\in \asimp (P)$. Es wird dann $P \EsatAs T$
  geschrieben.\\
  Ein \MEIO{} $P$ \emph{verfeinert} $P'$, falls für alle Tests $T$: $P'\EsatAs
  T \Rightarrow P\EsatAs T$.
\end{Def}

Die Definition~\ref{KommTracesDef} der Kommunikationsfehler-Traces eines
\MEIO{}s $P$ kann aus dem Erweiterungs-Ansatz übernommen werden. Ebenso wie die
Definition der Kommunikationsfehler"=Semantik aus~\ref{KommFehlerSemDef}.
Daraus kann dann auch in diesem Ansatz der Satz~\ref{KommFehlerSemSatz}, das
Korollar~\ref{KommPraekonKor} und die Propositionen~\ref{KommTracesProp}
und~\ref{KommSemProp} beweisen werden.\\
Die Basisrelation aus dem Erweiterungs-Ansatz gibt es in diesem Ansatz nicht,
somit kann das Lemma~\ref{KommVerfeinLem} nicht in dieser Art formuliert
werden. Jedoch kann hier jetzt mit Tests gearbeitet werden.

\begin{Lem}[Testing-Verfeinerung mit Kommunikationsfehlern]
  \label{KommTestVerfeinLem}
  Gegeben sind zwei \MEIO{}s $P_1$ und $P_2$ mit der gleichen Signatur. Wenn
  für alle Tests $T$, die Partner von $P_1$ bzw. $P_2$ sind, $P_2\EsatAs T
  \Rightarrow P_1\EsatAs T$ gilt, dann folgt daraus die Gültigkeit von $P_1\ERel
  P_2$.
\end{Lem}
\begin{proof}
  Da $P_1$ und $P_2$ die gleichen Signaturen haben wird $I:=I_1=I_2$ und $O:=
  O_1=O_2$ definiert. Für jeden Test Partner $T$ gilt $I_T=O$ und $O_T=I$.\\
  Um $P_1\ERel P_2$ zu zeigen, wird nachgeprüft, ob folgendes gilt:
  \begin{itemize}
    \item $\ET _1\subseteq \ET _2$,
    \item $\EL _1\subseteq \EL _2$.
  \end{itemize}
  Für ein gewähltes präfix-minimales Element $w\in\ET _1$ wird gezeigt, dass
  dies $w$ oder eines seiner Präfixe in $\ET _2$ enthalten ist. Dies ist
  möglich, da die beiden Mengen $\ET _1$ und $\ET _2$ durch \cont{}
  abgeschlossen sind.\\
  Mit Proposition~\ref{KommSemProp} folgt aus $w\in\ET _1$, dass es auch eine
  as"=Implementierung $P'_1$ von $P_1$ geben muss, für die $w$ ebenfalls in
  $\ET _{P'_1}$ enthalten ist.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Es ist ein Fehler-Zustand in $P'_1$ lokal
      erreichbar. Für $T$ wird ein Transitionssystem verwendet, das nur aus dem
      Startzustand und einer must"=Schleife für alle Inputs $x\in I_T$ besteht.
      Somit kann $P'_1$ die im Prinzip gleichen Fehler-Zustände lokal
      erreichen wie $P'_1\|T$. $P'_1$ ist in Parallelkomposition mit $T$ nicht
      fehler-frei somit gilt $P_1\EsatAs T$ nicht. Es darf also auch $P_2$ den
      Test $T$ nicht as"=erfüllen, wegen der Implikation $P_2\EsatAs T
      \Rightarrow P_1\EsatAs T$. Damit $P_2$ $T$ nicht as"=erfüllt muss es eine
      as"=Implementierungen $P'_2$ geben, die in Parallelkomposition mit $T$ zu
      einem nicht fehler-freien System führt. Da $T$ ein Partner von $P'_2$
      ist, gibt es in der Parallelkomposition nur lokale Aktionen. Somit muss
      in $P'_2\|T$ ein Fehler lokal erreichbar sein. Durch die Definition von
      $T$ kann dieser Fehler nur von $P'_2$ geerbt sein. In $P'_2$ kann dieser
      Fehler-Zustand nur durch interen Aktionen und Outputs erreichbar sein, da
      $T$ keine Outputs besitzt, die man mit Inputs aus $P'_2$ synchronisieren
      könnte und unsynchronisierte Aktionen sind in einer Parallelkomposition
      von Partner nicht möglich. Somit gilt $\varepsilon\in \PrET
      _{P'_2}\subseteq \ET _{P'_2}$. Mit Proposition~\ref{KommSemProp} folgt
      daraus $\varepsilon\in \ET _2$.
    \item Fall 2 ($w=x_1\dots x_n x_{n+1}\in\Sigma ^+$ mit $n\geq 0$ und
      $x_{n+1}\in I=O_T$): Es wird der folgende Partner $T$ betrachtet (dieser
      entspricht bis auf die Benennung der Mengen dem Transitionssystem $U$
      aus Abbildung~\ref{UohneE}):
      \begin{itemize}
        \item $T=\{p_0,p_1,\dots ,p_{n+1}\}$,
        \item $p_{0T}=p_0$,
        \item $\begin{aligned}[t]
            \must _T&=\{(p_j,x_{j+1},p_{j+1})\mid  0\leq j\leq n\}\\
            &\cup\{(p_j,x,p_{n+1})\mid  x\in I_T\backslash\{x_{j+1}\}, 0\leq
            j\leq n\}\\
            &\cup\{(p_{n+1},x,p_{n+1})\mid  x\in I_T\},
        \end{aligned}$
        \item $E_T=\emptyset$.
      \end{itemize}
      Für $w$ können nun zwei Fälle unterschieden werden, für die beide
      $\varepsilon\in\PrET (P'_1\|T)$ folgen wird.
      \begin{itemize}
        \item Fall 2a) ($w\in\MIT _{P'_1}$): In $P'_1\|T$ erhält man
          $(p'_{01},p_0) \lweakmay[x_1\dots x_n]_{P'_1\|T} (p',p_n)$ mit $p'
          \nmust[x_{n+1}]_{P'_1}$ und $p_n\must[x_{n+1}]_T$. Deshalb gilt
          $(p',p_n)\in E_{P'_1\|T}$. Da alle Aktionen aus $w$ bis auf $x_{n+1}$
          synchronisiert werden und $I\cap I_T=\emptyset$, gilt $x_1,\dots ,
          x_n\in O_{P'_1\|T}$. Es gilt also $\varepsilon\in \PrET (P'_1\|T)$.
        \item Fall 2b) ($w\in\PrET _{P'_1}$): In der Parallelkomposition
          $P'_1\|T$ erhält man die Transitionsfolge $(p_{01},p_0)
          \weakmay[w]_{P'_1\|T} (p'',p_{n+1}) \weakmay[u]_{P'_1\|T}
          (p',p_{n+1})$ für $u\in O^*$ und $p'\in E_{P'_1}$. Daraus folgt
          $(p',p_{n+1})\in E_{P'_1\|T}$ und somit $wu\in\StET (P'_1\|T)$. Da
          alle Aktionen in $w$ synchronisiert werden und $I\cap I_T =
          \emptyset$, gilt $x_1,\dots , x_n, x_{n+1}\in O_{P'_1\|T}$ und, da
          $u\in O^*$, folgt $u\in O^*_{P'_1\|T}$. Somit ergibt sich
          $\varepsilon \in \PrET (P'_1\|T)$.
      \end{itemize}
      Da $\varepsilon\in\PrET (P'_1\|T)$ gilt, kann durch $P_2\EsatAs T
      \Rightarrow P_1\EsatAs T$ geschlossen werden, dass auch $P_2\EsatAs T$
      nicht gelten kann. Die Relation gilt für $P_2$ nicht, da es eine
      as"=Implementierung $P'_2$ von $P_2$ gibt, so dass $P'_2\|T$ nicht
      fehler-frei ist. Da es nur lokale Aktionen in $P'_2\|T$ gibt, muss der
      Fehler-Zustand lokal erreichbar sein.\\
      Der Fehler kann geerbt oder neu sein.
      \begin{itemize}
        \item Fall 2i) (neuer Fehler): Da jeder Zustand von $T$ alle Inputs
          $x\in O=I_T$ zulässt, muss ein lokal erreichbarer Fehler-Zustand der
          Form sein, dass ein Outputs $a\in O_T$ von $T$ möglich ist, der nicht
          mit einem passenden Input aus $P'_2$ synchronisiert werden werden
          kann. Durch die Konstruktion von $T$ sind in $p_{n+1}$ keine Outputs
          möglich. Ein neuer Fehler muss also die Form $(p',p_i)$ haben mit
          $i\leq n$, $p'\nmust[x_{i+1}]_{P'_2}$ und $x_{i+1}\in O_T=I$. Durch
          Projektion erhält man dann $p_{02} \lweakmay[x_1\dots x_i]_{P'_2} p'
          \nmust[x_{i+1}]_{P'_2}$ und damit gilt $x_1\dots x_{i+1}\in\MIT
          _{P'_2} \subseteq \ET _{P'_2}$. Es ist also ein Präfix von $w$ in
          $\ET _{P'_2}$ enthalten und mit Proposition~\ref{KommSemProp} auch in
          $\ET _2$.
        \item Fall 2ii) (geerbter Fehler): $T$ hat $x_1\dots x_i u$ mit $u\in
          I^*_T =O^*$ ausgeführt und ebenso hat $P'_2$ dieses Wort
          abgearbeitet. Durch dies hat $P'_2$ einen Zustand in $E _{P'_2}$
          erreicht, da von $T$ keine Fehler geerbt werden können. Es gilt dann
          $\prune (x_1\dots x_iu) = \prune (x_1\dots x_i)\in\PrET _{P'_2}
          \subseteq \ET _{P'_2}$. Da $x_1\dots x_i$ ein Präfix von $w$ ist,
          führt in diesem Fall eine Verlängerung um lokale Aktionen von einem
          Präfix von $w$ zu einem Fehler-Zustand. Da \ET{} der Menge aller
          Verlängerungen von gekürzten Fehler-Traces entspricht, ist $x_1\dots
          x_i$ in $\ET _{P'_2}$ enthalten und somit ist mit
          Proposition~\ref{KommSemProp} ein Präfix von $w$ in $\ET _2$
          enthalten.
      \end{itemize}
  \end{itemize}
  Um die andere Inklusion zu beweisen, reich es aufgrund der ersten Inklusion
  und der Definition von \EL{} aus zu zeigen, dass $L_1\backslash \ET
  _1\subseteq \EL _1$ gilt.\\
  Es wird dafür ein beliebiges $w\in L_1\backslash \ET _1$ gewählt und gezeigt,
  dass es in $\EL _2$ enthalten ist. Das $w$ ist wegen der
  Propositionen~\ref{LImpProp} und~\ref{KommSemProp} auch für eine
  as"=Implementierung $P'_1$ von $P_1$ in $L_{P'_1}\backslash \ET _{P'_1}$
  enthalten.
  \begin{itemize}
    \item Fall 1 ($w=\varepsilon$): Da $\varepsilon$ immer in $\EL _2$ muss
      hier nichts gezeigt werden.
    \item Fall 2 ($w=x_1\dots x_n$ mit $n\geq 1$): Es wird ein Partner $T$ wie
      folgt konstruiert ($T$ entspricht dabei $U$ aus Abbildung~\ref{UmitE} bis
      auf die Benennung der Mengen):
      \begin{itemize}
        \item $T=\{p_0,p_1,\dots ,p_n,p\}$,
        \item $p_{0T}=p_0$,
        \item $\begin{aligned}[t]
            \must _T&=\{(p_j,x_{j+1},p_{j+1})\mid 0\leq j< n\}\\
            &\cup\{(p_j,x,p)\mid x\in I_T\backslash\{x_{j+1}\},0\leq j< n\}\\
            &\cup\{(p,x,p)\mid x\in I_T\},
        \end{aligned}$
        \item $E_T=\{p_n\}$.
      \end{itemize}
      Da $p_{01} \weakmay[w]_{P'_1} p'$ gilt, kann man schließen, dass
      $P'_1\|T$ ein lokal erreichbaren geerbten Fehler hat. Es muss also auch
      eine as"=Implementierung $P'_2$ von $P_2$ geben, für die $P'_2\|T$ einen
      lokal erreichbaren Fehler-Zustand hat.
      \begin{itemize}
        \item Fall 2a) (neuer Fehler aufgrund von $x_i\in O_T$ und $p_{02}
          \lweakmay[x_1\dots x_{i-1}]_{P'_2}p''\nmust[x_i]_{P'_2}$): Es gilt
          $x_1\dots x_i\in\MIT _{P'_2}$ und somit $w\in\EL _{P'_2}$. Anzumerken
          ist, dass es nur auf diesem Weg Outputs von $T$ möglich sind, deshalb
          gibt es keine anderen Outputs von $T$, die zu einem neuen Fehler
          führen können. Es gilt $w\in\EL _2$ wegen
          Proposition~\ref{KommSemProp}.
        \item Fall 2b) (neuer Fehler aufgrund von $a\in O=I_T$): Der einzige
          Zustand, in dem $T$ nicht alle Inputs erlaubt sind, ist $p_n$, der
          bereits ein Fehler-Zustand ist. Da dieser Zustand in $P'_2\|T$
          erreichbar ist, besitzt der komponierte \MEIO{} einen geerbten Fehler
          und es gilt $w\in L_2\subseteq \EL _2$, wegen dem folgenden Fall 2c).
        \item Fall 2c) (geerbter Fehler von $T$): Da $p_n$ der einzige
          Fehler-Zustand in $T$ ist und alle Aktionen synchronisiert sind, ist
          dies nur möglich, wenn $p_{02} \lweakmay[x_1\dots x_n]_{P'_2}$ gilt.
          In diesem Fall gilt $w\in L_{P'_2}\subseteq \EL _{P'_2}$. Daraus
          folgt mit Proposition~\ref{KommSemProp} $w\in\EL _2$.
        \item Fall 2d) (geerbter Fehler von $P'_2$): Es gilt dann $p_{02}
          \lweakmay[x_1\dots x_n]_{P'_2} p'\in E_{P'_2}$ für $i\geq 0$ und
          $u\in O^*$. Somit ist $x_1\dots x_i u\in\StET _{P'_2}$ und damit
          $\prune (x_1\dots x_iu) =\prune (x_1\dots x_i)\in\PrET
          _{P'_2}\subseteq \EL _{P'_2}$. Somit gilt mit Hilfe von
          Proposition~\ref{KommSemProp} $w\in\EL _{P'_2}\subseteq \EL _2$.
      \end{itemize}
  \end{itemize}
\end{proof}

\begin{Satz}
  \label{KommTestVerfSatz}
  Falls $P_1\ERel P_2$ gilt folgt draus auch, dass $P_1$ $P_2$ verfeinert.
\end{Satz}
\begin{proof}
  Nach Definition gilt, genau dann wenn $\varepsilon\in \ET (P)$, ist ein
  Fehler-Zustand lokal erreichbar in $P$. $P_1\ERel P_2$ impliziert, dass
  $\varepsilon\in\ET _2$ gilt, wenn $\varepsilon\in\ET _1$. Somit ist ein
  Fehler-Zustand in $P_1$ nur dann lokal erreichbar, wenn dieser auch in $P_2$
  lokal erreichbar ist. Aufgrund von Proposition~\ref{KommSemProp} gibt es dann
  auch entsprechende as"=Implementierungen $P'_1$ und $P'_2$ für $P_1$ bzw.
  $P_2$, die ebenfalls Fehler-Zustände lokal erreichen können, wenn dies in
  $P_1$ bzw. $P_2$ möglich ist. Für einen entsprechenden Test $T$ gilt dann
  auch, dass $P'_j\|T$ für $j\in\{1,2\}$ einen lokal erreichbaren Fehler hat,
  wenn $P'_j$ einen solchen hat. Falls also $P_1$ einen lokal erreichbaren
  Fehler-Zustand enthält, dann zeigt sich dies Verhalten auch in einer
  as"=Implementierungen und auch in der Parallelkomposition der
  as"=Implementierung mit einem Test $T$. Aus einem lokal erreichbaren Fehler
  in $P_1$ folgt auch ein lokal erreichbarer Fehler-Zustand in $P_2$ und somit
  auch ein lokal erreichbarer Fehler-Zustand in der Parallelkomposition einer
  as"=Implementierung von $P_2$ mit einem Test $T$. Aus $P_1\ERel P_2$ folgt
  also die Implikation $\neg P_1 \EsatAs T \Rightarrow \neg P_2 \EsatAs T$ für
  alle Test $T$. Wenn man die Negationen entfernt, ergibt sich für alle Tests
  $T$: $P_2\EsatAs T\Rightarrow P_1\EsatAs T$. Dies entspricht der Definition
  von $P_1$ verfeinert $P_2$.
\end{proof}

Auch die in diesem Abschnitt gezeigten Folgerungen schließen sich zu einem
Ring. Dies ist in Abbildung~\ref{KommTestFolgerungskette} dargestellt.

\begin{figure}[h!tbp]
  \begin{center}
    \begin{tikzpicture}[scale = 3]
      \matrix (m) [matrix of math nodes,row sep=2cm,column sep=4cm]{%
        P_1\ERel P_2 & P_1 \text{ verfeinert } P_2 \\
        \substack{\forall \text{ Test Partner } T:\\P_2\EsatAs T\Rightarrow
        P_1\EsatAs T} &
    \substack{\forall \text{ Tests } T:\\P_2\EsatAs T\Rightarrow P_1\EsatAs T} \\};
        \draw[-implies, double, double distance=1mm]
          (m-1-1) -- node [above] {Satz~\ref{KommTestVerfSatz}} (m-1-2);
        \draw[-implies, double, double distance=1mm]
          (m-1-2) -- node [right] {Definition~\ref{KommTestDef}} (m-2-2);
        \draw[-implies, double, double distance=1mm]
          (m-2-1) -- node [left]
          {Lemma~\ref{KommTestVerfeinLem}} (m-1-1);
        \draw[-implies, double, double distance=1mm]
          (m-2-2) -- node [below]
          {$\substack{T \text{ Test Partner}\\\Downarrow\\ T \text{ Test}}$} (m-2-1);
    \end{tikzpicture}
    \caption{Folgerungskette der Testing-Verfeinerung und Fehler-Relation}
  \label{KommTestFolgerungskette}
  \end{center}
\end{figure}
